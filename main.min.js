function findItemFromArray(e,t){for(var n=0,a=t;n<a.length;n++){var r=a[n];if(r.name===e)return r}return null}var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,a){var r,o=arguments.length,i=3>o?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(i=(3>o?r(i):o>3?r(t,n,i):r(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i},__awaiter=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(r,o){function i(e){try{l(a.next(e))}catch(t){o(t)}}function s(e){try{l(a["throw"](e))}catch(t){o(t)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,s)}l((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return a([e,t])}}function a(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(i=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(a){n=[6,a],o=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return{next:n(0),"throw":n(1),"return":n(2)}},DragonBonesModelEvent;!function(e){e[e.DragonBonesChange=100]="DragonBonesChange",e[e.ArmatureAdd=101]="ArmatureAdd",e[e.ArmatureRemove=102]="ArmatureRemove",e[e.ArmatureChange=103]="ArmatureChange",e[e.AnimationStart=104]="AnimationStart",e[e.AnimationComplete=105]="AnimationComplete",e[e.AnimationPlay=106]="AnimationPlay",e[e.AnimationStop=107]="AnimationStop",e[e.AnimationChange=108]="AnimationChange"}(DragonBonesModelEvent||(DragonBonesModelEvent={}));var BaseModel=function(){function e(){}return e.prototype.dispatchEvent=function(e,t){DragonBonesControl.getInstance().dispatchEventWith(DragonBonesModelEvent[e],!1,t)},e}();__reflect(BaseModel.prototype,"BaseModel");var DragonBonesModel=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._armatureItems=[],t._armatures=[],t._armature=null,t._animation=null,t}return __extends(t,e),t.prototype._animationHandler=function(e){switch(e.type){case dragonBones.EventObject.FADE_IN:e.animationState&&(this._animation&&this._animation.name===e.animationState.name||(this._animation=e.animationState,this.dispatchEvent(DragonBonesModelEvent.AnimationChange,this),this.dispatchEvent(DragonBonesModelEvent.AnimationPlay,this)),this._animation=e.animationState,this.dispatchEvent(DragonBonesModelEvent.AnimationStart,this));break;case dragonBones.EventObject.COMPLETE:this.dispatchEvent(DragonBonesModelEvent.AnimationComplete,this)}},t.prototype.init=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.addArmature=function(e,t){var n=dragonBones.EgretFactory.factory.buildArmatureDisplay(t,e);return null!==n?(this._armatures.push(n.armature),this.changedArmature=n.armature,this.dispatchEvent(DragonBonesModelEvent.ArmatureAdd,this),n.armature):null},t.prototype.removeArmature=function(e){this.armature===e&&(this.armature=null);var t=this._armatures.indexOf(e);t>=0&&(this._armatures.splice(t,1),this.changedArmature=e,this.dispatchEvent(DragonBonesModelEvent.ArmatureRemove,this),e.dispose())},t.prototype.clearAllArmature=function(){for(var e=this._armatures.length;e--;){var t=this._armatures[e];this.removeArmature(t)}},t.prototype.changeArmature=function(e){if(!(this._armatureItems.length>0)){this._armature&&this.removeArmature(this._armature),e%=this._armatureItems.length,0>e&&(e=this._armatureItems.length+e);var t=this._armatureItems[e];this.armature=this.addArmature(t.data,t.name),this.playAnimation()}},t.prototype.prevArmature=function(){if(this._armature){for(var e=0,t=0,n=this._armatureItems;t<n.length;t++){var a=n[t];if(this._armature.armatureData.parent.name===a.name||this._armature.armatureData.name)break;e++}this.changeArmature(e-1)}else this.changeArmature(0)},t.prototype.nextArmature=function(){if(this._armature){for(var e=0,t=0,n=this._armatureItems;t<n.length;t++){var a=n[t];if(this._armature.armatureData.parent.name===a.name||this._armature.armatureData.name)break;e++}this.changeArmature(e+1)}else this.changeArmature(0)},t.prototype.playAnimation=function(){this._armature&&(this._armature.animation.play(),this.dispatchEvent(DragonBonesModelEvent.AnimationPlay,this))},t.prototype.stopAnimation=function(){this._armature&&(this._armature.animation.stop(),this.dispatchEvent(DragonBonesModelEvent.AnimationStop,this))},t.prototype.changeAnimation=function(e){if(this._armature){var t=this._armature.armatureData.animationNames;e%=t.length,0>e&&(e+=t.length);var n=this._armature.animation.fadeIn(t[e],.001);n&&(n.resetToPose=!1)}},t.prototype.prevAnimation=function(){if(this._armature)if(this._animation){var e=this._armature.armatureData.animationNames;this.changeAnimation(e.indexOf(this._animation.name)-1)}else this._armature.animation.play()},t.prototype.nextAnimation=function(){if(this._armature)if(this._animation){var e=this._armature.armatureData.animationNames;this.changeAnimation(e.indexOf(this._animation.name)+1)}else this._armature.animation.play()},Object.defineProperty(t.prototype,"armatures",{get:function(){return this._armatures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},set:function(e){this._armature!==e&&(this._animation=null,this.dispatchEvent(DragonBonesModelEvent.AnimationChange,this),this._armature&&(this._armature.removeEventListener(dragonBones.EventObject.FADE_IN,this._animationHandler,this),this._armature.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this)),this._armature=e,this._armature&&(this._armature.addEventListener(dragonBones.EventObject.FADE_IN,this._animationHandler,this),this._armature.addEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this)),this.dispatchEvent(DragonBonesModelEvent.ArmatureChange,this))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),t}(BaseModel);__reflect(DragonBonesModel.prototype,"DragonBonesModel");var DragonBonesControl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getInstance=function(){return t._instance||(t._instance=new egret.EventDispatcher),t._instance},t}(egret.EventDispatcher);__reflect(DragonBonesControl.prototype,"DragonBonesControl");var object;!function(e){function t(e,t){if((0>t||t!==t)&&(t=0),e){var n=String(e);h[n]=t;var a=d[n];a&&a.length>t&&(a.length=t)}else{i=t;for(var n in d)if(h[n]){h[n]=t;var a=d[n];a.length>t&&(a.length=t)}}}function n(e){if(e){var t=d[String(e)];t&&t.length&&(t.length=0)}else for(var n in d){var t=d[n];t.length=0}}function a(e){var t=String(e),n=l[t];return n||(n=l[t]=r(e)),n}function r(e){var t=d[String(e)];if(t&&t.length>0){var n=t.pop();return n}var a=new e;return a.clear(),a}function o(e){var t=String(e.constructor),n=t in h?i:h[t],a=d[t]=d[t]||[];a.length<n&&(console.assert(a.indexOf(e)<0),a.push(e))}var i=1e3,s=0,l={},h={},d={};e.setMaxCount=t,e.clearPool=n,e.getInstance=a,e.create=r,e.dispose=o;var u=function(){function e(){this.hashCode=s++}return e.toString=function(){throw new Error},e.prototype.dispose=function(){this.clear(),o(this)},e}();e.BaseObject=u,__reflect(u.prototype,"object.BaseObject")}(object||(object={}));var Main=Main_1=function(e){function t(){var t=e.call(this)||this;return t.model=new MainModel,t.view=new MainView,Main_1._instance=t,t.addChild(t.view),t.addEventListener(egret.Event.ADDED_TO_STAGE,t._addToStageHandler,t),t}return __extends(t,e),t.getInstance=function(){return Main_1._instance},t.prototype._addToStageHandler=function(){var e=this;RES.loadConfig().then(function(){RES.loadGroup("preload").then(function(){dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("ui_ske_json")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("ui_tex_json"),RES.getRes("ui_tex_png")),e.view.init(),e.model.init(RES.getRes("resource_config_json"),RES.getRes("game_config_json")),DragonBonesControl.getInstance().dispatchEventWith(DragonBonesModelEvent[DragonBonesModelEvent.Startup])})})},t}(egret.DisplayObjectContainer);Main=Main_1=__decorate([RES.mapConfig("config.json",function(){return"resource"},function(e){var t=e.substr(e.lastIndexOf(".")+1),n={jpg:"image",png:"image",webp:"image",json:"json",fnt:"font",pvr:"pvr",mp3:"sound"},a=n[t];return"json"==a&&(e.indexOf("sheet")>=0?a="sheet":e.indexOf("movieclip")>=0&&(a="movieclip")),a})],Main),__reflect(Main.prototype,"Main");var Main_1,DragonBonesModelEvent;!function(e){e[e.ChangePlayer=200]="ChangePlayer",e[e.AddPlayer=201]="AddPlayer",e[e.RemovePlayer=202]="RemovePlayer",e[e.ChangeClothes=203]="ChangeClothes",e[e.ChangeMovement=204]="ChangeMovement",e[e.Startup=205]="Startup",e[e.SendMessage=206]="SendMessage",e[e.PlayMessage=207]="PlayMessage"}(DragonBonesModelEvent||(DragonBonesModelEvent={}));var MainModel=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.players=[],t}return __extends(t,e),t.prototype.init=function(e,t){this.resourceConfig=e,this.gameConfig=t;for(var n=0,a=this.gameConfig.players;n<a.length;n++){var r=a[n],o=new PlayerModel;o.config=r,o.name=r.name,o.role=findItemFromArray(r.role,this.resourceConfig.roles),o.clothes.length=0;for(var i=0,s=o.config.clothes;i<s.length;i++){var l=s[i],h=findItemFromArray(l,this.resourceConfig.clothes);h&&o.clothes.push(h)}this.players.push(o)}this.player=findItemFromArray(this.gameConfig.player,this.players)},t}(BaseModel);__reflect(MainModel.prototype,"MainModel");var PlayerModel=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clothes=[],t}return __extends(t,e),t.prototype.getCloth=function(e){return findItemFromArray(e,Main.getInstance().model.resourceConfig.clothes)},t.prototype.addSuit=function(e){for(var t=0,n=e.clothes;t<n.length;t++){var a=n[t],r=this.getCloth(a);this.addCloth(r)}},t.prototype.getCurrentSuit=function(){for(var e=0,t=Main.getInstance().model.resourceConfig.suits;e<t.length;e++){var n=t[e];if(this.config.clothes.length===n.clothes.length){var a=!0;for(var r in this.clothes)if(n.clothes.indexOf(r)<0){a=!1;break}if(a)return n}}return null},t.prototype.addCloth=function(e){if(e&&!(this.clothes.indexOf(e)>=0)){this.config.clothes.length=0;for(var t=this.clothes.length;t--;){for(var n=this.clothes[t],a=!1,r=0,o=e.types;r<o.length;r++){var i=o[r];if(n.types.indexOf(i)>=0){a=!0;break}}a?this.clothes.splice(t,1):this.config.clothes.push(n.name)}this.clothes.push(e),this.config.clothes.push(e.name),this.updateClothes()}},t.prototype.removeCloth=function(e){if(e&&!(this.clothes.indexOf(e)<0)){this.config.clothes.length=0;for(var t=this.clothes.length;t--;){var n=this.clothes[t];n===e?this.clothes.splice(t,1):this.config.clothes.push(n.name)}this.updateClothes()}},t.prototype.updateClothes=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n;return __generator(this,function(a){switch(a.label){case 0:e=0,t=this.clothes,a.label=1;case 1:return e<t.length?(n=t[e],dragonBones.EgretFactory.factory.getDragonBonesData(n.data)?[3,5]:[4,RES.getResAsync("assets/"+n.data+"_ske.json")]):[3,6];case 2:return a.sent(),[4,RES.getResAsync("assets/"+n.data+"_tex.json")];case 3:return a.sent(),[4,RES.getResAsync("assets/"+n.data+"_tex.png")];case 4:a.sent(),dragonBones.EgretFactory.factory.getDragonBonesData(n.data)||(dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("assets/"+n.data+"_ske.json")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("assets/"+n.data+"_tex.json"),RES.getRes("assets/"+n.data+"_tex.png"))),a.label=5;case 5:return e++,[3,1];case 6:return this.dispatchEvent(DragonBonesModelEvent.ChangeClothes,this),[2]}})})},t}(BaseModel);__reflect(PlayerModel.prototype,"PlayerModel",["IName"]);var MainView=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.Startup],this._modelEventHandler,this)},t.prototype._modelEventHandler=function(e){var t=this;this.uiArmature=dragonBones.EgretFactory.factory.buildArmatureDisplay("application"),this.uiArmature.animation.play("message"),this.addChild(this.uiArmature);var n=this.uiArmature.armature.getSlot("message").childArmature,a=this.uiArmature.armature.getSlot("user").childArmature,r=this.uiArmature.armature.getSlot("show").childArmature,o=n.getSlot("buttonUser").display;o.touchEnabled=!0,o.addEventListener("touchEnd",function(){t.uiArmature.animation.fadeIn("user")},this);var i=new MessageList;n.animation.play("normal"),n.getSlot("list").display=i,i.init();var s=n.getSlot("bottom").childArmature,l=s.getSlot("button").display;l.touchEnabled=!0,l.addEventListener("touchEnd",function(){n.animation.lastAnimationName&&"normal"!==n.animation.lastAnimationName?n.animation.fadeIn("normal"):n.animation.fadeIn("input")},this);for(var h=function(e){var t=s.getSlot("button_"+(e+1)).display;t.touchEnabled=!0,t.addEventListener("touchEnd",function(){DragonBonesControl.getInstance().dispatchEventWith(DragonBonesModelEvent[DragonBonesModelEvent.SendMessage],!1,{players:[Main.getInstance().model.player.name],movements:[Main.getInstance().model.resourceConfig.movements[e].name]})},d)},d=this,u=0;3>u;++u)h(u);var c=new BigMessageView(Main.getInstance().model.player);n.getSlot("show").childArmature.getSlot("show").display=c,c.init();var m=a.getSlot("buttonMessage").display,g=a.getSlot("buttonShow").display;m.touchEnabled=!0,g.touchEnabled=!0,m.addEventListener("touchEnd",function(){t.uiArmature.animation.fadeIn("message")},this),g.addEventListener("touchEnd",function(){t.uiArmature.animation.fadeIn("show")},this);var p=new SmallShow(Main.getInstance().model.player);a.getSlot("show").display=p,p.init();var o=r.getSlot("buttonUser").display;o.touchEnabled=!0,o.addEventListener("touchEnd",function(){t.uiArmature.animation.fadeIn("user")},this),this.panelClothes=r.getSlot("clothes").childArmature.display,this.panelMovements=r.getSlot("movements").childArmature.display;var p=new ShowView(Main.getInstance().model.player);r.getSlot("show").display=p,p.init()},t}(egret.DisplayObjectContainer);__reflect(MainView.prototype,"MainView");var BasePlayerView=function(e){function t(t){var n=e.call(this)||this;return n._dbModel=new DragonBonesModel,n._armatureContainer=new egret.DisplayObjectContainer,n._viewContainer=new egret.DisplayObjectContainer,n._dbModel,n._player=t,n._viewContainer.addChild(n._armatureContainer),n}return __extends(t,e),t.prototype.init=function(){DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.ArmatureAdd],this._modelEventHandler,this),DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.ArmatureRemove],this._modelEventHandler,this),DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.ChangeClothes],this._modelEventHandler,this),DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.AnimationComplete],this._modelEventHandler,this)},t.prototype._modelEventHandler=function(e){switch(e.type){case DragonBonesModelEvent[DragonBonesModelEvent.ArmatureAdd]:e.data===this._dbModel&&this._armatureContainer.addChild(this._dbModel.changedArmature.display);break;case DragonBonesModelEvent[DragonBonesModelEvent.ArmatureRemove]:e.data===this._dbModel&&this._armatureContainer.removeChild(this._dbModel.changedArmature.display);break;case DragonBonesModelEvent[DragonBonesModelEvent.ChangeClothes]:if(e.data===this._player){var t=dragonBones.EgretFactory.factory.getArmatureData(this._player.role.armature,this._player.role.data);dragonBones.EgretFactory.factory.changeSkin(this._dbModel.armature,t.defaultSkin);for(var n=0,a=this._player.clothes;n<a.length;n++){var r=a[n],o=dragonBones.EgretFactory.factory.getArmatureData(r.armature,r.data);dragonBones.EgretFactory.factory.changeSkin(this._dbModel.armature,o.defaultSkin)}this._dbModel.armature&&this._dbModel.armature.invalidUpdate()}break;case DragonBonesModelEvent[DragonBonesModelEvent.AnimationComplete]:e.data===this._dbModel&&this.changeMovement(this._player.role)}},t.prototype.changeMovement=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this._movement===e?[2]:this._movement&&this._movement.data===e.data&&this._movement.armature===e.armature?[3,5]:dragonBones.EgretFactory.factory.getDragonBonesData(e.data)?[3,4]:[4,RES.getResAsync("assets/"+e.data+"_ske.json")];case 1:return t.sent(),[4,RES.getResAsync("assets/"+e.data+"_tex.json")];case 2:return t.sent(),[4,RES.getResAsync("assets/"+e.data+"_tex.png")];case 3:t.sent(),dragonBones.EgretFactory.factory.getDragonBonesData(e.data)||(dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("assets/"+e.data+"_ske.json")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("assets/"+e.data+"_tex.json"),RES.getRes("assets/"+e.data+"_tex.png"))),t.label=4;case 4:this._dbModel.armature&&this._dbModel.removeArmature(this._dbModel.armature),this._dbModel.armature=this._dbModel.addArmature(e.data,e.armature),t.label=5;case 5:return this._movement=e,this._dbModel.armature&&this._dbModel.changeAnimation(this._dbModel.armature.animation.animationNames.indexOf(this._movement.animations[0].animation)),this._player.updateClothes(),[2]}})})},t}(egret.DisplayObjectContainer);__reflect(BasePlayerView.prototype,"BasePlayerView");var ShowView=function(e){function t(t){var n=e.call(this,t)||this;return n.addChild(n._viewContainer),n}return __extends(t,e),t.prototype._modelEventHandler=function(t){switch(e.prototype._modelEventHandler.call(this,t),t.type){case DragonBonesModelEvent[DragonBonesModelEvent.ChangeClothes]:for(var n=0,a=Main.getInstance().model.resourceConfig.clothes.length;a>n;++n){var r=this._panelClothes.armature.getSlot("button_"+n);r&&r.childArmature&&(Main.getInstance().model.player.clothes.indexOf(r.userData)>=0?r.childArmature.animation.fadeIn("selected",.2):r.childArmature.animation.fadeIn("normal",.2))}}},t.prototype._clothesInit=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,a,r,o;return __generator(this,function(i){switch(i.label){case 0:e=0,t=Main.getInstance().model.resourceConfig.clothes.length,i.label=1;case 1:return t>e?(n=Main.getInstance().model.resourceConfig.clothes[e],(a=this._panelClothes.armature.getSlot("button_"+e))?(a.userData=n,a.childArmature?(a.childArmature.display.touchEnabled=!0,(r=a.childArmature.getSlot("image"))?(o=r.display=new egret.Bitmap,[4,RES.getResAsync("icon/"+n.name+".png")]):[3,3]):[3,3]):[3,3]):[3,4];case 2:i.sent(),o.texture=RES.getRes("icon/"+n.name+".png"),o.anchorOffsetX=48,o.anchorOffsetY=48,o.width=96,o.height=96,i.label=3;case 3:return++e,[3,1];case 4:return[2]}})})},t.prototype._movementInit=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,a,r,o;return __generator(this,function(i){switch(i.label){case 0:e=0,t=Main.getInstance().model.resourceConfig.movements.length,i.label=1;case 1:return t>e?(n=Main.getInstance().model.resourceConfig.movements[e],(a=this._panelMovement.armature.getSlot("button_"+e))?(a.userData=n,a.childArmature?(a.childArmature.display.touchEnabled=!0,(r=a.childArmature.getSlot("image"))?(o=r.display=new egret.Bitmap,[4,RES.getResAsync("icon/"+n.name+".png")]):[3,3]):[3,3]):[3,3]):[3,4];case 2:i.sent(),o.texture=RES.getRes("icon/"+n.name+".png"),o.anchorOffsetX=48,o.anchorOffsetY=48,o.width=96,o.height=96,i.label=3;case 3:return++e,[3,1];case 4:return[2]}})})},t.prototype.init=function(){var t=this;e.prototype.init.call(this),this._panelClothes=Main.getInstance().view.panelClothes,this._panelMovement=Main.getInstance().view.panelMovements,this._panelMovement.touchEnabled=!0,this._panelClothes.touchEnabled=!0,DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.ChangeClothes],this._modelEventHandler,this),this._panelMovement.addEventListener("touchEnd",function(e){var n=t._panelMovement.armature.getSlotByDisplay(e.target);n&&t.changeMovement(n.userData)},this),this._panelClothes.addEventListener("touchEnd",function(e){var n=t._panelClothes.armature.getSlotByDisplay(e.target);n&&(t._player.clothes.indexOf(n.userData)>=0?t._player.removeCloth(n.userData):t._player.addCloth(n.userData))},this),this._clothesInit(),this._movementInit(),this.changeMovement(this._player.role)},t}(BasePlayerView);__reflect(ShowView.prototype,"ShowView");var MessageView=function(e){function t(t,n){var a=e.call(this,t)||this;return a._message=n,a}return __extends(t,e),t.prototype._armatureHandler=function(e){e.animationState.name===this._player.role.animations[0].animation&&e.animationState.currentPlayTimes>=3*Math.random()+1&&this._play()},t.prototype._play=function(){if(this._dbModel.armature){var e=this._dbModel.armature.display;e.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._armatureHandler,this)}var t=findItemFromArray(this._message.movements[0],Main.getInstance().model.resourceConfig.movements);this.changeMovement(t)},t.prototype._modelEventHandler=function(t){switch(e.prototype._modelEventHandler.call(this,t),t.type){case DragonBonesModelEvent[DragonBonesModelEvent.AnimationComplete]:if(this._dbModel===t.data){var n=this._dbModel.armature.display;n.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._armatureHandler,this)}}},t.prototype.init=function(){var t=this;e.prototype.init.call(this),this._uiArmature=dragonBones.EgretFactory.factory.buildArmatureDisplay("messageItem"),this._player===Main.getInstance().model.player?this._uiArmature.animation.play("right"):this._uiArmature.animation.play("left"),this.addChild(this._uiArmature),this._uiArmature.armature.getSlot("show").display=this._viewContainer,this._armatureContainer.scaleX=this._armatureContainer.scaleY=.16,this._player!==Main.getInstance().model.player&&(this._armatureContainer.scaleX*=-1),this.touchEnabled=!0,this.addEventListener("touchBegin",function(){DragonBonesControl.getInstance().dispatchEventWith(DragonBonesModelEvent[DragonBonesModelEvent.PlayMessage],!1,t._message)},this),this._play()},t}(BasePlayerView);__reflect(MessageView.prototype,"MessageView");var SmallShow=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),this.addChild(this._viewContainer),this._armatureContainer.scaleX=this._armatureContainer.scaleY=.4,this.changeMovement(this._player.role)},t}(BasePlayerView);__reflect(SmallShow.prototype,"SmallShow");var BigMessageView=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._play=function(e){this._movement=null,this._player=findItemFromArray(e.players[0],Main.getInstance().model.players);var t=findItemFromArray(e.movements[0],Main.getInstance().model.resourceConfig.movements);this.changeMovement(t),this._player!==Main.getInstance().model.player?this._viewContainer.scaleX=-1:this._viewContainer.scaleX=1,this.parent.armature.animation.fadeIn("show",.2)},t.prototype._modelEventHandler=function(t){switch(e.prototype._modelEventHandler.call(this,t),t.type){case DragonBonesModelEvent[DragonBonesModelEvent.SendMessage]:var n=t.data;this._play(n);break;case DragonBonesModelEvent[DragonBonesModelEvent.PlayMessage]:var n=t.data;this._play(n);break;case DragonBonesModelEvent[DragonBonesModelEvent.AnimationComplete]:t.data===this._dbModel&&this.parent.armature.animation.fadeIn("hide",.2)}},t.prototype.init=function(){e.prototype.init.call(this),this.addChild(this._viewContainer),this._armatureContainer.scaleX=this._armatureContainer.scaleY=1,this.changeMovement(this._player.role),DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.SendMessage],this._modelEventHandler,this),DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.PlayMessage],this._modelEventHandler,this),this.parent.armature.animation.play("hide")},t}(BasePlayerView);__reflect(BigMessageView.prototype,"BigMessageView");var MessageList=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._messageCount=0,t}return __extends(t,e),t.prototype._createMessage=function(e){var t=findItemFromArray(e.players[0],Main.getInstance().model.players),n=new MessageView(t,e);n.y=200*this._messageCount,this.addChild(n),n.init(),this._messageCount++},t.prototype.init=function(){for(var e=0,t=Main.getInstance().model.gameConfig.messages;e<t.length;e++){var n=t[e];this._createMessage(n)}DragonBonesControl.getInstance().addEventListener(DragonBonesModelEvent[DragonBonesModelEvent.SendMessage],this._modelEventHandler,this)},t.prototype._modelEventHandler=function(e){var t=e.data;this._createMessage(t)},t}(egret.DisplayObjectContainer);__reflect(MessageList.prototype,"MessageList");