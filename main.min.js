function enableDrag(t){t&&(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,_dragHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,_dragHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_END,_dragHandler,t))}function disableDrag(t){t&&(t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,_dragHandler,t),t.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,_dragHandler,t),t.removeEventListener(egret.TouchEvent.TOUCH_END,_dragHandler,t))}function _dragHandler(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:if(dragTarget)return;dragTarget=t.target,dragTarget.parent.globalToLocal(t.stageX,t.stageY,_helpPoint),_dragOffset.x=dragTarget.x-_helpPoint.x,_dragOffset.y=dragTarget.y-_helpPoint.y,dragTarget.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,_dragHandler,dragTarget);break;case egret.TouchEvent.TOUCH_RELEASE_OUTSIDE:case egret.TouchEvent.TOUCH_END:dragTarget&&(dragTarget.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,_dragHandler,dragTarget),dragTarget=null);break;case egret.TouchEvent.TOUCH_MOVE:dragTarget&&(dragTarget.parent.globalToLocal(t.stageX,t.stageY,_helpPoint),dragTarget.x=_helpPoint.x+_dragOffset.x,dragTarget.y=_helpPoint.y+_dragOffset.y)}}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},dragonBones;!function(t){var e=function(){function e(){this.hashCode=e._hashCode++,this._isInPool=!1}return e._returnObject=function(i){var a=String(i.constructor),r=a in e._maxCountMap?e._defaultMaxCount:e._maxCountMap[a],n=e._poolsMap[a]=e._poolsMap[a]||[];n.length<r&&(i._isInPool?t.DragonBones.assert(!1):(i._isInPool=!0,n.push(i)))},e.toString=function(){throw new Error},e.setMaxCount=function(t,i){if((0>i||i!==i)&&(i=0),null!==t){var a=String(t);e._maxCountMap[a]=i;var r=e._poolsMap[a];r&&r.length>i&&(r.length=i)}else{e._defaultMaxCount=i;for(var a in e._poolsMap)if(!(a in e._maxCountMap)){e._maxCountMap[a]=i;var r=e._poolsMap[a];r.length>i&&(r.length=i)}}},e.clearPool=function(t){if(void 0===t&&(t=null),null!==t){var i=e._poolsMap[String(t)];i&&i.length&&(i.length=0)}else for(var a in e._poolsMap){var i=e._poolsMap[a];i.length=0}},e.borrowObject=function(t){var i=e._poolsMap[String(t)];if(i&&i.length>0){var a=i.pop();return a._isInPool=!1,a}var a=new t;return a._onClear(),a},e.prototype.returnToPool=function(){this._onClear(),e._returnObject(this)},e}();e._hashCode=0,e._defaultMaxCount=5e3,e._maxCountMap={},e._poolsMap={},t.BaseObject=e,__reflect(e.prototype,"dragonBones.BaseObject")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function e(){}return e._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},e._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;default:return 0}},e._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},e._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},e._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},e.parseDragonBonesData=function(e){return t.ObjectDataParser.getInstance().parseDragonBonesData(e)},e.parseTextureAtlasData=function(i,a){void 0===a&&(a=1);for(var r={},n=i[e.SUB_TEXTURE],s=0,o=n.length;o>s;s++){var l=n[s],h=l[e.NAME],_=new t.Rectangle,u=null;_.x=l[e.X]/a,_.y=l[e.Y]/a,_.width=l[e.WIDTH]/a,_.height=l[e.HEIGHT]/a,e.FRAME_WIDTH in l&&(u=new t.Rectangle,u.x=l[e.FRAME_X]/a,u.y=l[e.FRAME_Y]/a,u.width=l[e.FRAME_WIDTH]/a,u.height=l[e.FRAME_HEIGHT]/a),r[h]={region:_,frame:u,rotated:!1}}return r},e}();e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION_4_5="4.5",e.DATA_VERSION_5_0="5.0",e.DATA_VERSION_5_1="5.1",e.DATA_VERSION=e.DATA_VERSION_5_1,e.DATA_VERSIONS=[e.DATA_VERSION_4_0,e.DATA_VERSION_4_5,e.DATA_VERSION_5_0,e.DATA_VERSION_5_1],e.TEXTURE_ATLAS="textureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.USER_DATA="userData",e.ARMATURE="armature",e.BONE="bone",e.IK="ik",e.SLOT="slot",e.SKIN="skin",e.DISPLAY="display",e.ANIMATION="animation",e.Z_ORDER="zOrder",e.FFD="ffd",e.FRAME="frame",e.ACTIONS="actions",e.EVENTS="events",e.INTS="ints",e.FLOATS="floats",e.STRINGS="strings",e.TRANSFORM="transform",e.PIVOT="pivot",e.AABB="aabb",e.COLOR="color",e.VERSION="version",e.COMPATIBLE_VERSION="compatibleVersion",e.FRAME_RATE="frameRate",e.TYPE="type",e.SUB_TYPE="subType",e.NAME="name",e.PARENT="parent",e.TARGET="target",e.SHARE="share",e.PATH="path",e.LENGTH="length",e.DISPLAY_INDEX="displayIndex",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.INHERIT_REFLECTION="inheritReflection",e.INHERIT_ANIMATION="inheritAnimation",e.INHERIT_FFD="inheritFFD",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_TYPE="tweenType",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CURVE="curve",e.SOUND="sound",e.EVENT="event",e.ACTION="action",e.X="x",e.Y="y",e.ROTATION="r",e.SKEW="sk",e.SCALE_X="scX",e.SCALE_Y="scY",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.DEFAULT_ACTIONS="defaultActions",e.SKEW_X="skX",e.SKEW_Y="skY",e.Z="z",e.GOTO_AND_PLAY="gotoAndPlay",e.DEFAULT_NAME="__default",t.DataParser=e,__reflect(e.prototype,"dragonBones.DataParser")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(t,e,i,a,r,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===r&&(r=1),void 0===n&&(n=1),this.x=t,this.y=e,this.skew=i,this.rotation=a,this.scaleX=r,this.scaleY=n}return t.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew=this.skew-t.skew,this.rotation=this.rotation-t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},t.prototype.fromMatrix=function(e){var i=this.scaleX,a=this.scaleY,r=t.PI_Q;this.x=e.tx,this.y=e.ty,this.rotation=Math.atan(e.b/e.a);var n=Math.atan(-e.c/e.d);return this.scaleX=this.rotation>-r&&this.rotation<r?e.a/Math.cos(this.rotation):e.b/Math.sin(this.rotation),this.scaleY=n>-r&&r>n?e.d/Math.cos(n):-e.c/Math.sin(n),i>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),a>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,n-=Math.PI),this.skew=n-this.rotation,this},t.prototype.toMatrix=function(t){return 0!==this.skew||0!==this.rotation?(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY)):(t.a=this.scaleX,t.b=0,t.c=0,t.d=this.scaleY),t.tx=this.x,t.ty=this.y,this},t}();e.PI_D=2*Math.PI,e.PI_H=Math.PI/2,e.PI_Q=Math.PI/4,e.RAD_DEG=180/Math.PI,e.DEG_RAD=Math.PI/180,t.Transform=e,__reflect(e.prototype,"dragonBones.Transform")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e,__reflect(e.prototype,"dragonBones.Point")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(t,e,i,a,r,n){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=1),void 0===r&&(r=0),void 0===n&&(n=0),this.a=t,this.b=e,this.c=i,this.d=a,this.tx=r,this.ty=n}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,i=0,a=0,r=this.d*t.d,n=this.tx*t.a+t.tx,s=this.ty*t.d+t.ty;return(0!==this.b||0!==this.c)&&(e+=this.b*t.c,i+=this.b*t.d,a+=this.c*t.a,r+=this.c*t.b),(0!==t.b||0!==t.c)&&(i+=this.a*t.b,a+=this.d*t.c,n+=this.ty*t.c,s+=this.tx*t.b),this.a=e,this.b=i,this.c=a,this.d=r,this.tx=n,this.ty=s,this},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,a=this.d,r=this.tx,n=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===a?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,a=this.d=1/a,this.tx=-t*r,this.ty=-a*n),this;var s=t*a-e*i;if(0===s)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;s=1/s;var o=this.a=a*s;return e=this.b=-e*s,i=this.c=-i*s,a=this.d=t*s,this.tx=-(o*r+i*n),this.ty=-(e*r+a*n),this},t.prototype.transformPoint=function(t,e,i,a){void 0===a&&(a=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,a||(i.x+=this.tx,i.y+=this.ty)},t}();t.Matrix=e,__reflect(e.prototype,"dragonBones.Matrix")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(t,e,i,a,r,n,s,o){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===a&&(a=1),void 0===r&&(r=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=a,this.alphaOffset=r,this.redOffset=n,this.greenOffset=s,this.blueOffset=o}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.redOffset=t.redOffset,this.greenOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e,__reflect(e.prototype,"dragonBones.ColorTransform")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function a(){var i=null!==e&&e.apply(this,arguments)||this;return i._rawBones=[],i._cacheBones={},i._meshs={},i._slotChildActions={},i._weightSlotPose={},i._weightBonePoses={},i._weightBoneIndices={},i._data=null,i._armature=null,i._bone=null,i._slot=null,i._skin=null,i._mesh=null,i._animation=null,i._timeline=null,i._helpPoint=new t.Point,i._helpTransform=new t.Transform,i._helpMatrixA=new t.Matrix,i._helpMatrixB=new t.Matrix,i._helpColorTransform=new t.ColorTransform,i._actionFrames=[],i}return __extends(a,e),a._getBoolean=function(t,e,i){if(e in t){var a=t[e],r=typeof a;if("boolean"===r)return a;if("string"!==r)return!!a;switch(a){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},a._getNumber=function(t,e,i){if(e in t){var a=t[e];return null===a||"NaN"===a?i:+a||0}return i},a._getString=function(t,e,i){if(e in t){var a=t[e],r=typeof a;return"string"===r?a:String(a)}return i},a.prototype._getCurvePoint=function(t,e,i,a,r,n,s,o,l,h){var _=1-l,u=_*_,p=l*l,c=_*u,d=3*l*u,m=3*_*p,f=l*p;h.x=c*t+d*i+m*r+f*s,h.y=c*e+d*a+m*n+f*o},a.prototype._samplingEasingCurve=function(e,i){for(var a=e.length,r=new t.Point,n=-2,s=0,o=i.length;o>s;++s){for(var l=(s+1)/(o+1);(a>n+6?e[n+6]:1)<l;)n+=6;for(var h=n>=0&&a>n+6,_=h?e[n]:0,u=h?e[n+1]:0,p=e[n+2],c=e[n+3],d=e[n+4],m=e[n+5],f=h?e[n+6]:1,g=h?e[n+7]:1,y=0,v=1;v-y>.01;){var D=(v+y)/2;this._getCurvePoint(_,u,p,c,d,m,f,g,D,r),l-r.x>0?y=D:v=D}i[s]=r.y}},a.prototype._sortActionFrame=function(t,e){return t.frameStart>e.frameStart?1:-1},a.prototype._parseActionDataInFrame=function(t,e,i,r){a.EVENT in t&&this._mergeActionFrame(t[a.EVENT],e,10,i,r),a.SOUND in t&&this._mergeActionFrame(t[a.SOUND],e,11,i,r),a.ACTION in t&&this._mergeActionFrame(t[a.ACTION],e,0,i,r),a.DEFAULT_ACTIONS in t&&this._mergeActionFrame(t[a.DEFAULT_ACTIONS],0,e,i,r),a.ACTIONS in t&&this._mergeActionFrame(t[a.ACTIONS],e,0,i,r),a.EVENTS in t&&this._mergeActionFrame(t[a.EVENTS],e,10,i,r)},a.prototype._mergeActionFrame=function(t,e,a,r,n){var s=this._armature.actions.length,o=this._parseActionData(t,this._armature.actions,a,r,n),l=null;0===this._actionFrames.length&&(l=new i,l.frameStart=0,this._actionFrames.push(l),l=null);for(var h=0,_=this._actionFrames;h<_.length;h++){var u=_[h];if(u.frameStart===e){l=u;break}}null===l&&(l=new i,l.frameStart=e,this._actionFrames.push(l));for(var p=0;o>p;++p)l.actions.push(s+p)},a.prototype._parseCacheActionFrame=function(t){var e=this._data.frameArray,i=e.length,a=t.actions.length;e.length+=2+a,e[i+0]=t.frameStart,e[i+0+1]=a;for(var r=0;a>r;++r)e[i+0+2+r]=t.actions[r];return i},a.prototype._parseArmature=function(e,i){var r=t.BaseObject.borrowObject(t.ArmatureData);if(r.isRightTransform=a.DATA_VERSIONS.indexOf(this._data.version)>a.DATA_VERSIONS.indexOf(a.DATA_VERSION_4_5),r.name=a._getString(e,a.NAME,""),r.frameRate=a._getNumber(e,a.FRAME_RATE,this._data.frameRate),r.scale=i,a.TYPE in e&&"string"==typeof e[a.TYPE]?r.type=a._getArmatureType(e[a.TYPE]):r.type=a._getNumber(e,a.TYPE,0),a.AABB in e){var n=e[a.AABB];r.aabb.x=a._getNumber(n,a.X,0),r.aabb.y=a._getNumber(n,a.Y,0),r.aabb.width=a._getNumber(n,a.WIDTH,0),r.aabb.height=a._getNumber(n,a.HEIGHT,0)}if(0===r.frameRate&&(r.frameRate=24),this._armature=r,a.BONE in e)for(var s=e[a.BONE],o=0,l=s;o<l.length;o++){var h=l[o],_=a._getString(h,a.PARENT,""),u=this._parseBone(h);if(_.length>0){var p=r.getBone(_);null!==p?u.parent=p:(this._cacheBones[_]=this._cacheBones[_]||[]).push(u)}if(u.name in this._cacheBones){for(var c=0,d=this._cacheBones[u.name];c<d.length;c++){var m=d[c];m.parent=u}delete this._cacheBones[u.name]}r.addBone(u),this._rawBones.push(u)}if(a.IK in e)for(var f=e[a.IK],g=0,y=f;g<y.length;g++){var v=y[g];this._parseIKConstraint(v)}if(r.sortBones(),a.SLOT in e)for(var D=e[a.SLOT],T=0,b=0,E=D;b<E.length;b++){var A=E[b];r.addSlot(this._parseSlot(A,T++))}if(r.sortSlots(),a.SKIN in e)for(var O=e[a.SKIN],x=0,S=O;x<S.length;x++){var B=S[x];r.addSkin(this._parseSkin(B))}if(a.ANIMATION in e)for(var P=e[a.ANIMATION],M=0,R=P;M<R.length;M++){var C=R[M];r.addAnimation(this._parseAnimation(C))}a.DEFAULT_ACTIONS in e&&this._parseActionData(e[a.DEFAULT_ACTIONS],r.defaultActions,0,null,null),a.ACTIONS in e&&this._parseActionData(e[a.ACTIONS],r.actions,0,null,null);for(var I=0,w=r.defaultActions;I<w.length;I++){var F=w[I];if(0===F.type){var N=r.getAnimation(F.name);null!==N&&(r.defaultAnimation=N);break}}this._rawBones.length=0,this._armature=null;for(var k in this._meshs)delete this._meshs[k];for(var k in this._cacheBones)delete this._cacheBones[k];for(var k in this._slotChildActions)delete this._slotChildActions[k];for(var k in this._weightSlotPose)delete this._weightSlotPose[k];for(var k in this._weightBonePoses)delete this._weightBonePoses[k];for(var k in this._weightBoneIndices)delete this._weightBoneIndices[k];return r},a.prototype._parseBone=function(e){var i=t.BaseObject.borrowObject(t.BoneData);return i.inheritTranslation=a._getBoolean(e,a.INHERIT_TRANSLATION,!0),i.inheritRotation=a._getBoolean(e,a.INHERIT_ROTATION,!0),i.inheritScale=a._getBoolean(e,a.INHERIT_SCALE,!0),i.inheritReflection=a._getBoolean(e,a.INHERIT_REFLECTION,!0),i.length=a._getNumber(e,a.LENGTH,0)*this._armature.scale,i.name=a._getString(e,a.NAME,""),a.TRANSFORM in e&&this._parseTransform(e[a.TRANSFORM],i.transform),i},a.prototype._parseIKConstraint=function(e){var i=this._armature.getBone(a._getString(e,a.BONE in e?a.BONE:a.NAME,""));if(null!==i){var r=this._armature.getBone(a._getString(e,a.TARGET,""));if(null!==r){var n=t.BaseObject.borrowObject(t.IKConstraintData);n.bendPositive=a._getBoolean(e,a.BEND_POSITIVE,!0),n.scaleEnabled=a._getBoolean(e,a.SCALE,!1),n.weight=a._getNumber(e,a.WEIGHT,1),n.bone=i,n.target=r;var s=a._getNumber(e,a.CHAIN,0);s>0&&(n.root=i.parent),i.constraints.push(n)}}},a.prototype._parseSlot=function(e,i){var r=t.BaseObject.borrowObject(t.SlotData);if(r.displayIndex=a._getNumber(e,a.DISPLAY_INDEX,0),r.zOrder=a._getNumber(e,a.Z,i),r.name=a._getString(e,a.NAME,""),r.parent=this._armature.getBone(a._getString(e,a.PARENT,"")),a.BLEND_MODE in e&&"string"==typeof e[a.BLEND_MODE]?r.blendMode=a._getBlendMode(e[a.BLEND_MODE]):r.blendMode=a._getNumber(e,a.BLEND_MODE,0),a.COLOR in e?(r.color=t.SlotData.createColor(),this._parseColorTransform(e[a.COLOR],r.color)):r.color=t.SlotData.DEFAULT_COLOR,a.ACTIONS in e){var n=this._slotChildActions[r.name]=[];this._parseActionData(e[a.ACTIONS],n,0,null,null)}return r},a.prototype._parseSkin=function(e){var i=t.BaseObject.borrowObject(t.SkinData);if(i.name=a._getString(e,a.NAME,a.DEFAULT_NAME),0===i.name.length&&(i.name=a.DEFAULT_NAME),this._skin=i,a.SLOT in e){var r=e[a.SLOT];if(r instanceof Array)for(var n=0,s=r;n<s.length;n++){var o=s[n],l=a._getString(o,a.NAME,"");if(this._slot=this._armature.getSlot(l),a.DISPLAY in o)for(var h=0,_=o[a.DISPLAY];h<_.length;h++){var u=_[h];i.addDisplay(l,this._parseDisplay(u))}this._slot=null}else for(var p in r){this._slot=this._armature.getSlot(p);for(var c=0,d=r[p];c<d.length;c++){var u=d[c];i.addDisplay(p,this._parseDisplay(u))}this._slot=null}}return this._skin=null,i},a.prototype._parseDisplay=function(e){var i=null,r=a._getString(e,a.NAME,""),n=0;switch(n=a.TYPE in e&&"string"==typeof e[a.TYPE]?a._getDisplayType(e[a.TYPE]):a._getNumber(e,a.TYPE,n)){case 0:var s=i=t.BaseObject.borrowObject(t.ImageDisplayData);s.name=r,this._parsePivot(e,s);break;case 1:var o=i=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(o.name=r,o.inheritAnimation=!0,a.ACTIONS in e)this._parseActionData(e[a.ACTIONS],o.actions,0,null,null);else if(this._slot.name in this._slotChildActions){var l=this._skin.getDisplays(this._slot.name);if(null===l?0===this._slot.displayIndex:this._slot.displayIndex===l.length){for(var h=0,_=this._slotChildActions[this._slot.name];h<_.length;h++){var u=_[h];o.actions.push(u)}delete this._slotChildActions[this._slot.name]}}break;case 2:var p=a._getString(e,a.SHARE,""),c=i=t.BaseObject.borrowObject(t.MeshDisplayData);if(c.name=r,c.inheritAnimation=a._getBoolean(e,a.INHERIT_FFD,!0),c.textureName=a._getString(e,a.PATH,""),this._parsePivot(e,c),p.length>0){var d=this._meshs[p];c.offset=d.offset,c.weight=d.weight}else this._parseMesh(e,c);0===c.textureName.length&&(c.textureName=r),0===p.length&&(this._meshs[c.name]=c);break;case 3:var m=this._parseBoundingBox(e);if(null!==m){var f=i=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);f.name=r,f.boundingBox=m}}return null!==i&&(i.parent=this._armature,a.TRANSFORM in e&&this._parseTransform(e[a.TRANSFORM],i.transform)),i},a.prototype._parsePivot=function(t,e){if(e.isRelativePivot=this._isOldData?!1:!0,a.PIVOT in t){var i=t[a.PIVOT];e.pivot.x=a._getNumber(i,a.X,0),e.pivot.y=a._getNumber(i,a.Y,0)}else e.pivot.x=.5,e.pivot.y=.5},a.prototype._parseMesh=function(e,i){var r=e[a.VERTICES],n=e[a.UVS],s=e[a.TRIANGLES],o=this._data.intArray,l=this._data.floatArray,h=Math.floor(r.length/2),_=Math.floor(s.length/3),u=l.length,p=u+2*h;i.offset=o.length,o.length+=4+3*_,o[i.offset+0]=h,o[i.offset+1]=_,o[i.offset+2]=u;for(var c=0,d=3*_;d>c;++c)o[i.offset+4+c]=s[c];l.length+=2*h+2*h;for(var c=0,d=2*h;d>c;++c)l[u+c]=r[c],l[p+c]=n[c];if(a.WEIGHTS in e){var m=e[a.SLOT_POSE],f=e[a.BONE_POSE],g=e[a.WEIGHTS],y=t.BaseObject.borrowObject(t.WeightData),v=new Array,D=Math.floor(f.length/7),T=l.length;y.count=(g.length-h)/2,y.offset=o.length,y.bones.length=D,v.length=D,o.length+=2+D+y.count,o[y.offset+1]=T;for(var c=0;D>c;++c){var b=f[7*c],E=this._rawBones[b];o[y.offset+2+c]=this._armature.sortedBones.indexOf(E),y.bones[c]=E,v[c]=b}l.length+=3*y.count,this._helpMatrixA.copyFromArray(m,0);for(var c=0,A=0,O=y.offset+2+D,x=T;h>c;++c){var S=2*c,B=o[O++]=g[A++],P=l[u+S],M=l[u+S+1];this._helpMatrixA.transformPoint(P,M,this._helpPoint),P=this._helpPoint.x,M=this._helpPoint.y;for(var R=0;B>R;++R){var b=g[A++],E=this._rawBones[b];this._helpMatrixB.copyFromArray(f,7*v.indexOf(b)+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(P,M,this._helpPoint),o[O++]=y.bones.indexOf(E),l[x++]=g[A++],l[x++]=this._helpPoint.x,l[x++]=this._helpPoint.y}}i.weight=y,this._weightSlotPose[i.name]=m,this._weightBonePoses[i.name]=f,this._weightBoneIndices[i.name]=v}},a.prototype._parseBoundingBox=function(e){var i=null,r=0;switch(r=a.SUB_TYPE in e&&"string"==typeof e[a.SUB_TYPE]?a._getBoundingBoxType(e[a.SUB_TYPE]):a._getNumber(e,a.SUB_TYPE,r)){case 0:i=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:i=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:i=this._parsePolygonBoundingBox(e)}return null!==i&&(i.color=a._getNumber(e,a.COLOR,0),(0===i.type||1===i.type)&&(i.width=a._getNumber(e,a.WIDTH,0),i.height=a._getNumber(e,a.HEIGHT,0))),i},a.prototype._parsePolygonBoundingBox=function(e){var i=e[a.VERTICES],r=this._data.floatArray,n=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);n.offset=r.length,n.count=i.length,n.vertices=r,r.length+=n.count;for(var s=0,o=n.count;o>s;s+=2){var l=s+1,h=i[s],_=i[l];r[n.offset+s]=h,r[n.offset+l]=_,0===s?(n.x=h,n.y=_,n.width=h,n.height=_):(h<n.x?n.x=h:h>n.width&&(n.width=h),_<n.y?n.y=_:_>n.height&&(n.height=_))}return n},a.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);if(i.frameCount=Math.max(a._getNumber(e,a.DURATION,1),1),i.playTimes=a._getNumber(e,a.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=a._getNumber(e,a.FADE_IN_TIME,0),i.scale=a._getNumber(e,a.SCALE,1),i.name=a._getString(e,a.NAME,a.DEFAULT_NAME),i.name.length<1&&(i.name=a.DEFAULT_NAME),i.frameIntOffset=this._data.frameIntArray.length,i.frameFloatOffset=this._data.frameFloatArray.length,i.frameOffset=this._data.frameArray.length,this._animation=i,a.FRAME in e){var r=e[a.FRAME],n=r.length;if(n>0)for(var s=0,o=0;n>s;++s){var l=r[s];this._parseActionDataInFrame(l,o,null,null),o+=a._getNumber(l,a.DURATION,1)}}if(a.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[a.Z_ORDER],1,!1,!1,0,this._parseZOrderFrame)),a.BONE in e)for(var h=e[a.BONE],_=0,u=h;_<u.length;_++){var p=u[_];this._parseBoneTimeline(p)}if(a.SLOT in e)for(var h=e[a.SLOT],c=0,d=h;c<d.length;c++){var p=d[c];this._parseSlotTimeline(p)}if(a.FFD in e)for(var h=e[a.FFD],m=0,f=h;m<f.length;m++){var p=f[m],g=a._getString(p,a.SLOT,""),y=a._getString(p,a.NAME,""),v=this._armature.getSlot(g);if(null!==v){this._slot=v,this._mesh=this._meshs[y];var D=this._parseTimeline(p,22,!1,!0,0,this._parseSlotFFDFrame);null!==D&&this._animation.addSlotTimeline(v,D),this._slot=null,this._mesh=null}}if(this._actionFrames.length>0){this._actionFrames.sort(this._sortActionFrame);var T=this._animation.actionTimeline=t.BaseObject.borrowObject(t.TimelineData),b=this._data.timelineArray,n=this._actionFrames.length;if(T.type=0,T.offset=b.length,b.length+=5+n,b[T.offset+0]=100,b[T.offset+1]=0,b[T.offset+2]=n,b[T.offset+3]=0,b[T.offset+4]=0,this._timeline=T,1===n)T.frameIndicesOffset=-1,b[T.offset+5+0]=this._parseCacheActionFrame(this._actionFrames[0])-this._animation.frameOffset;else{var E=this._data.frameIndices,A=this._animation.frameCount+1;T.frameIndicesOffset=E.length,E.length+=A;for(var s=0,O=0,o=0,x=0;A>s;++s){if(s>=o+x&&n>O){var S=this._actionFrames[O];o=S.frameStart,x=O===n-1?this._animation.frameCount-o:this._actionFrames[O+1].frameStart-o,b[T.offset+5+O]=this._parseCacheActionFrame(S)-this._animation.frameOffset,O++}E[T.frameIndicesOffset+s]=O-1}}this._timeline=null}return this._animation=null,this._actionFrames.length=0,i},a.prototype._parseTimeline=function(e,i,r,n,s,o){var l=e[a.FRAME],h=l.length;if(0===h)return null;var _=this._data.timelineArray,u=t.BaseObject.borrowObject(t.TimelineData);if(u.type=i,u.offset=_.length,_.length+=5+h,_[u.offset+0]=Math.round(100*a._getNumber(e,a.SCALE,1)),_[u.offset+1]=Math.round(100*a._getNumber(e,a.OFFSET,0)),_[u.offset+2]=h,_[u.offset+3]=s,r?_[u.offset+4]=this._data.frameIntArray.length-this._animation.frameIntOffset:n?_[u.offset+4]=this._data.frameFloatArray.length-this._animation.frameFloatOffset:_[u.offset+4]=0,this._timeline=u,1===h)u.frameIndicesOffset=-1,_[u.offset+5+0]=o.call(this,l[0],0,0)-this._animation.frameOffset;else{var p=this._data.frameIndices,c=this._animation.frameCount+1;u.frameIndicesOffset=p.length,p.length+=c;for(var d=0,m=0,f=0,g=0;c>d;++d){if(d>=f+g&&h>m){var y=l[m];f=d,g=a._getNumber(y,a.DURATION,1),m===h-1&&(g=this._animation.frameCount-f),_[u.offset+5+m]=o.call(this,y,f,g)-this._animation.frameOffset,m++}p[u.frameIndicesOffset+d]=m-1}}return this._timeline=null,u},a.prototype._parseBoneTimeline=function(t){var e=this._armature.getBone(a._getString(t,a.NAME,""));if(null!==e){this._bone=e;var i=this._parseTimeline(t,10,!1,!0,6,this._parseBoneFrame);null!==i&&this._animation.addBoneTimeline(e,i),this._bone=null}},a.prototype._parseSlotTimeline=function(t){var e=this._armature.getSlot(a._getString(t,a.NAME,""));if(null!==e){this._slot=e;var i=this._parseTimeline(t,20,!1,!1,0,this._parseSlotDisplayIndexFrame);null!==i&&this._animation.addSlotTimeline(e,i);var r=this._parseTimeline(t,21,!0,!1,1,this._parseSlotColorFrame);null!==r&&this._animation.addSlotTimeline(e,r),this._slot=null}},a.prototype._parseFrame=function(t,e,i,a){var r=a.length;return a.length+=1,a[r+0]=e,r},a.prototype._parseTweenFrame=function(t,e,i,r){var n=this._parseFrame(t,e,i,r);if(i>0)if(a.CURVE in t){var s=i+1,o=new Array(s);this._samplingEasingCurve(t[a.CURVE],o),r.length+=2+o.length,r[n+1]=2,r[n+2]=s;for(var l=0;s>l;++l)r[n+3+l]=Math.round(100*o[l])}else{var h=-2,_=h;a.TWEEN_EASING in t&&(_=a._getNumber(t,a.TWEEN_EASING,h)),_===h?(r.length+=1,r[n+1]=0):0===_?(r.length+=1,r[n+1]=1):0>_?(r.length+=2,r[n+1]=3,r[n+2]=Math.round(100*-_)):1>=_?(r.length+=2,r[n+1]=4,r[n+2]=Math.round(100*_)):(r.length+=2,r[n+1]=5,r[n+2]=Math.round(100*_-100))}else r.length+=1,r[n+1]=0;return n},a.prototype._parseZOrderFrame=function(t,e,i){var r=this._data.frameArray,n=this._parseFrame(t,e,i,r);if(a.Z_ORDER in t){var s=t[a.Z_ORDER];if(s.length>0){for(var o=this._armature.sortedSlots.length,l=new Array(o-s.length/2),h=new Array(o),_=0;o>_;++_)h[_]=-1;for(var u=0,p=0,c=0,d=s.length;d>c;c+=2){for(var m=s[c],f=s[c+1];u!==m;)l[p++]=u++;h[u+f]=u++}for(;o>u;)l[p++]=u++;r.length+=1+o,r[n+1]=o;for(var g=o;g--;)-1===h[g]?r[n+2+g]=l[--p]:r[n+2+g]=h[g]}}return n},a.prototype._parseBoneFrame=function(e,i,r){var n=this._data.frameFloatArray,s=this._data.frameArray,o=this._parseTweenFrame(e,i,r,s);if(a.TRANSFORM in e){var l=e[a.TRANSFORM];this._parseTransform(l,this._helpTransform)}else this._helpTransform.identity();var h=this._helpTransform.rotation;0!==i&&(0===this._prevTweenRotate?h=this._prevRotation+t.Transform.normalizeRadian(h-this._prevRotation):((this._prevTweenRotate>0?h>=this._prevRotation:h<=this._prevRotation)&&(this._prevTweenRotate=this._prevTweenRotate>0?this._prevTweenRotate-1:this._prevTweenRotate+1),h=this._prevRotation+h-this._prevRotation+t.Transform.PI_D*this._prevTweenRotate)),this._prevTweenRotate=a._getNumber(e,a.TWEEN_ROTATE,0),this._prevRotation=h;var _=n.length;return n.length+=6,n[_++]=this._helpTransform.x,n[_++]=this._helpTransform.y,n[_++]=h,n[_++]=this._helpTransform.skew,n[_++]=this._helpTransform.scaleX,n[_++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,i,this._bone,this._armature.getSlot(this._bone.name)),o},a.prototype._parseSlotDisplayIndexFrame=function(t,e,i){var r=this._data.frameArray,n=this._parseFrame(t,e,i,r);return r.length+=1,r[n+1]=a._getNumber(t,a.DISPLAY_INDEX,0),this._parseActionDataInFrame(t,e,this._slot.parent,this._slot),n},a.prototype._parseSlotColorFrame=function(t,e,i){var r=this._data.intArray,n=this._data.frameIntArray,s=this._data.frameArray,o=this._parseTweenFrame(t,e,i,s),l=-1;if(a.COLOR in t){var h=t[a.COLOR];for(var _ in h){this._parseColorTransform(h,this._helpColorTransform),l=r.length,r.length+=8,r[l++]=Math.round(100*this._helpColorTransform.alphaMultiplier),r[l++]=Math.round(100*this._helpColorTransform.redMultiplier),r[l++]=Math.round(100*this._helpColorTransform.greenMultiplier),r[l++]=Math.round(100*this._helpColorTransform.blueMultiplier),r[l++]=Math.round(this._helpColorTransform.alphaOffset),r[l++]=Math.round(this._helpColorTransform.redOffset),r[l++]=Math.round(this._helpColorTransform.greenOffset),r[l++]=Math.round(this._helpColorTransform.blueOffset),l-=8;break}}0>l&&(this._defalultColorOffset<0&&(this._defalultColorOffset=l=r.length,r.length+=8,r[l++]=100,r[l++]=100,r[l++]=100,r[l++]=100,r[l++]=0,r[l++]=0,r[l++]=0,r[l++]=0),l=this._defalultColorOffset);var u=n.length;return n.length+=1,n[u]=l,o},a.prototype._parseSlotFFDFrame=function(t,e,i){var r=this._data.intArray,n=this._data.frameFloatArray,s=this._data.frameArray,o=n.length,l=this._parseTweenFrame(t,e,i,s),h=a.VERTICES in t?t[a.VERTICES]:null,_=a._getNumber(t,a.OFFSET,0),u=this._data.intArray[this._mesh.offset+0],p=0,c=0,d=0,m=0;if(null!==this._mesh.weight){var f=this._weightSlotPose[this._mesh.name];this._helpMatrixA.copyFromArray(f,0),n.length+=2*this._mesh.weight.count,d=this._mesh.weight.offset+2+this._mesh.weight.bones.length}else n.length+=2*u;for(var g=0;2*u>g;g+=2)if(null===h?(p=0,c=0):(p=_>g||g-_>=h.length?0:h[g-_]*this._armature.scale,c=_>g+1||g+1-_>=h.length?0:h[g+1-_]*this._armature.scale),null!==this._mesh.weight){var y=this._weightBonePoses[this._mesh.name],v=this._weightBoneIndices[this._mesh.name],D=r[d++];this._helpMatrixA.transformPoint(p,c,this._helpPoint,!0),p=this._helpPoint.x,c=this._helpPoint.y;for(var T=0;D>T;++T){var b=r[d++],E=this._mesh.weight.bones[b],A=this._rawBones.indexOf(E);this._helpMatrixB.copyFromArray(y,7*v.indexOf(A)+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(p,c,this._helpPoint,!0),n[o+m++]=this._helpPoint.x,n[o+m++]=this._helpPoint.y}}else n[o+g]=p,n[o+g+1]=c;if(0===e){var O=this._data.frameIntArray,x=O.length;O.length+=5,O[x+0]=this._mesh.offset,O[x+1]=n.length-o,O[x+2]=n.length-o,O[x+3]=0,O[x+4]=o,this._data.timelineArray[this._timeline.offset+3]=x-this._animation.frameIntOffset}return l
},a.prototype._parseActionData=function(e,i,r,n,s){var o=0;if("string"==typeof e){var l=t.BaseObject.borrowObject(t.ActionData);l.type=r,l.name=e,l.bone=n,l.slot=s,i.push(l),o++}else if(e instanceof Array)for(var h=0,_=e;h<_.length;h++){var u=_[h],l=t.BaseObject.borrowObject(t.ActionData);if(a.GOTO_AND_PLAY in u?(l.type=0,l.name=a._getString(u,a.GOTO_AND_PLAY,"")):(a.TYPE in u&&"string"==typeof u[a.TYPE]?l.type=a._getActionType(u[a.TYPE]):l.type=a._getNumber(u,a.TYPE,r),l.name=a._getString(u,a.NAME,"")),a.BONE in u){var p=a._getString(u,a.BONE,"");l.bone=this._armature.getBone(p)}else l.bone=n;if(a.SLOT in u){var c=a._getString(u,a.SLOT,"");l.slot=this._armature.getSlot(c)}else l.slot=s;var d=null;if(d=a.USER_DATA in u?u[a.USER_DATA]:u,a.INTS in d){null===l.data&&(l.data=t.BaseObject.borrowObject(t.UserData));for(var m=d[a.INTS],f=0,g=m;f<g.length;f++){var y=g[f];l.data.ints.push(y)}}if(a.FLOATS in d){null===l.data&&(l.data=t.BaseObject.borrowObject(t.UserData));for(var v=d[a.FLOATS],D=0,T=v;D<T.length;D++){var y=T[D];l.data.floats.push(y)}}if(a.STRINGS in d){null===l.data&&(l.data=t.BaseObject.borrowObject(t.UserData));for(var b=d[a.STRINGS],E=0,A=b;E<A.length;E++){var y=A[E];l.data.strings.push(y)}}i.push(l),o++}return o},a.prototype._parseTransform=function(e,i){i.x=a._getNumber(e,a.X,0)*this._armature.scale,i.y=a._getNumber(e,a.Y,0)*this._armature.scale,a.ROTATION in e?(i.rotation=e[a.ROTATION]*t.Transform.DEG_RAD,i.skew=t.Transform.normalizeRadian(a._getNumber(e,a.SKEW,0)*t.Transform.DEG_RAD),i.scaleX=.01*a._getNumber(e,a.SCALE_X,100),i.scaleY=.01*a._getNumber(e,a.SCALE_Y,100)):(i.rotation=t.Transform.normalizeRadian(a._getNumber(e,a.SKEW_Y,0)*t.Transform.DEG_RAD),i.skew=t.Transform.normalizeRadian(a._getNumber(e,a.SKEW_X,0)*t.Transform.DEG_RAD)-i.rotation,i.scaleX=a._getNumber(e,a.SCALE_X,1),i.scaleY=a._getNumber(e,a.SCALE_Y,1))},a.prototype._parseColorTransform=function(t,e){e.alphaMultiplier=.01*a._getNumber(t,a.ALPHA_MULTIPLIER,100),e.redMultiplier=.01*a._getNumber(t,a.RED_MULTIPLIER,100),e.greenMultiplier=.01*a._getNumber(t,a.GREEN_MULTIPLIER,100),e.blueMultiplier=.01*a._getNumber(t,a.BLUE_MULTIPLIER,100),e.alphaOffset=a._getNumber(t,a.ALPHA_OFFSET,0),e.redOffset=a._getNumber(t,a.RED_OFFSET,0),e.greenOffset=a._getNumber(t,a.GREEN_OFFSET,0),e.blueOffset=a._getNumber(t,a.BLUE_OFFSET,0)},a.prototype._parseArray=function(t){this._data.intArray=[],this._data.floatArray=[],this._data.frameIntArray=[],this._data.frameFloatArray=[],this._data.frameArray=[],this._data.timelineArray=[]},a.prototype.parseDragonBonesData=function(e,i){void 0===i&&(i=1),t.DragonBones.assert(null!==e&&void 0!==e);var r=a._getString(e,a.VERSION,""),n=a._getString(e,a.COMPATIBLE_VERSION,"");if(a.DATA_VERSIONS.indexOf(r)>=0||a.DATA_VERSIONS.indexOf(n)>=0){var s=t.BaseObject.borrowObject(t.DragonBonesData);if(s.version=r,s.name=a._getString(e,a.NAME,""),s.frameRate=a._getNumber(e,a.FRAME_RATE,24),0===s.frameRate&&(s.frameRate=24),a.ARMATURE in e){this._isOldData=s.version===a.DATA_VERSION_2_3||r===a.DATA_VERSION_3_0,this._defalultColorOffset=-1,this._data=s,this._parseArray(e);for(var o=e[a.ARMATURE],l=0,h=o;l<h.length;l++){var _=h[l];s.addArmature(this._parseArmature(_,i))}this._data=null}return s}return t.DragonBones.assert(!1,"Nonsupport data version."),null},a.prototype.parseTextureAtlasData=function(e,i,r){if(void 0===r&&(r=0),t.DragonBones.assert(null!==e&&void 0!==e),i.name=a._getString(e,a.NAME,""),i.imagePath=a._getString(e,a.IMAGE_PATH,""),i.width=a._getNumber(e,a.WIDTH,0),i.height=a._getNumber(e,a.HEIGHT,0),r>0?i.scale=r:r=i.scale=a._getNumber(e,a.SCALE,i.scale),r=1/r,a.SUB_TEXTURE in e)for(var n=e[a.SUB_TEXTURE],s=0,o=n.length;o>s;++s){var l=n[s],h=i.createTexture();h.name=a._getString(l,a.NAME,""),h.rotated=a._getBoolean(l,a.ROTATED,!1),h.region.x=a._getNumber(l,a.X,0)*r,h.region.y=a._getNumber(l,a.Y,0)*r,h.region.width=a._getNumber(l,a.WIDTH,0)*r,h.region.height=a._getNumber(l,a.HEIGHT,0)*r;var _=a._getNumber(l,a.FRAME_WIDTH,-1),u=a._getNumber(l,a.FRAME_HEIGHT,-1);_>0&&u>0&&(h.frame=t.TextureData.createRectangle(),h.frame.x=a._getNumber(l,a.FRAME_X,0)*r,h.frame.y=a._getNumber(l,a.FRAME_Y,0)*r,h.frame.width=_*r,h.frame.height=u*r),i.addTexture(h)}},a.getInstance=function(){return null===a._instance&&(a._instance=new a),a._instance},a}(t.DataParser);e._instance=null,t.ObjectDataParser=e,__reflect(e.prototype,"dragonBones.ObjectDataParser");var i=function(){function t(){this.frameStart=0,this.actions=[]}return t}();__reflect(i.prototype,"ActionFrame")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.textures={},t}return __extends(i,e),i.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.scale=1,this.width=0,this.height=0,this.name="",this.imagePath=""},i.prototype.addTexture=function(e){e.name in this.textures&&(t.DragonBones.warn("Replace texture: "+e.name),this.textures[e.name].returnToPool()),e.parent=this,this.textures[e.name]=e},i.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},i.prototype.copyFrom=function(t){this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath;for(var e in this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.createTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},i}(t.BaseObject);t.TextureAtlasData=e,__reflect(e.prototype,"dragonBones.TextureAtlasData");var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.region=new t.Rectangle,i.frame=null,i}return __extends(i,e),i.createRectangle=function(){return new t.Rectangle},i.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},i.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,null===this.frame&&null!==t.frame?this.frame=i.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame),this.parent=t.parent,this.region.copyFrom(t.region)},i}(t.BaseObject);t.TextureData=i,__reflect(i.prototype,"dragonBones.TextureData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._rawTextureAtlases=null,t}return __extends(i,e),i.prototype._inRange=function(t,e,i){return t>=e&&i>=t},i.prototype._decodeUTF8=function(t){for(var e,i=-1,a=-1,r=65533,n=0,s="",o=0,l=0,h=0,_=0;t.length>n;){var u=t[n++];if(u===i)e=0!==l?r:a;else if(0===l)this._inRange(u,0,127)?e=u:(this._inRange(u,194,223)?(l=1,_=128,o=u-192):this._inRange(u,224,239)?(l=2,_=2048,o=u-224):this._inRange(u,240,244)&&(l=3,_=65536,o=u-240),o*=Math.pow(64,l),e=null);else if(this._inRange(u,128,191))if(h+=1,o+=(u-128)*Math.pow(64,l-h),h!==l)e=null;else{var p=o,c=_;o=0,l=0,h=0,_=0,e=this._inRange(p,c,1114111)&&!this._inRange(p,55296,57343)?p:u}else o=0,l=0,h=0,_=0,n--,e=u;null!==e&&e!==a&&(65535>=e?e>0&&(s+=String.fromCharCode(e)):(e-=65536,s+=String.fromCharCode(55296+(e>>10&1023)),s+=String.fromCharCode(56320+(1023&e))))}return s},i.prototype._parseBinaryTimeline=function(e,i,a){void 0===a&&(a=null);var r=this._data.timelineArray,n=null!==a?a:t.BaseObject.borrowObject(t.TimelineData);n.type=e,n.offset=i,this._timeline=n;var s=r[n.offset+2];if(1===s)n.frameIndicesOffset=-1;else{var o=this._data.frameArray,l=this._data.frameIndices,h=this._animation.frameCount+1;n.frameIndicesOffset=l.length,l.length+=h;for(var _=0,u=0,p=0,c=0;h>_;++_)_>=p+c&&s>u&&(p=o[this._animation.frameOffset+r[n.offset+5+u]],c=u===s-1?this._animation.frameCount-p:o[this._animation.frameOffset+r[n.offset+5+u+1]]-p,u++),l[n.frameIndicesOffset+_]=u-1}return this._timeline=null,n},i.prototype._parseMesh=function(e,i){var a=this._data.intArray;i.offset=e[t.ObjectDataParser.OFFSET];var r=a[i.offset+3];if(r>=0){var n=t.BaseObject.borrowObject(t.WeightData);n.offset=r;var s=a[n.offset+0];n.bones.length=s;for(var o=0;s>o;++o){var l=a[n.offset+2+o];n.bones[o]=this._rawBones[l]}for(var h=n.offset+2+s,o=0,_=a[i.offset];_>o;++o){var u=a[h++];n.count+=u,h+=u}i.weight=n}},i.prototype._parsePolygonBoundingBox=function(e){var i=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);return i.offset=e[t.ObjectDataParser.OFFSET],i.vertices=this._data.floatArray,i},i.prototype._parseAnimation=function(e){var i=t.BaseObject.borrowObject(t.AnimationData);i.frameCount=Math.max(t.ObjectDataParser._getNumber(e,t.ObjectDataParser.DURATION,1),1),i.playTimes=t.ObjectDataParser._getNumber(e,t.ObjectDataParser.PLAY_TIMES,1),i.duration=i.frameCount/this._armature.frameRate,i.fadeInTime=t.ObjectDataParser._getNumber(e,t.ObjectDataParser.FADE_IN_TIME,0),i.scale=t.ObjectDataParser._getNumber(e,t.ObjectDataParser.SCALE,1),i.name=t.ObjectDataParser._getString(e,t.ObjectDataParser.NAME,t.ObjectDataParser.DEFAULT_NAME),0===i.name.length&&(i.name=t.ObjectDataParser.DEFAULT_NAME);var a=e[t.ObjectDataParser.OFFSET];if(i.frameIntOffset=a[0],i.frameFloatOffset=a[1],i.frameOffset=a[2],this._animation=i,t.ObjectDataParser.ACTION in e&&(i.actionTimeline=this._parseBinaryTimeline(0,e[t.ObjectDataParser.ACTION])),t.ObjectDataParser.Z_ORDER in e&&(i.zOrderTimeline=this._parseBinaryTimeline(1,e[t.ObjectDataParser.Z_ORDER])),t.ObjectDataParser.BONE in e){var r=e[t.ObjectDataParser.BONE];for(var n in r){var s=this._armature.getBone(n);if(null!==s)for(var o=r[n],l=0,h=o.length;h>l;l+=2){var _=o[l],u=o[l+1],p=this._parseBinaryTimeline(_,u);this._animation.addBoneTimeline(s,p)}}}if(t.ObjectDataParser.SLOT in e){var r=e[t.ObjectDataParser.SLOT];for(var n in r){var c=this._armature.getSlot(n);if(null!==c)for(var o=r[n],l=0,h=o.length;h>l;l+=2){var _=o[l],u=o[l+1];if(22===_){var p=this._parseBinaryTimeline(_,u);this._animation.addSlotTimeline(c,p)}else{var p=this._parseBinaryTimeline(_,u);this._animation.addSlotTimeline(c,p)}}}}return this._animation=null,i},i.prototype._parseArray=function(e){var i=e[t.ObjectDataParser.OFFSET];this._data.intArray=new Int16Array(this._binary,this._binaryOffset+i[0],i[1]/Int16Array.BYTES_PER_ELEMENT),this._data.floatArray=new Float32Array(this._binary,this._binaryOffset+i[2],i[3]/Float32Array.BYTES_PER_ELEMENT),this._data.frameIntArray=new Int16Array(this._binary,this._binaryOffset+i[4],i[5]/Int16Array.BYTES_PER_ELEMENT),this._data.frameFloatArray=new Float32Array(this._binary,this._binaryOffset+i[6],i[7]/Float32Array.BYTES_PER_ELEMENT),this._data.frameArray=new Int16Array(this._binary,this._binaryOffset+i[8],i[9]/Int16Array.BYTES_PER_ELEMENT),this._data.timelineArray=new Uint16Array(this._binary,this._binaryOffset+i[10],i[11]/Uint16Array.BYTES_PER_ELEMENT)},i.prototype.parseDragonBonesData=function(i,a){void 0===a&&(a=1),t.DragonBones.assert(null!==i&&void 0!==i&&i instanceof ArrayBuffer);var r=new Uint8Array(i,0,8);if(r[0]!=="D".charCodeAt(0)||r[1]!=="B".charCodeAt(0)||r[2]!=="D".charCodeAt(0)||r[3]!=="T".charCodeAt(0))return t.DragonBones.assert(!1,"Nonsupport data"),null;var n=new Uint32Array(i,8,1)[0],s=new Uint8Array(i,12,n),o=this._decodeUTF8(s),l=JSON.parse(o);this._binary=i,this._binaryOffset=12+n;var h=e.prototype.parseDragonBonesData.call(this,l,a);return t.ObjectDataParser.TEXTURE_ATLAS in l&&(this._rawTextureAtlases=l[t.ObjectDataParser.TEXTURE_ATLAS]),h},i.prototype.parseTextureAtlasData=function(t,i,a){if(void 0===a&&(a=0),null!==this._rawTextureAtlases){var r=this._rawTextureAtlases.shift();e.prototype.parseTextureAtlasData.call(this,r,i,a),0===this._rawTextureAtlases.length&&(this._rawTextureAtlases=null)}},i}(t.ObjectDataParser);t.BinaryDataParser=e,__reflect(e.prototype,"dragonBones.BinaryDataParser")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return __extends(i,e),i.prototype._onClear=function(){this.name="",this.global.identity(),this.offset.identity(),this.globalTransformMatrix.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null,this._parent=null},i.prototype._setArmature=function(t){this._armature=t},i.prototype._setParent=function(t){this._parent=t},i.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i}(t.BaseObject);e._helpMatrix=new t.Matrix,e._helpTransform=new t.Transform,e._helpPoint=new t.Point,t.TransformObject=e,__reflect(e.prototype,"dragonBones.TransformObject")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.texture=null,t}return __extends(a,e),a.toString=function(){return"[class dragonBones.EgretTextureAtlasData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),null!==this.texture,this.texture=null},a.prototype.createTexture=function(){return t.BaseObject.borrowObject(i)},a.prototype.dispose=function(){this.returnToPool()},a}(t.TextureAtlasData);t.EgretTextureAtlasData=e,__reflect(e.prototype,"dragonBones.EgretTextureAtlasData");var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.texture=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.EgretTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.texture,this.texture=null},e}(t.TextureData);t.EgretTextureData=i,__reflect(i.prototype,"dragonBones.EgretTextureData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.data=null,this.armature=null,this.bone=null,this.slot=null,this.animationState=null},e}(t.BaseObject);e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",t.EventObject=e,__reflect(e.prototype,"dragonBones.EventObject")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationName",{get:function(){var t=this.eventObject.animationState;return null!==t?t.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),e}(egret.Event);e.START=t.EventObject.START,e.LOOP_COMPLETE=t.EventObject.LOOP_COMPLETE,e.COMPLETE=t.EventObject.COMPLETE,e.FADE_IN=t.EventObject.FADE_IN,e.FADE_IN_COMPLETE=t.EventObject.FADE_IN_COMPLETE,e.FADE_OUT=t.EventObject.FADE_OUT,e.FADE_OUT_COMPLETE=t.EventObject.FADE_OUT_COMPLETE,e.FRAME_EVENT=t.EventObject.FRAME_EVENT,e.SOUND_EVENT=t.EventObject.SOUND_EVENT,e.ANIMATION_FRAME_EVENT=t.EventObject.FRAME_EVENT,e.BONE_FRAME_EVENT=t.EventObject.FRAME_EVENT,e.MOVEMENT_FRAME_EVENT=t.EventObject.FRAME_EVENT,e.SOUND=t.EventObject.SOUND_EVENT,t.EgretEvent=e,__reflect(e.prototype,"dragonBones.EgretEvent");var i=function(i){function a(){var t=null!==i&&i.apply(this,arguments)||this;return t._batchEnabled=!1,t._disposeProxy=!1,t._armature=null,t._debugDrawer=null,t}return __extends(a,i),a._cleanBeforeRender=function(){},a.prototype._dispatchEvent=function(t,a){var r=egret.Event.create(e,t);r.data=a,i.prototype.dispatchEvent.call(this,r),egret.Event.release(r)},a.prototype._debugDraw=function(t){if(t){null===this._debugDrawer&&(this._debugDrawer=new egret.Sprite),this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var e=0,i=this._armature.getBones();e<i.length;e++){var a=i[e],r=a.boneData.length,n=a.globalTransformMatrix.tx,s=a.globalTransformMatrix.ty,o=n+a.globalTransformMatrix.a*r,l=s+a.globalTransformMatrix.b*r;this._debugDrawer.graphics.lineStyle(2,65535,.7),this._debugDrawer.graphics.moveTo(n,s),this._debugDrawer.graphics.lineTo(o,l),this._debugDrawer.graphics.lineStyle(0,0,0),this._debugDrawer.graphics.beginFill(65535,.7),this._debugDrawer.graphics.drawCircle(n,s,3),this._debugDrawer.graphics.endFill()}for(var h=0,_=this._armature.getSlots();h<_.length;h++){var u=_[h],p=u.boundingBoxData;if(null!==p){var c=this._debugDrawer.getChildByName(u.name);switch(null===c&&(c=new egret.Shape,c.name=u.name,this._debugDrawer.addChild(c)),c.graphics.clear(),c.graphics.beginFill(p.color?p.color:16711935,.3),p.type){case 0:c.graphics.drawRect(.5*-p.width,.5*-p.height,p.width,p.height);break;case 1:c.graphics.drawEllipse(.5*-p.width,.5*-p.height,p.width,p.height);break;case 2:for(var d=p,m=d.vertices,f=0;f<d.count;f+=2)0===f?c.graphics.moveTo(m[d.offset+f],m[d.offset+f+1]):c.graphics.lineTo(m[d.offset+f],m[d.offset+f+1])}c.graphics.endFill(),u.updateTransformAndMatrix(),u.updateGlobalTransform(),c.$setMatrix(u.globalTransformMatrix,!1)}else{var c=this._debugDrawer.getChildByName(u.name);null!==c&&this._debugDrawer.removeChild(c)}}}else null!==this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)},a.prototype.init=function(t){this._armature=t},a.prototype.clear=function(){this._disposeProxy=!1,this._armature=null,this._debugDrawer=null},a.prototype.dispose=function(t){void 0===t&&(t=!0),this._disposeProxy=t,null!==this._armature&&(this._armature.dispose(),this._armature=null)},a.prototype.hasEvent=function(t){return this.hasEventListener(t)},a.prototype.addEvent=function(t,e,i){this.addEventListener(t,e,i)},a.prototype.removeEvent=function(t,e,i){this.removeEventListener(t,e,i)},Object.defineProperty(a.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),a.prototype.advanceTimeBySelf=function(e){e?this._armature.clock=t.EgretFactory.clock:this._armature.clock=null},a}(egret.DisplayObjectContainer);t.EgretArmatureDisplay=i,__reflect(i.prototype,"dragonBones.EgretArmatureDisplay",["dragonBones.IArmatureDisplay","dragonBones.IArmatureProxy","dragonBones.IEventDispatcher"]);var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.Event=a,__reflect(a.prototype,"dragonBones.Event");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.ArmatureEvent=r,__reflect(r.prototype,"dragonBones.ArmatureEvent");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.AnimationEvent=n,__reflect(n.prototype,"dragonBones.AnimationEvent");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.FrameEvent=s,__reflect(s.prototype,"dragonBones.FrameEvent");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.SoundEvent=o,__reflect(o.prototype,"dragonBones.SoundEvent");var l=function(e){function i(i,a,r){void 0===r&&(r=1);var n=e.call(this)||this;return n._onClear(),n.texture=i,t.ObjectDataParser.getInstance().parseTextureAtlasData(a,n,r),n}return __extends(i,e),i.toString=function(){return"[class dragonBones.EgretTextureAtlas]"},i}(t.EgretTextureAtlasData);t.EgretTextureAtlas=l,__reflect(l.prototype,"dragonBones.EgretTextureAtlas");var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(l);t.EgretSheetAtlas=h,__reflect(h.prototype,"dragonBones.EgretSheetAtlas");var _=function(){function e(){}return e.getInstance=function(){return t.EgretFactory.factory.soundEventManager},e}();t.SoundEventManager=_,__reflect(_.prototype,"dragonBones.SoundEventManager");var u=function(){function t(){}return t}();t.AnimationCacheManager=u,__reflect(u.prototype,"dragonBones.AnimationCacheManager")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._dragonBonesData=null,this._animationData=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,i=this.currentPlayTimes,a=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var r=this._animationState.playTimes,n=r*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),r>0&&(t>=n||-n>=t)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=r,0>t?this.currentTime=0:this.currentTime=this._duration):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),0>t?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return this.currentPlayTimes===i&&this.currentTime===a?!1:((0>e&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==i)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,i){this._armature=t,this._animationState=e,this._timelineData=i,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._frameRate=this._armature.armatureData.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._armature.armatureData.parent,this._animationData=this._animationState.animationData,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},e.prototype.fadeOut=function(){},e.prototype.update=function(t){if(this.playState<=0&&this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),i=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==i&&(this._frameIndex=i,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());0!==this._tweenState&&this._onUpdateFrame()}},e}(t.BaseObject);t.TimelineState=e,__reflect(e.prototype,"dragonBones.TimelineState");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e._getEasingValue=function(t,e,i){var a=e;switch(t){case 3:a=Math.pow(e,2);break;case 4:a=1-Math.pow(1-e,2);break;case 5:a=.5*(1-Math.cos(e*Math.PI))}return(a-e)*i+e},e._getEasingCurveValue=function(t,e,i,a){if(0>=t)return 0;if(t>=1)return 1;var r=i+1,n=Math.floor(t*r),s=0===n?0:e[a+n-1],o=n===r-1?100:e[a+n];return.01*(s+(o-s)*(t*r-n))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1];this._frameDurationR=1/(this._frameArray[t]*this._frameRateR-this._framePosition)}else this._tweenState=1},e.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},e}(e);t.TweenTimelineState=i,__reflect(i.prototype,"dragonBones.TweenTimelineState");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bone=null,this.bonePose=null},e}(i);t.BoneTimelineState=a,__reflect(a.prototype,"dragonBones.BoneTimelineState");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.slot=null},e}(i);t.SlotTimelineState=r,__reflect(r.prototype,"dragonBones.SlotTimelineState")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function e(t){void 0===t&&(t=-1),this.time=0,this.timeScale=1,this._animatebles=[],this._clock=null,t=0>t?.001*(new Date).getTime():t}return e.prototype.advanceTime=function(t){if(t!==t&&(t=0),0>t&&(t=.001*(new Date).getTime()-this.time),1!==this.timeScale&&(t*=this.timeScale),0>t?this.time-=t:this.time+=t,0!==t){for(var e=0,i=0,a=this._animatebles.length;a>e;++e){var r=this._animatebles[e];null!==r?(i>0&&(this._animatebles[e-i]=r,this._animatebles[e]=null),r.advanceTime(t)):i++}if(i>0){for(a=this._animatebles.length;a>e;++e){var r=this._animatebles[e];null!==r?this._animatebles[e-i]=r:i++}this._animatebles.length-=i}}},e.prototype.contains=function(t){return this._animatebles.indexOf(t)>=0},e.prototype.add=function(e){this._animatebles.indexOf(e)<0&&(this._animatebles.push(e),e.clock=this,t.DragonBones.debug&&e instanceof t.Armature&&t.DragonBones.addArmature(e))},e.prototype.remove=function(e){var i=this._animatebles.indexOf(e);i>=0&&(this._animatebles[i]=null,e.clock=null,t.DragonBones.debug&&e instanceof t.Armature&&t.DragonBones.removeArmature(e))},e.prototype.clear=function(){for(var t=0,e=this._animatebles.length;e>t;++t){var i=this._animatebles[t];this._animatebles[t]=null,null!==i&&(i.clock=null)}},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),e}();e.clock=new e,t.WorldClock=e,__reflect(e.prototype,"dragonBones.WorldClock",["dragonBones.IAnimateble"])}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i._localMatrix=new t.Matrix,i._colorTransform=new t.ColorTransform,i._ffdVertices=[],i._displayDatas=[],i._displayList=[],i._meshBones=[],i._rawDisplay=null,i._meshDisplay=null,i}return __extends(i,e),i.prototype._onClear=function(){e.prototype._onClear.call(this);for(var i=[],a=0,r=this._displayList;a<r.length;a++){var n=r[a];null!==n&&n!==this._rawDisplay&&n!==this._meshDisplay&&i.indexOf(n)<0&&i.push(n)}for(var s=0,o=i;s<o.length;s++){var n=o[s];n instanceof t.Armature?n.dispose():this._disposeDisplay(n)}null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay),this.displayController=null,this.slotData=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._meshDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._ffdVertices.length=0,this._displayList.length=0,this._displayDatas.length=0,this._meshBones.length=0,this._rawDisplayDatas=null,this._displayData=null,this._textureData=null,this._meshData=null,this._boundingBoxData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._cachedFrameIndices=null},i.prototype._isMeshBonesUpdate=function(){for(var t=0,e=this._meshBones;t<e.length;t++){var i=e[t];if(null!==i&&i._childrenTransformDirty)return!0}return!1},i.prototype._updateDisplayData=function(){var t=this._displayData,e=this._textureData,a=this._meshData,r=this._displayIndex>=0&&this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;if(this._displayIndex>=0&&this._displayIndex<this._displayDatas.length?this._displayData=this._displayDatas[this._displayIndex]:this._displayData=null,null!==this._displayData&&(0===this._displayData.type||2===this._displayData.type)?(this._textureData=this._displayData.texture,2===this._displayData.type?this._meshData=this._displayData:null!==r&&2===r.type?this._meshData=r:this._meshData=null):(this._textureData=null,this._meshData=null),null!==this._displayData&&3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==r&&3===r.type?this._boundingBoxData=r.boundingBox:this._boundingBoxData=null,this._displayData!==t||this._textureData!==e||this._meshData!==a){if(null!==this._meshData)this._pivotX=0,this._pivotY=0;
else if(null!==this._textureData){var n=this._displayData,s=this._armature.armatureData.scale,o=this._textureData.frame;if(this._pivotX=n.pivot.x,this._pivotY=n.pivot.y,n.isRelativePivot){var l=null!==o?o:this._textureData.region,h=l.width*s,_=l.height*s;this._textureData.rotated&&(h=l.height,_=l.width),this._pivotX*=h,this._pivotY*=_}null!==o&&(this._pivotX+=o.x*s,this._pivotY+=o.y*s)}else this._pivotX=0,this._pivotY=0;if(this._meshData!==a)if(null!==this._meshData){if(null!==this._meshData.weight){this._ffdVertices.length=2*this._meshData.weight.count,this._meshBones.length=this._meshData.weight.bones.length;for(var u=0,p=this._meshBones.length;p>u;++u)this._meshBones[u]=this._armature.getBone(this._meshData.weight.bones[u].name)}else{var c=this._meshData.parent.parent.intArray[this._meshData.offset+0];this._ffdVertices.length=2*c,this._meshBones.length=0}for(var u=0,p=this._ffdVertices.length;p>u;++u)this._ffdVertices[u]=0;this._meshDirty=!0}else this._ffdVertices.length=0,this._meshBones.length=0;else null!==this._meshData&&this._textureData!==e&&(this._meshDirty=!0);null===this._displayData||null===r||this._displayData===r||null!==this._meshData&&this._meshData===this._displayData||(r.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX-=i._helpPoint.x,this._pivotY-=i._helpPoint.y,this._displayData.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX+=i._helpPoint.x,this._pivotY+=i._helpPoint.y),null!==r?this.origin=r.transform:null!==this._displayData&&(this.origin=this._displayData.transform),this._displayDirty=!0,this._transformDirty=!0}},i.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,i=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var a=null!==this._display?this._display:this._rawDisplay;if(a!==e&&(this._onUpdateDisplay(),this._replaceDisplay(e),this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),(a===this._rawDisplay||a===this._meshDisplay)&&this._updateFrame(),this._childArmature!==i&&(null!==i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var r=this._armature.cacheFrameRate;0!==r&&(this._childArmature.cacheFrameRate=r)}var n=null;if(null!==this._displayData&&1===this._displayData.type)n=this._displayData.actions;else{var s=this._displayIndex>=0&&this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;null!==s&&1===s.type&&(n=s.actions)}if(null!==n&&n.length>0)for(var o=0,l=n;o<l.length;o++){var h=l[o];this._childArmature._bufferAction(h)}else this._childArmature.animation.play()}},i.prototype._updateGlobalTransformMatrix=function(t){this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(this._parent.globalTransformMatrix),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},i.prototype._setArmature=function(t){this._armature!==t&&(null!==this._armature&&this._armature._removeSlotFromSlotList(this),this._armature=t,this._onUpdateDisplay(),null!==this._armature?(this._armature._addSlotToSlotList(this),this._addDisplay()):this._removeDisplay())},i.prototype.init=function(t,e,i,a){if(null===this.slotData){this.slotData=t,this.name=this.slotData.name,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this.slotData.blendMode,this._zOrder=this.slotData.zOrder,this._colorTransform.copyFrom(this.slotData.color),this._rawDisplayDatas=e,this._rawDisplay=i,this._meshDisplay=a,this._displayDatas.length=this._rawDisplayDatas.length;for(var r=0,n=this._displayDatas.length;n>r;++r)this._displayDatas[r]=this._rawDisplayDatas[r]}},i.prototype.update=function(t){if(this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];e>=0&&this._cachedFrameIndex===e?this._transformDirty=!1:e>=0?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(null!==this._display){if(this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._meshData&&this._display===this._meshDisplay){var i=null!==this._meshData.weight;if((this._meshDirty||i&&this._isMeshBonesUpdate())&&(this._meshDirty=!1,this._updateMesh()),i)return void(this._transformDirty&&(this._transformDirty=!1,this._updateTransform(!0)))}if(this._transformDirty){if(this._transformDirty=!1,this._cachedFrameIndex<0){var a=t>=0;this._updateGlobalTransformMatrix(a),a&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature.armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature.armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform(!1)}}},i.prototype._setDisplayList=function(e){if(null!==e&&e.length>0){this._displayList.length!==e.length&&(this._displayList.length=e.length);for(var i=0,a=e.length;a>i;++i){var r=e[i];null!==r&&r!==this._rawDisplay&&r!==this._meshDisplay&&!(r instanceof t.Armature)&&this._displayList.indexOf(r)<0&&this._initDisplay(r),this._displayList[i]=r}}else this._displayList.length>0&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},i.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex===t?!1:(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},i.prototype._setZorder=function(t){return this._zOrder===t,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},i.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},i.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},i.prototype.containsPoint=function(t,e){return null===this._boundingBoxData?!1:(this.updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(t,e,i._helpPoint),this._boundingBoxData.containsPoint(i._helpPoint.x,i._helpPoint.y))},i.prototype.intersectsSegment=function(t,e,a,r,n,s,o){if(void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(t,e,i._helpPoint),t=i._helpPoint.x,e=i._helpPoint.y,i._helpMatrix.transformPoint(a,r,i._helpPoint),a=i._helpPoint.x,r=i._helpPoint.y;var l=this._boundingBoxData.intersectsSegment(t,e,a,r,n,s,o);return l>0&&(1===l||2===l?null!==n?(this.globalTransformMatrix.transformPoint(n.x,n.y,n),null!==s&&(s.x=n.x,s.y=n.y)):null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s):(null!==n&&this.globalTransformMatrix.transformPoint(n.x,n.y,n),null!==s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s)),null!==o&&(this.globalTransformMatrix.transformPoint(Math.cos(o.x),Math.sin(o.x),i._helpPoint,!0),o.x=Math.atan2(i._helpPoint.y,i._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(o.y),Math.sin(o.y),i._helpPoint,!0),o.y=Math.atan2(i._helpPoint.y,i._helpPoint.x))),l},i.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(i.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(e){var i=this._displayList.concat(),a=new Array;this._setDisplayList(e)&&this.update(-1);for(var r=0,n=i;r<n.length;r++){var s=n[r];null!==s&&s!==this._rawDisplay&&s!==this._meshDisplay&&this._displayList.indexOf(s)<0&&a.indexOf(s)<0&&a.push(s)}for(var o=0,l=a;o<l.length;o++){var s=l[o];s instanceof t.Armature?s.dispose():this._disposeDisplay(s)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!==t){var e=this._displayList.length;if(this._displayIndex<0&&0===e&&(this._displayIndex=0),!(this._displayIndex<0)){var i=this.displayList;e<=this._displayIndex&&(i.length=this._displayIndex+1),i[this._displayIndex]=t,this.displayList=i}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),i.prototype.getDisplay=function(){return this._display},i.prototype.setDisplay=function(t){this.display=t},i}(t.TransformObject);t.Slot=e,__reflect(e.prototype,"dragonBones.Slot")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(){this.dataName="",this.textureAtlasName="",this.skin=null}return t}();t.BuildArmaturePackage=e,__reflect(e.prototype,"dragonBones.BuildArmaturePackage");var i=function(){function i(t){void 0===t&&(t=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dataParser=null!==t?t:i._objectParser}return i.prototype._isSupportMesh=function(){return!0},i.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var i=0,a=this._textureAtlasDataMap[t];i<a.length;i++){var r=a[i],n=r.getTexture(e);if(null!==n)return n}if(this.autoSearch)for(var s in this._textureAtlasDataMap)for(var o=0,l=this._textureAtlasDataMap[s];o<l.length;o++){var r=l[o];if(r.autoSearch){var n=r.getTexture(e);if(null!==n)return n}}return null},i.prototype._fillBuildArmaturePackage=function(t,e,i,a,r){var n=null,s=null;if(null!==e&&(n=this._dragonBonesDataMap[e],null!==n&&(s=n.getArmature(i))),null===s&&(null===e||this.autoSearch))for(var o in this._dragonBonesDataMap)if(n=this._dragonBonesDataMap[o],(null===e||n.autoSearch)&&(s=n.getArmature(i),null!==s)){e=o;break}if(null!==s){if(t.dataName=null!==e?e:"",t.textureAtlasName=null!==r?r:"",t.data=n,t.armature=s,t.skin=null,null!==a&&(t.skin=s.getSkin(a),null===t.skin&&this.autoSearch))for(var o in this._dragonBonesDataMap){var l=this._dragonBonesDataMap[o],h=l.getArmature(a);if(null!==h){t.skin=h.defaultSkin;break}}return null===t.skin&&(t.skin=s.defaultSkin),!0}return!1},i.prototype._buildBones=function(e,i){for(var a=0,r=e.armature.sortedBones;a<r.length;a++){var n=r[a],s=t.BaseObject.borrowObject(t.Bone);if(s.init(n),null!==n.parent?i.addBone(s,n.parent.name):i.addBone(s),n.constraints.length>0)for(var o=0,l=n.constraints;o<l.length;o++){var h=l[o],_=i.getBone(h.target.name);if(null!==_){var u=h,p=t.BaseObject.borrowObject(t.IKConstraint),c=null!==u.root?i.getBone(u.root.name):null;p.target=_,p.bone=s,p.root=c,p.bendPositive=u.bendPositive,p.scaleEnabled=u.scaleEnabled,p.weight=u.weight,null!==c?c.addConstraint(p):s.addConstraint(p)}}}},i.prototype._buildSlots=function(t,e){var i=t.skin,a=t.armature.defaultSkin;if(null!==i&&null!==a){var r={};for(var n in a.displays){var s=a.displays[n];r[n]=s}if(i!==a)for(var n in i.displays){var s=i.displays[n];r[n]=s}for(var o=0,l=t.armature.sortedSlots;o<l.length;o++){var h=l[o];if(h.name in r){for(var s=r[h.name],_=this._buildSlot(t,h,s,e),u=new Array(s.length),p=0,c=s.length;c>p;++p)u[p]=this._getSlotDisplay(t,s[p],_);e.addSlot(_,h.parent.name),_._setDisplayList(u),_._setDisplayIndex(h.displayIndex,!0)}}}},i.prototype._getSlotDisplay=function(t,e,i){var a=null;switch(e.type){case 0:var r=e;null===r.texture?r.texture=this._getTextureData(t.dataName,e.name):t.textureAtlasName.length>0&&(r.texture=this._getTextureData(t.textureAtlasName,e.name)),a=i.rawDisplay;break;case 2:var n=e;null===n.texture?n.texture=this._getTextureData(t.dataName,n.textureName):t.textureAtlasName.length>0&&(n.texture=this._getTextureData(t.textureAtlasName,n.textureName)),a=this._isSupportMesh()?i.meshDisplay:i.rawDisplay;break;case 1:var s=e,o=this.buildArmature(s.name,t.dataName,null,t.textureAtlasName);if(null!==o){if(o.inheritAnimation=s.inheritAnimation,!o.inheritAnimation){var l=s.actions.length>0?s.actions:o.armatureData.defaultActions;if(l.length>0)for(var h=0,_=l;h<_.length;h++){var u=_[h];o._bufferAction(u)}else o.animation.play()}s.armature=o.armatureData}a=o}return a},i.prototype._replaceSlotDisplay=function(t,e,i,a){0>a&&(a=i.displayIndex),0>a&&(a=0);var r=i.displayList;r.length<=a&&(r.length=a+1),i._displayDatas.length<=a&&(i._displayDatas.length=a+1),i._displayDatas[a]=e,r[a]=this._getSlotDisplay(t,e,i),i.displayList=r},i.prototype.parseDragonBonesData=function(t,e,a){void 0===e&&(e=null),void 0===a&&(a=1);var r=null;if(t instanceof ArrayBuffer)for(r=i._binaryParser.parseDragonBonesData(t,a);;){var n=!1,s=this._buildTextureAtlasData(null,null);i._binaryParser.parseTextureAtlasData(t,s,a);for(var o in s.textures){n=!0;break}if(!n){s.returnToPool();break}this.addTextureAtlasData(s,e)}else r=this._dataParser.parseDragonBonesData(t,a);return null!==r&&this.addDragonBonesData(r,e),r},i.prototype.parseTextureAtlasData=function(t,e,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,a),this._buildTextureAtlasData(r,e),this.addTextureAtlasData(r,i),r},i.prototype.updateTextureAtlasData=function(t,e){var i=this.getTextureAtlasData(t);if(null!==i)for(var a=0,r=i.length;r>a;++a)a<e.length&&this._buildTextureAtlasData(i[a],e[a])},i.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},i.prototype.addDragonBonesData=function(e,i){if(void 0===i&&(i=null),i=null!==i?i:e.name,i in this._dragonBonesDataMap){if(this._dragonBonesDataMap[i]===e)return;t.DragonBones.warn("Same name data."),this._dragonBonesDataMap[i].returnToPool()}this._dragonBonesDataMap[i]=e},i.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBonesDataMap[t].returnToPool(),delete this._dragonBonesDataMap[t])},i.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},i.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null),e=null!==e?e:t.name;var i=e in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];i.indexOf(t)<0&&i.push(t)},i.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var i=this._textureAtlasDataMap[t];if(e)for(var a=0,r=i;a<r.length;a++){var n=r[a];n.returnToPool()}delete this._textureAtlasDataMap[t]}},i.prototype.clear=function(t){void 0===t&&(t=!0);for(var e in this._dragonBonesDataMap)t&&this._dragonBonesDataMap[e].returnToPool(),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=this._textureAtlasDataMap[e],a=0,r=i;a<r.length;a++){var n=r[a];n.returnToPool()}delete this._textureAtlasDataMap[e]}},i.prototype.buildArmature=function(i,a,r,n){void 0===a&&(a=null),void 0===r&&(r=null),void 0===n&&(n=null);var s=new e;if(!this._fillBuildArmaturePackage(s,a,i,r,n))return t.DragonBones.assert(!1,"No armature data. "+i+", "+(null!==a?a:"")),null;var o=this._buildArmature(s);return this._buildBones(s,o),this._buildSlots(s,o),o.invalidUpdate(null,!0),o.advanceTime(0),o},i.prototype.changeSkin=function(t,i,a,r,n){void 0===a&&(a=null),void 0===r&&(r=null),void 0===n&&(n=null);var s=new e;if(this._fillBuildArmaturePackage(s,a,i,r,null)&&null!==s.skin)for(var o=0,l=t.getSlots();o<l.length;o++){var h=l[o];if(h.name in s.skin.displays&&!(null!==n&&n.indexOf(h.name)>=0)){var _=s.skin.displays[h.name],u=h.displayList;u.length=_.length;for(var p=0,c=_.length;c>p;++p)u[p]=this._getSlotDisplay(s,_[p],h);h._rawDisplayDatas=_,h._displayDatas.length=h._rawDisplayDatas.length;for(var p=0,c=h._displayDatas.length;c>p;++p)h._displayDatas[p]=h._rawDisplayDatas[p];h.displayList=u}}},i.prototype.copyAnimationsToArmature=function(i,a,r,n,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=!0);var o=new e;if(this._fillBuildArmaturePackage(o,n,a,r,null)){var l=o.armature;if(s)i.animation.animations=l.animations;else{var h={};for(var _ in i.animation.animations)h[_]=i.animation.animations[_];for(var _ in l.animations)h[_]=l.animations[_];i.animation.animations=h}if(o.skin){for(var u=i.getSlots(),p=0,c=u.length;c>p;++p)for(var d=u[p],m=d.displayList,f=0,g=m.length;g>f;++f){var y=m[f];if(y instanceof t.Armature){var v=o.skin.getDisplays(d.name);if(null!==v&&f<v.length){var D=v[f];null!==D&&1===D.type&&this.copyAnimationsToArmature(y,D.name,r,n,s)}}}return!0}}return!1},i.prototype.replaceSlotDisplay=function(t,e,i,a,r,n){void 0===n&&(n=-1);var s={};if(this._fillBuildArmaturePackage(s,t,e,null,null)&&null!==s.skin){var o=s.skin.getDisplays(i);if(null!==o)for(var l=0,h=o;l<h.length;l++){var _=h[l];if(null!==_&&_.name===a){this._replaceSlotDisplay(s,_,r,n);break}}}},i.prototype.replaceSlotDisplayList=function(t,e,i,a){var r={};if(this._fillBuildArmaturePackage(r,t,e,null,null)&&null!==r.skin){var n=r.skin.getDisplays(i);if(null!==n)for(var s=0,o=n.length;o>s;++s){var l=n[s];this._replaceSlotDisplay(r,l,a,s)}}},i.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},i.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},i}();i._objectParser=new t.ObjectDataParser,i._binaryParser=new t.BinaryDataParser,t.BaseFactory=i,__reflect(i.prototype,"dragonBones.BaseFactory")}(dragonBones||(dragonBones={}));var dragTarget=null,_helpPoint=new egret.Point,_dragOffset=new egret.Point,BoundingBoxTester=function(t){function e(){var e=t.call(this)||this;return e.armatureDisplay=null,e._helpPointA=new egret.Point,e._helpPointB=new egret.Point,e._helpPointC=new egret.Point,e._background=new egret.Shape,e._pointA=new egret.Shape,e._pointB=new egret.Shape,e._pointA.x=0,e._pointA.y=0,e._pointB.x=200,e._pointB.y=200,e.addChild(e._background),e.addChild(e._pointA),e.addChild(e._pointB),enableDrag(e._pointA),enableDrag(e._pointB),enableDrag(e),e.addEventListener(egret.Event.ENTER_FRAME,e._enterFrameHandler,e),e}return __extends(e,t),e.prototype._enterFrameHandler=function(t){if(this.armatureDisplay){this.localToGlobal(this._pointA.x,this._pointA.y,this._helpPointA),this.localToGlobal(this._pointB.x,this._pointB.y,this._helpPointB),this.armatureDisplay.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this.armatureDisplay.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB);var e=this.armatureDisplay.armature.containsPoint(this._helpPointA.x,this._helpPointA.y),i=this.armatureDisplay.armature.containsPoint(this._helpPointB.x,this._helpPointB.y),a=this.armatureDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y,this._helpPointB.x,this._helpPointB.y,this._helpPointA,this._helpPointB,this._helpPointC),r=e?65280:16711680;this._pointA.graphics.clear(),this._pointA.graphics.beginFill(r,.2),this._pointA.graphics.drawCircle(0,0,60),this._pointA.graphics.endFill(),this._pointA.graphics.beginFill(r,.8),this._pointA.graphics.drawCircle(0,0,6),this._pointA.graphics.endFill();var n=i?65280:16711680;this._pointB.graphics.clear(),this._pointB.graphics.beginFill(n,.2),this._pointB.graphics.drawCircle(0,0,40),this._pointB.graphics.endFill(),this._pointB.graphics.beginFill(n,.8),this._pointB.graphics.drawCircle(0,0,4),this._pointB.graphics.endFill();var s=a?65280:16711680;this._background.graphics.clear(),this._background.graphics.lineStyle(20,s,0),this._background.graphics.moveTo(this._pointA.x,this._pointA.y),this._background.graphics.lineTo(this._pointB.x,this._pointB.y),this._background.graphics.lineStyle(2,s,.8),this._background.graphics.moveTo(this._pointA.x,this._pointA.y),this._background.graphics.lineTo(this._pointB.x,this._pointB.y),a&&(this.armatureDisplay.localToGlobal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this.armatureDisplay.localToGlobal(this._helpPointB.x,this._helpPointB.y,this._helpPointB),this.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB),this._background.graphics.moveTo(this._helpPointA.x,this._helpPointA.y),this._background.graphics.lineTo(this._helpPointA.x+60*Math.cos(this._helpPointC.x),this._helpPointA.y+60*Math.sin(this._helpPointC.x)),this._background.graphics.moveTo(this._helpPointB.x,this._helpPointB.y),this._background.graphics.lineTo(this._helpPointB.x+40*Math.cos(this._helpPointC.y),this._helpPointB.y+40*Math.sin(this._helpPointC.y)),this._background.graphics.beginFill(65280,.8),this._background.graphics.drawCircle(this._helpPointA.x,this._helpPointA.y,6),this._background.graphics.endFill(),this._background.graphics.beginFill(65280,.8),this._background.graphics.drawCircle(this._helpPointB.x,this._helpPointB.y,4),this._background.graphics.endFill())}},e}(egret.DisplayObjectContainer);__reflect(BoundingBoxTester.prototype,"BoundingBoxTester");var BaseTest=function(t){function e(){var e=t.call(this)||this;return e._resourceGroup=null,e._resourceConfigURL=null,e._background=new egret.Shape,e.loadingView=null,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this._resourceConfigURL&&(this._background.graphics.beginFill(6710886,1),this._background.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.addChild(this._background),this.loadingView=new LoadingView,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(this._resourceConfigURL,"resource/"))},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this._resourceGroup=this._resourceGroup||"preload",RES.loadGroup(this._resourceGroup)},e.prototype.onResourceLoadComplete=function(t){t.groupName==this._resourceGroup&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this._onStart())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e}(egret.DisplayObjectContainer);__reflect(BaseTest.prototype,"BaseTest");var LoadingView=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStageHandler,e),e}return __extends(e,t),e.prototype.addToStageHandler=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStageHandler,this),this.textField=new egret.TextField,this.textField.y=.5*this.stage.stageHeight,this.textField.width=this.stage.stageWidth,this.textField.height=60,this.textField.textAlign="center",this.addChild(this.textField)},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.DisplayObjectContainer);__reflect(LoadingView.prototype,"LoadingView");var dragonBones;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.EgretSlot]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._armatureDisplay=null,this._renderDisplay=null,this._colorFilter=null},i.prototype._initDisplay=function(t){},i.prototype._disposeDisplay=function(t){},i.prototype._onUpdateDisplay=function(){this._armatureDisplay=this._armature.display,this._renderDisplay=null!==this._display?this._display:this._rawDisplay},i.prototype._addDisplay=function(){this._armatureDisplay._batchEnabled?this._armatureDisplay.$renderNode.addNode(this._renderDisplay.$renderNode):this._armatureDisplay.addChild(this._renderDisplay)},i.prototype._replaceDisplay=function(t){if(this._armatureDisplay._batchEnabled);else{var e=t;this._armatureDisplay.addChild(this._renderDisplay),this._armatureDisplay.swapChildren(this._renderDisplay,e),this._armatureDisplay.removeChild(e)}},i.prototype._removeDisplay=function(){this._armatureDisplay._batchEnabled||this._renderDisplay.parent.removeChild(this._renderDisplay)},i.prototype._updateZOrder=function(){var t=this._armatureDisplay.getChildIndex(this._renderDisplay);t!==this._zOrder&&this._armatureDisplay.addChildAt(this._renderDisplay,this._zOrder)},i.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},i.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=egret.BlendMode.NORMAL;break;case 1:this._renderDisplay.blendMode=egret.BlendMode.ADD;break;case 5:this._renderDisplay.blendMode=egret.BlendMode.ERASE}},i.prototype._updateColor=function(){if(1!==this._colorTransform.redMultiplier||1!==this._colorTransform.greenMultiplier||1!==this._colorTransform.blueMultiplier||0!==this._colorTransform.redOffset||0!==this._colorTransform.greenOffset||0!==this._colorTransform.blueOffset||0!==this._colorTransform.alphaOffset){null===this._colorFilter&&(this._colorFilter=new egret.ColorMatrixFilter);var t=this._colorFilter.matrix;t[0]=this._colorTransform.redMultiplier,t[6]=this._colorTransform.greenMultiplier,t[12]=this._colorTransform.blueMultiplier,t[18]=this._colorTransform.alphaMultiplier,t[4]=this._colorTransform.redOffset,t[9]=this._colorTransform.greenOffset,t[14]=this._colorTransform.blueOffset,t[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=t;var e=this._renderDisplay.filters;e||(e=[]),e.indexOf(this._colorFilter)<0&&e.push(this._colorFilter),this._renderDisplay.$setAlpha(1),this._renderDisplay.filters=e}else null!==this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},i.prototype._updateFrame=function(){var e=this._display===this._meshDisplay?this._meshData:null,i=this._textureData;if(this._displayIndex>=0&&null!==this._display&&null!==i){var a=i.parent;null!==this._armature.replacedTexture&&(null===this._armature._replaceTextureAtlasData?(a=t.BaseObject.borrowObject(t.EgretTextureAtlasData),a.copyFrom(i.parent),a.texture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=a):a=this._armature._replaceTextureAtlasData,i=a.getTexture(i.name));var r=null!==a.texture?a.texture._bitmapData:null;if(null!==r){if(null===i.texture){var n=a.width>0?a.width:r.width,s=a.height>0?a.height:r.height,o=Math.min(i.region.width,n-i.region.x),l=Math.min(i.region.height,s-i.region.y);i.texture=new egret.Texture,i.texture._bitmapData=r,i.texture.$initData(i.region.x,i.region.y,o,l,0,0,o,l,n,s)}if(null!==e){var h=e.parent.parent.intArray,_=e.parent.parent.floatArray,u=h[e.offset+0],p=h[e.offset+1],c=h[e.offset+2],d=c+2*u,m=this._renderDisplay,f=m.$renderNode;f.uvs.length=2*u,f.vertices.length=2*u,f.indices.length=3*p;for(var g=0,y=2*u;y>g;++g)f.vertices[g]=_[c+g],f.uvs[g]=_[d+g];for(var g=0;3*p>g;++g)f.indices[g]=h[e.offset+4+g];m.$setBitmapData(i.texture),m.$setAnchorOffsetX(this._pivotX),m.$setAnchorOffsetY(this._pivotY),m.$updateVertices(),m.$invalidateTransform()}else if(this._armatureDisplay._batchEnabled){var v=i.texture,D=this._renderDisplay.$renderNode;egret.sys.RenderNode.prototype.cleanBeforeRender.call(this._renderDisplay.$renderNode),D.image=v._bitmapData,D.drawImage(v._bitmapX,v._bitmapY,v._bitmapWidth,v._bitmapHeight,v._offsetX,v._offsetY,v.textureWidth,v.textureHeight),D.imageWidth=v._sourceWidth,D.imageHeight=v._sourceHeight}else{var T=this._renderDisplay;T.$setBitmapData(i.texture),T.$setAnchorOffsetX(this._pivotX),T.$setAnchorOffsetY(this._pivotY)}return}}if(this._armatureDisplay._batchEnabled)this._renderDisplay.$renderNode.image=null;else if(null!==e){var m=this._renderDisplay;m.$setBitmapData(null),m.x=0,m.y=0}else{var T=this._renderDisplay;T.$setBitmapData(null),T.x=0,T.y=0}},i.prototype._updateMesh=function(){var t=this._ffdVertices.length>0,e=this._meshData,i=e.weight,a=this._renderDisplay,r=a.$renderNode;if(null!==i){for(var n=e.parent.parent.intArray,s=e.parent.parent.floatArray,o=n[e.offset+0],l=n[i.offset+1],h=0,_=0,u=i.offset+2+i.bones.length,p=l,c=0;o>h;++h){for(var d=n[u++],m=0,f=0,g=0;d>g;++g){var y=n[u++],v=this._meshBones[y];if(null!==v){var D=v.globalTransformMatrix,T=s[p++],b=s[p++],E=s[p++];t&&(b+=this._ffdVertices[c++],E+=this._ffdVertices[c++]),m+=(D.a*b+D.c*E+D.tx)*T,f+=(D.b*b+D.d*E+D.ty)*T}}r.vertices[_++]=m,r.vertices[_++]=f}a.$updateVertices(),a.$invalidateTransform()}else if(t){for(var n=e.parent.parent.intArray,s=e.parent.parent.floatArray,o=n[e.offset+0],A=n[e.offset+2],h=0,O=2*o;O>h;++h)r.vertices[h]=s[A+h]+this._ffdVertices[h];a.$updateVertices(),a.$invalidateTransform()}},i.prototype._updateTransform=function(t){if(t){var e=this._renderDisplay.matrix;e.identity(),this._renderDisplay.$setMatrix(e,this.transformUpdateEnabled)}else{var i=this.globalTransformMatrix;if(this._armatureDisplay._batchEnabled){var a=this._renderDisplay.$renderNode.matrix;a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a.tx=i.tx,a.ty=i.ty}else if(this.transformUpdateEnabled)this._renderDisplay.$setMatrix(i,!0);else{var r=this._renderDisplay.$DisplayObject,a=r[6];a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a.tx=i.tx,a.ty=i.ty,this._renderDisplay.$removeFlags(8),this._renderDisplay.$invalidatePosition()}}},i}(t.Slot);t.EgretSlot=e,__reflect(e.prototype,"dragonBones.EgretSlot")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this
}return __extends(i,e),i.toString=function(){return"[class dragonBones.ActionTimelineState]"},i.prototype._onCrossFrame=function(e){var i=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var a=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],r=this._armature.armatureData.actions,n=this._frameArray[a+1],s=0;n>s;++s){var o=this._frameArray[a+2+s],l=r[o];if(0===l.type)this._armature._bufferAction(l);else{var h=10===l.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;if(11===l.type||i.hasEvent(h)){var _=t.BaseObject.borrowObject(t.EventObject);_.name=l.name,_.time=this._frameArray[a]*this._frameRateR,_.data=l.data,_.animationState=this._animationState,null!==l.bone&&(_.bone=this._armature.getBone(l.bone.name)),null!==l.slot&&(_.slot=this._armature.getSlot(l.slot.name)),this._armature._bufferEvent(_,h)}}}},i.prototype._onArriveAtFrame=function(){},i.prototype._onUpdateFrame=function(){},i.prototype.update=function(e){var i=this.playState,a=this.currentPlayTimes,r=this.currentTime;if(this.playState<=0&&this._setCurrentTime(e)){var n=this._armature.eventDispatcher;if(0>i&&this.playState!==i&&(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),n.hasEvent(t.EventObject.START))){var s=t.BaseObject.borrowObject(t.EventObject);s.animationState=this._animationState,this._armature._bufferEvent(s,t.EventObject.START)}if(0>r)return;var o=!1,l=null,h=null;if(this.currentPlayTimes!==a?(n.hasEvent(t.EventObject.LOOP_COMPLETE)&&(l=t.BaseObject.borrowObject(t.EventObject),l.animationState=this._animationState),this.playState>0?(n.hasEvent(t.EventObject.COMPLETE)&&(h=t.BaseObject.borrowObject(t.EventObject),h.animationState=this._animationState),o=r>this.currentTime):o=r<this.currentTime):o=r>this.currentTime,this._frameCount>1){var _=this._timelineData,u=Math.floor(this.currentTime*this._frameRate),p=this._frameIndices[_.frameIndicesOffset+u];if(this._frameIndex!==p){var c=this._frameIndex;if(this._frameIndex=p,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[_.offset+5+this._frameIndex],o){if(0>c){var d=Math.floor(r*this._frameRate);c=this._frameIndices[_.frameIndicesOffset+d],this.currentPlayTimes===a&&c===p&&(c=-1)}for(;c>=0;){var m=this._animationData.frameOffset+this._timelineArray[_.offset+5+c],f=this._frameArray[m]*this._frameRateR;if(this._position<=f&&f<=this._position+this._duration&&this._onCrossFrame(c),null!==l&&0===c&&(this._armature._bufferEvent(l,t.EventObject.LOOP_COMPLETE),l=null),c>0?c--:c=this._frameCount-1,c===p)break}}else{if(0>c){var d=Math.floor(r*this._frameRate);c=this._frameIndices[_.frameIndicesOffset+d];var m=this._animationData.frameOffset+this._timelineArray[_.offset+5+c],f=this._frameArray[m]*this._frameRateR;this.currentPlayTimes===a&&(f>=r?c>0?c--:c=this._frameCount-1:c===p&&(c=-1))}for(;c>=0;){c<this._frameCount-1?c++:c=0;var m=this._animationData.frameOffset+this._timelineArray[_.offset+5+c],f=this._frameArray[m]*this._frameRateR;if(this._position<=f&&f<=this._position+this._duration&&this._onCrossFrame(c),null!==l&&0===c&&(this._armature._bufferEvent(l,t.EventObject.LOOP_COMPLETE),l=null),c===p)break}}}}else if(this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)){this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5];var f=this._frameArray[this._frameOffset]*this._frameRateR;this.currentPlayTimes===a?f>=r&&this._onCrossFrame(this._frameIndex):this._position<=f&&(!o&&l&&(this._armature._bufferEvent(l,t.EventObject.LOOP_COMPLETE),l=null),this._onCrossFrame(this._frameIndex))}null!==l&&this._armature._bufferEvent(l,t.EventObject.LOOP_COMPLETE),null!==h&&this._armature._bufferEvent(h,t.EventObject.COMPLETE)}},i.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},i}(t.TimelineState);t.ActionTimelineState=e,__reflect(e.prototype,"dragonBones.ActionTimelineState");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=this._frameArray[this._frameOffset+1];t>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0)}},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.ZOrderTimelineState=i,__reflect(i.prototype,"dragonBones.ZOrderTimelineState");var a=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},i.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._dragonBonesData.frameFloatArray,i=this.bonePose.current,a=this.bonePose.delta,r=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex;i.x=t[r++],i.y=t[r++],i.rotation=t[r++],i.skew=t[r++],i.scaleX=t[r++],i.scaleY=t[r++],2===this._tweenState&&(this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset),a.x=t[r++]-i.x,a.y=t[r++]-i.y,a.rotation=t[r++]-i.rotation,a.skew=t[r++]-i.skew,a.scaleX=t[r++]-i.scaleX,a.scaleY=t[r++]-i.scaleY)}else{var i=this.bonePose.current;i.x=0,i.y=0,i.rotation=0,i.skew=0,i.scaleX=1,i.scaleY=1}},i.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.result,i=this.bonePose.current,a=this.bonePose.delta;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),t.x=i.x+a.x*this._tweenProgress,t.y=i.y+a.y*this._tweenProgress,t.rotation=i.rotation+a.rotation*this._tweenProgress,t.skew=i.skew+a.skew*this._tweenProgress,t.scaleX=i.scaleX+a.scaleX*this._tweenProgress,t.scaleY=i.scaleY+a.scaleY*this._tweenProgress},i.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},i}(t.BoneTimelineState);t.BoneAllTimelineState=a,__reflect(a.prototype,"dragonBones.BoneAllTimelineState");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.SlotDislayIndexTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot.slotData.displayIndex;this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0)}},e}(t.SlotTimelineState);t.SlotDislayIndexTimelineState=r,__reflect(r.prototype,"dragonBones.SlotDislayIndexTimelineState");var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._result=[0,0,0,0,0,0,0,0],e._current=[0,0,0,0,0,0,0,0],e._delta=[0,0,0,0,0,0,0,0],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dirty=!1},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._dragonBonesData.intArray,i=this._dragonBonesData.frameIntArray,a=this._animationData.frameIntOffset+this._frameValueOffset+this._frameIndex,r=i[a];this._current[0]=e[r++],this._current[1]=e[r++],this._current[2]=e[r++],this._current[3]=e[r++],this._current[4]=e[r++],this._current[5]=e[r++],this._current[6]=e[r++],this._current[7]=e[r++],2===this._tweenState&&(r=this._frameIndex===this._frameCount-1?i[this._animationData.frameIntOffset+this._frameValueOffset]:i[a+1],this._delta[0]=e[r++]-this._current[0],this._delta[1]=e[r++]-this._current[1],this._delta[2]=e[r++]-this._current[2],this._delta[3]=e[r++]-this._current[3],this._delta[4]=e[r++]-this._current[4],this._delta[5]=e[r++]-this._current[5],this._delta[6]=e[r++]-this._current[6],this._delta[7]=e[r++]-this._current[7])}else{var n=this.slot.slotData.color;this._current[0]=100*n.alphaMultiplier,this._current[1]=100*n.redMultiplier,this._current[2]=100*n.greenMultiplier,this._current[3]=100*n.blueMultiplier,this._current[4]=n.alphaOffset,this._current[5]=n.redOffset,this._current[6]=n.greenOffset,this._current[7]=n.blueOffset}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){if(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty){var i=this.slot._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(i.alphaMultiplier!==this._result[0]||i.redMultiplier!==this._result[1]||i.greenMultiplier!==this._result[2]||i.blueMultiplier!==this._result[3]||i.alphaOffset!==this._result[4]||i.redOffset!==this._result[5]||i.greenOffset!==this._result[6]||i.blueOffset!==this._result[7]){var a=Math.pow(this._animationState._fadeProgress,4);i.alphaMultiplier+=(this._result[0]-i.alphaMultiplier)*a,i.redMultiplier+=(this._result[1]-i.redMultiplier)*a,i.greenMultiplier+=(this._result[2]-i.greenMultiplier)*a,i.blueMultiplier+=(this._result[3]-i.blueMultiplier)*a,i.alphaOffset+=(this._result[4]-i.alphaOffset)*a,i.redOffset+=(this._result[5]-i.redOffset)*a,i.greenOffset+=(this._result[6]-i.greenOffset)*a,i.blueOffset+=(this._result[7]-i.blueOffset)*a,this.slot._colorDirty=!0}}else this._dirty&&(this._dirty=!1,(i.alphaMultiplier!==this._result[0]||i.redMultiplier!==this._result[1]||i.greenMultiplier!==this._result[2]||i.blueMultiplier!==this._result[3]||i.alphaOffset!==this._result[4]||i.redOffset!==this._result[5]||i.greenOffset!==this._result[6]||i.blueOffset!==this._result[7])&&(i.alphaMultiplier=this._result[0],i.redMultiplier=this._result[1],i.greenMultiplier=this._result[2],i.blueMultiplier=this._result[3],i.alphaOffset=this._result[4],i.redOffset=this._result[5],i.greenOffset=this._result[6],i.blueOffset=this._result[7],this.slot._colorDirty=!0))}},e}(t.SlotTimelineState);t.SlotColorTimelineState=n,__reflect(n.prototype,"dragonBones.SlotColorTimelineState");var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._result=[],e._current=[],e._delta=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.SlotFFDTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dirty=!1,this._meshOffset=0,this._frameFloatOffset=0,this._count=0,this._ffdCount=0,this._valueOffset=0,this._result.length=0,this._current.length=0,this._delta.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=2===this._tweenState,i=this._dragonBonesData.frameFloatArray,a=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._count;if(e){var r=a+this._count;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var n=0;n<this._count;++n)this._delta[n]=i[r+n]-(this._current[n]=i[a+n])}else for(var n=0;n<this._count;++n)this._current[n]=i[a+n]}else for(var n=0;n<this._count;++n)this._current[n]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._count;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,i,a){if(t.prototype.init.call(this,e,i,a),null!==this._timelineData){var r=this._dragonBonesData.frameIntArray,n=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._meshOffset=r[n++],this._ffdCount=r[n++],this._count=r[n++],this._valueOffset=r[n++],this._frameFloatOffset=r[n++]+this._animationData.frameFloatOffset}else this._count=0;this._result.length=this._count,this._current.length=this._count,this._delta.length=this._count;for(var s=0;s<this._count;++s)this._delta[s]=0},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){if(null!==this.slot._meshData&&(null===this._timelineData||this.slot._meshData.offset===this._meshOffset)&&(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty)){var i=this.slot._ffdVertices;if(null!==this._timelineData){var a=this._dragonBonesData.frameFloatArray;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var r=Math.pow(this._animationState._fadeProgress,4),n=0;n<this._ffdCount;++n)n<this._valueOffset?i[n]+=(a[this._frameFloatOffset+n]-i[n])*r:n<this._valueOffset+this._count?i[n]+=(this._result[n-this._valueOffset]-i[n])*r:i[n]+=(a[this._frameFloatOffset+n-this._count]-i[n])*r;this.slot._meshDirty=!0}else if(this._dirty){this._dirty=!1;for(var n=0;n<this._ffdCount;++n)n<this._valueOffset?i[n]=a[this._frameFloatOffset+n]:n<this._valueOffset+this._count?i[n]=this._result[n-this._valueOffset]:i[n]=a[this._frameFloatOffset+n-this._count];this.slot._meshDirty=!0}}else if(this._ffdCount=i.length,0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var r=Math.pow(this._animationState._fadeProgress,4),n=0;n<this._ffdCount;++n)i[n]+=(0-i[n])*r;this.slot._meshDirty=!0}else if(this._dirty){this._dirty=!1;for(var n=0;n<this._ffdCount;++n)i[n]=0;this.slot._meshDirty=!0}}},e}(t.SlotTimelineState);t.SlotFFDTimelineState=s,__reflect(s.prototype,"dragonBones.SlotFFDTimelineState")}(dragonBones||(dragonBones={}));var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addChild(new ChangeSkinTest)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var dragonBones;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._actions=[],t._events=[],t._animation=null,t._proxy=null,t._clock=null,t._replaceTextureAtlasData=null,t.enableCache=!1,t}return __extends(i,e),i.toString=function(){return"[class dragonBones.Armature]"},i._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},i.prototype._onClear=function(){for(var t=0,e=this._bones;t<e.length;t++){var i=e[t];i.returnToPool()}for(var a=0,r=this._slots;a<r.length;a++){var n=r[a];n.returnToPool()}for(var s=0,o=this._events;s<o.length;s++){var l=o[s];l.returnToPool()}null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.clear(),null!==this._clock&&this._clock.remove(this),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.debugDraw=!1,this.armatureData=null,this.userData=null,this._debugDraw=!1,this._delayDispose=!1,this._lockDispose=!1,this._bonesDirty=!1,this._slotsDirty=!1,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._actions.length=0,this._events.length=0,this._animation=null,this._proxy=null,this._display=null,this._eventManager=null,this._parent=null,this._clock=null,this._replaceTextureAtlasData=null,this._replacedTexture=null},i.prototype._sortBones=function(){var t=this._bones.length;if(!(0>=t)){var e=this._bones.concat(),i=0,a=0;for(this._bones.length=0;t>a;){var r=e[i++];if(i>=t&&(i=0),!(this._bones.indexOf(r)>=0)){if(r.constraints.length>0)for(var n=0,s=r.constraints;n<s.length;n++){var o=s[n];!(this._bones.indexOf(o.target)<0)}null!==r.parent&&this._bones.indexOf(r.parent)<0||(this._bones.push(r),a++)}}}},i.prototype._sortSlots=function(){this._slots.sort(i._onSortSlots)},i.prototype._sortZOrder=function(t,e){var i=this.armatureData.sortedSlots,a=null===t;if(this._zOrderDirty||!a){for(var r=0,n=i.length;n>r;++r){var s=a?r:t[e+r];if(!(0>s||s>=n)){var o=i[s],l=this.getSlot(o.name);null!==l&&l._setZorder(r)}}this._slotsDirty=!0,this._zOrderDirty=!a}},i.prototype._doAction=function(t){this._animation.fadeIn(t.name)},i.prototype._addBoneToBoneList=function(t){this._bones.indexOf(t)<0&&(this._bonesDirty=!0,this._bones.push(t),this._animation._timelineDirty=!0)},i.prototype._removeBoneFromBoneList=function(t){var e=this._bones.indexOf(t);e>=0&&(this._bones.splice(e,1),this._animation._timelineDirty=!0)},i.prototype._addSlotToSlotList=function(t){this._slots.indexOf(t)<0&&(this._slotsDirty=!0,this._slots.push(t),this._animation._timelineDirty=!0)},i.prototype._removeSlotFromSlotList=function(t){var e=this._slots.indexOf(t);e>=0&&(this._slots.splice(e,1),this._animation._timelineDirty=!0)},i.prototype._bufferAction=function(t){this._actions.push(t)},i.prototype._bufferEvent=function(t,e){t.type=e,t.armature=this,this._events.push(t)},i.prototype.dispose=function(){null!==this.armatureData&&(this._lockDispose?this._delayDispose=!0:this.returnToPool())},i.prototype.init=function(e,i,a,r){null===this.armatureData&&(this.armatureData=e,this._animation=t.BaseObject.borrowObject(t.Animation),this._proxy=i,this._display=a,this._eventManager=r,this._proxy.init(this),this._animation.init(this),this._animation.animations=this.armatureData.animations)},i.prototype.advanceTime=function(e){if(null===this.armatureData)return void t.DragonBones.assert(!1,"The armature has been disposed.");if(null===this.armatureData.parent)return void t.DragonBones.assert(!1,"The armature data has been disposed.");var i=this._cacheFrameIndex;this._animation.advanceTime(e),this._bonesDirty&&(this._bonesDirty=!1,this._sortBones()),this._slotsDirty&&(this._slotsDirty=!1,this._sortSlots());var a=0,r=0;if(this._cacheFrameIndex<0||this._cacheFrameIndex!==i){for(a=0,r=this._bones.length;r>a;++a)this._bones[a].update(this._cacheFrameIndex);for(a=0,r=this._slots.length;r>a;++a)this._slots[a].update(this._cacheFrameIndex)}var n=this.debugDraw||t.DragonBones.debugDraw;if((n||this._debugDraw)&&(this._debugDraw=n,this._proxy._debugDraw(this._debugDraw)),!this._lockDispose){if(this._lockDispose=!0,r=this._events.length,r>0){for(a=0;r>a;++a){var s=this._events[a];this._proxy._dispatchEvent(s.type,s),s.type===t.EventObject.SOUND_EVENT&&this._eventManager._dispatchEvent(s.type,s),s.returnToPool()}this._events.length=0}if(r=this._actions.length,r>0){for(a=0;r>a;++a){var o=this._actions[a];if(null!==o.slot){var l=this.getSlot(o.slot.name);if(null!==l){var h=l.childArmature;null!==h&&h._doAction(o)}}else if(null!==o.bone)for(var _=0,u=this._slots;_<u.length;_++){var l=u[_],h=l.childArmature;null!==h&&h._doAction(o)}else this._doAction(o)}this._actions.length=0}this._lockDispose=!1}this._delayDispose&&this.returnToPool()},i.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t){var i=this.getBone(t);if(null!==i&&(i.invalidUpdate(),e))for(var a=0,r=this._slots;a<r.length;a++){var n=r[a];n.parent===i&&n.invalidUpdate()}}else{for(var s=0,o=this._bones;s<o.length;s++){var i=o[s];i.invalidUpdate()}if(e)for(var l=0,h=this._slots;l<h.length;l++){var n=h[l];n.invalidUpdate()}}},i.prototype.containsPoint=function(t,e){for(var i=0,a=this._slots;i<a.length;i++){var r=a[i];if(r.containsPoint(t,e))return r}return null},i.prototype.intersectsSegment=function(t,e,i,a,r,n,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null);for(var o=t===i,l=0,h=0,_=0,u=0,p=0,c=0,d=0,m=0,f=null,g=null,y=0,v=this._slots;y<v.length;y++){var D=v[y],T=D.intersectsSegment(t,e,i,a,r,n,s);if(T>0){if(null===r&&null===n){f=D;break}if(null!==r){var b=o?r.y-e:r.x-t;0>b&&(b=-b),(null===f||l>b)&&(l=b,_=r.x,u=r.y,f=D,s&&(d=s.x))}if(null!==n){var b=n.x-t;0>b&&(b=-b),(null===g||b>h)&&(h=b,p=n.x,c=n.y,g=D,null!==s&&(m=s.y))}}}return null!==f&&null!==r&&(r.x=_,r.y=u,null!==s&&(s.x=d)),null!==g&&null!==n&&(n.x=p,n.y=c,null!==s&&(s.y=m)),f},i.prototype.getBone=function(t){for(var e=0,i=this._bones;e<i.length;e++){var a=i[e];if(a.name===t)return a}return null},i.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},i.prototype.getSlot=function(t){for(var e=0,i=this._slots;e<i.length;e++){var a=i[e];if(a.name===t)return a}return null},i.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,i=this._slots;e<i.length;e++){var a=i[e];if(a.display===t)return a}return null},i.prototype.addBone=function(e,i){void 0===i&&(i=null),t.DragonBones.assert(null!==e),e._setArmature(this),e._setParent(null!==i?this.getBone(i):null)},i.prototype.removeBone=function(e){t.DragonBones.assert(null!==e&&e.armature===this),e._setParent(null),e._setArmature(null)},i.prototype.addSlot=function(e,i){var a=this.getBone(i);t.DragonBones.assert(null!==e&&null!==a),e._setArmature(this),e._setParent(a)},i.prototype.removeSlot=function(e){t.DragonBones.assert(null!==e&&e.armature===this),e._setParent(null),e._setArmature(null)},i.prototype.replaceTexture=function(t){this.replacedTexture=t},i.prototype.getBones=function(){return this._bones},i.prototype.getSlots=function(){return this._slots},Object.defineProperty(i.prototype,"name",{get:function(){return this.armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cacheFrameRate",{get:function(){return this.armatureData.cacheFrameRate},set:function(t){if(this.armatureData.cacheFrameRate!==t){this.armatureData.cacheFrames(t);for(var e=0,i=this._slots;e<i.length;e++){var a=i[e],r=a.childArmature;null!==r&&(r.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,i=this._slots;e<i.length;e++){var a=i[e],r=a.childArmature;null!==r&&(r.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots;e<i.length;e++){var a=i[e];a.invalidUpdate(),a.update(-1)}}},enumerable:!0,configurable:!0}),i.prototype.hasEventListener=function(t){return this._proxy.hasEvent(t)},i.prototype.addEventListener=function(t,e,i){this._proxy.addEvent(t,e,i)},i.prototype.removeEventListener=function(t,e,i){this._proxy.removeEvent(t,e,i)},i.prototype.enableAnimationCache=function(t){this.cacheFrameRate=t},i.prototype.getDisplay=function(){return this._display},i}(t.BaseObject);t.Armature=e,__reflect(e.prototype,"dragonBones.Armature",["dragonBones.IAnimateble"])}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.animationPose=new t.Transform,i.constraints=[],i._bones=[],i._slots=[],i}return __extends(i,e),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){e.prototype._onClear.call(this);for(var t=0,i=this.constraints;t<i.length;t++){var a=i[t];a.returnToPool()}this.offsetMode=1,this.constraints.length=0,this.boneData=null,this._transformDirty=!1,this._childrenTransformDirty=!1,this._blendDirty=!1,this._localDirty=!0,this._visible=!0,this._cacheState=0,this._cachedFrameIndex=-1,this._blendLayer=0,this._blendLeftWeight=1,this._blendLayerWeight=0,this.animationPose.identity(),this._bones.length=0,this._slots.length=0,this._cachedFrameIndices=null},i.prototype._updateGlobalTransformMatrix=function(e){var i=this._armature.flipX,a=this._armature.flipY===t.DragonBones.yDown,r=this.global,n=this.globalTransformMatrix,s=null!==this._parent,o=0;if(1===this.offsetMode?(r.x=this.origin.x+this.offset.x+this.animationPose.x,r.y=this.origin.y+this.offset.y+this.animationPose.y,r.skew=this.origin.skew+this.offset.skew+this.animationPose.skew,r.rotation=this.origin.rotation+this.offset.rotation+this.animationPose.rotation,r.scaleX=this.origin.scaleX*this.offset.scaleX*this.animationPose.scaleX,r.scaleY=this.origin.scaleY*this.offset.scaleY*this.animationPose.scaleY):0===this.offsetMode?r.copyFrom(this.origin).add(this.animationPose):(s=!1,r.copyFrom(this.offset)),s){var l=this._parent.globalTransformMatrix;if(this.boneData.inheritScale)this.boneData.inheritRotation||(this._parent.updateGlobalTransform(),o=this._parent.global.rotation,r.rotation-=o),r.toMatrix(n),n.concat(l),this.boneData.inheritTranslation?(r.x=n.tx,r.y=n.ty):(n.tx=r.x,n.ty=r.y),e?r.fromMatrix(n):this._globalDirty=!0;else{if(this.boneData.inheritTranslation){var h=r.x,_=r.y;r.x=l.a*h+l.c*_+l.tx,r.y=l.d*_+l.b*h+l.ty}else i&&(r.x=-r.x),a&&(r.y=-r.y);this.boneData.inheritRotation?(this._parent.updateGlobalTransform(),o=this._parent.global.rotation,this._armature.armatureData.isRightTransform&&l.a*l.d-l.b*l.c<0&&(o-=2*r.rotation,this._parent.global.scaleX<0&&(o+=Math.PI),(i!==a||this.boneData.inheritReflection)&&(r.skew+=Math.PI)),r.rotation+=o):(i||a)&&(i&&a?o=Math.PI:(o=2*-r.rotation,i&&(o+=Math.PI),r.skew+=Math.PI),r.rotation+=o),r.toMatrix(n)}}else(i||a)&&(i&&(r.x=-r.x),a&&(r.y=-r.y),i&&a?o=Math.PI:(o=2*-r.rotation,i&&(o+=Math.PI),r.skew+=Math.PI),r.rotation+=o),r.toMatrix(n)},i.prototype._setArmature=function(t){if(this._armature!==t){var e=null,i=null;if(null!==this._armature&&(e=this.getSlots(),i=this.getBones(),this._armature._removeBoneFromBoneList(this)),this._armature=t,null!==this._armature&&this._armature._addBoneToBoneList(this),null!==e)for(var a=0,r=e;a<r.length;a++){var n=r[a];n.parent===this&&n._setArmature(this._armature)}if(null!==i)for(var s=0,o=i;s<o.length;s++){var l=o[s];l.parent===this&&l._setArmature(this._armature)}}},i.prototype.init=function(t){null===this.boneData&&(this.boneData=t,this.name=this.boneData.name,this.origin=this.boneData.transform)},i.prototype.addConstraint=function(t){this.constraints.indexOf(t)<0&&this.constraints.push(t)},i.prototype.update=function(t){if(this._blendDirty=!1,t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this.constraints.length>0)for(var i=0,a=this.constraints;i<a.length;i++){var r=a[i];r.update()}this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this.constraints.length>0)for(var n=0,s=this.constraints;n<s.length;n++){var r=s[n];r.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var o=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(o),o&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature.armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature.armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},i.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},i.prototype.invalidUpdate=function(){this._transformDirty=!0},i.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},i.prototype.getBones=function(){this._bones.length=0;for(var t=0,e=this._armature.getBones();t<e.length;t++){var i=e[t];i.parent===this&&this._bones.push(i)}return this._bones},i.prototype.getSlots=function(){this._slots.length=0;for(var t=0,e=this._armature.getSlots();t<e.length;t++){var i=e[t];i.parent===this&&this._slots.push(i)}return this._slots},Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,i=this._armature.getSlots();e<i.length;e++){var a=i[e];a._parent===this&&a._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return this.boneData.length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slot",{get:function(){for(var t=0,e=this._armature.getSlots();t<e.length;t++){var i=e[t];if(i.parent===this)return i}return null},enumerable:!0,configurable:!0}),i}(t.TransformObject);t.Bone=e,__reflect(e.prototype,"dragonBones.Bone")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.target=null,this.bone=null,this.root=null},e}(t.BaseObject);e._helpMatrix=new t.Matrix,e._helpTransform=new t.Transform,e._helpPoint=new t.Point,t.Constraint=e,__reflect(e.prototype,"dragonBones.Constraint");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.IKConstraint]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bendPositive=!1,this.scaleEnabled=!1,this.weight=1},e.prototype._computeA=function(){var t=this.target.global,e=this.bone.global,i=this.bone.globalTransformMatrix,a=Math.atan2(t.y-e.y,t.x-e.x);e.scaleX<0&&(a+=Math.PI),e.rotation+=(a-e.rotation)*this.weight,e.toMatrix(i)},e.prototype._computeB=function(){var t=this.bone.boneData.length,e=this.root,i=this.target.global,a=e.global,r=this.bone.global,n=this.bone.globalTransformMatrix,s=n.a*t,o=n.b*t,l=s*s+o*o,h=Math.sqrt(l),_=r.x-a.x,u=r.y-a.y,p=_*_+u*u,c=Math.sqrt(p),d=Math.atan2(u,_);_=i.x-a.x,u=i.y-a.y;var m=_*_+u*u,f=Math.sqrt(m),g=0;if(f>=h+c||c>=f+h||h>=f+c)g=Math.atan2(i.y-a.y,i.x-a.x),f>=h+c||h>c&&(g+=Math.PI);else{var y=(p-l+m)/(2*m),v=Math.sqrt(p-y*y*m)/f,D=a.x+_*y,T=a.y+u*y,b=-u*v,E=_*v,A=!1;if(null!==e._parent){var O=e._parent.globalTransformMatrix;A=O.a*O.d-O.b*O.c<0}A!==this.bendPositive?(r.x=D-b,r.y=T-E):(r.x=D+b,r.y=T+E),g=Math.atan2(r.y-a.y,r.x-a.x)}var x=(g-d)*this.weight;a.rotation+=x,a.toMatrix(e.globalTransformMatrix);var S=d+x;r.x=a.x+Math.cos(S)*c,r.y=a.y+Math.sin(S)*c;var B=Math.atan2(i.y-r.y,i.x-r.x);r.scaleX<0&&(B+=Math.PI),x=(B-r.rotation)*this.weight,r.rotation+=x,r.toMatrix(n)},e.prototype.update=function(){null===this.root?(this.bone.updateByConstraint(),this._computeA()):(this.root.updateByConstraint(),this.bone.updateByConstraint(),this._computeB())
},e}(e);t.IKConstraint=i,__reflect(i.prototype,"dragonBones.IKConstraint")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._addingArmature=!1,e._removingArmature=!1,e._text=new egret.TextField,e._armatures=[],e._resourceGroup="performanceTest",e._resourceConfigURL="resource/test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){this._text.size=20,this._text.textAlign=egret.HorizontalAlign.CENTER,this._text.text="",this.addChild(this._text),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this);for(var t=0;3e3>t;++t)this._addArmature();this._resetPosition(),this._updateText()},e.prototype._enterFrameHandler=function(t){if(this._addingArmature){for(var e=0;5>e;++e)this._addArmature();this._resetPosition(),this._updateText()}if(this._removingArmature){for(var e=0;5>e;++e)this._removeArmature();this._resetPosition(),this._updateText()}},e.prototype._touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:var e=t.stageX>.5*this.stage.stageWidth;this._addingArmature=e,this._removingArmature=!e;break;case egret.TouchEvent.TOUCH_END:this._addingArmature=!1,this._removingArmature=!1}},e.prototype._addArmature=function(){0==this._armatures.length&&(dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(this._resourceGroup)),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes(this._resourceGroup+"_textureData"),RES.getRes(this._resourceGroup+"_texture")));var t=dragonBones.EgretFactory.factory.buildArmatureDisplay("Dragon");t.scaleX=t.scaleY=.7,t.armature.cacheFrameRate=24;var e="walk";t.animation.play(e,0),this._armatures.push(t),this.addChild(t)},e.prototype._removeArmature=function(){if(0!=this._armatures.length){var t=this._armatures.pop();this.removeChild(t),t.dispose(),0==this._armatures.length&&dragonBones.EgretFactory.factory.clear(!0)}},e.prototype._resetPosition=function(){var t=this._armatures.length;if(t)for(var e=50,i=150,a=100,r=this.stage.stageWidth-2*e,n=Math.floor(r/a),s=.5*(this.stage.stageWidth-n*a),o=r/n,l=(this.stage.stageHeight-2*i)/Math.ceil(t/n),h=0,_=t;_>h;++h){var u=this._armatures[h],p=Math.floor(h/n);u.x=h%n*o+s,u.y=p*l+i}},e.prototype._updateText=function(){this._text.text="Count: "+this._armatures.length+" \nTouch screen left to decrease count / right to increase count.",this._text.width=this.stage.stageWidth,this._text.x=0,this._text.y=this.stage.stageHeight-60},e}(BaseTest);t.PerformanceTest=e,__reflect(e.prototype,"demosEgret.PerformanceTest")}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._addingArmature=!1,e._removingArmature=!1,e._text=new egret.TextField,e._armatures=[],e._resourceConfigURL="resource/hello_movie.res.json",e}return __extends(e,t),e.prototype._onStart=function(){this._text.size=20,this._text.textAlign=egret.HorizontalAlign.CENTER,this._text.text="",this.addChild(this._text),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this);for(var t=0;100>t;++t)this._addArmature();this._resetPosition(),this._updateText()},e.prototype._enterFrameHandler=function(t){if(this._addingArmature){for(var e=0;5>e;++e)this._addArmature();this._resetPosition(),this._updateText()}if(this._removingArmature){for(var e=0;5>e;++e)this._removeArmature();this._resetPosition(),this._updateText()}},e.prototype._touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:var e=t.stageX>.5*this.stage.stageWidth;this._addingArmature=e,this._removingArmature=!e;break;case egret.TouchEvent.TOUCH_END:this._addingArmature=!1,this._removingArmature=!1}},e.prototype._addArmature=function(){0==this._armatures.length&&dragonBones.addMovieGroup(RES.getRes("movie"),RES.getRes("texture"));var t=dragonBones.buildMovie("Dragon");t.scaleX=t.scaleY=.7;var e="walk";t.animation.play(e,0),this._armatures.push(t),this.addChild(t)},e.prototype._removeArmature=function(){if(0!=this._armatures.length){var t=this._armatures.pop();this.removeChild(t),t.dispose(),0==this._armatures.length&&dragonBones.removeAllMovieGroup()}},e.prototype._resetPosition=function(){var t=this._armatures.length;if(t)for(var e=50,i=150,a=100,r=this.stage.stageWidth-2*e,n=Math.floor(r/a),s=.5*(this.stage.stageWidth-n*a),o=r/n,l=(this.stage.stageHeight-2*i)/Math.ceil(t/n),h=0,_=t;_>h;++h){var u=this._armatures[h],p=Math.floor(h/n);u.x=h%n*o+s,u.y=p*l+i}},e.prototype._updateText=function(){this._text.text="Count: "+this._armatures.length+" \nTouch screen left to decrease count / right to increase count.",this._text.width=this.stage.stageWidth,this._text.x=0,this._text.y=this.stage.stageHeight-60},e}(BaseTest);t.PerformanceTestMovie=e,__reflect(e.prototype,"demosEgret.PerformanceTestMovie")}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._resourceGroup="animationBaseTest",e._resourceConfigURL="resource/test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(this._resourceGroup+"_binary")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes(this._resourceGroup+"_textureData"),RES.getRes(this._resourceGroup+"_texture")),this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("progressBar"),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=this.stage.stageWidth>=300?1:this.stage.stageWidth/330,this.addChild(this._armatureDisplay),this._armatureDisplay.addEventListener(dragonBones.EventObject.START,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._animationEventHandler,this);var t=this._armatureDisplay.animation.animationConfig;t.name="test",t.animation="idle",t.playTimes=1,this._armatureDisplay.animation.playConfig(t),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._touchHandler,this)},e.prototype._touchHandler=function(t){var e=Math.min(Math.max((t.stageX-this._armatureDisplay.x+300*this._armatureDisplay.scaleX)/600*this._armatureDisplay.scaleX,0),1);switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._armatureDisplay.animation.gotoAndStopByProgress("idle",e);break;case egret.TouchEvent.TOUCH_END:this._armatureDisplay.animation.play();break;case egret.TouchEvent.TOUCH_MOVE:if(t.touchDown){var i=this._armatureDisplay.animation.getState("idle");i&&(i.currentTime=i.totalTime*e)}}},e.prototype._animationEventHandler=function(t){console.log(t.eventObject.animationState.name,t.type,t.eventObject.name?t.eventObject.name:"")},e}(BaseTest);t.AnimationBaseTest=e,__reflect(e.prototype,"demosEgret.AnimationBaseTest")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(){function t(){}return t.hasArmature=function(e){return t.armatures.indexOf(e)>=0},t.addArmature=function(e){e&&t.armatures.indexOf(e)<0&&t.armatures.push(e)},t.removeArmature=function(e){if(e){var i=t.armatures.indexOf(e);i>=0&&t.armatures.splice(i,1)}},t}();e.VERSION="5.1.0",e.ARGUMENT_ERROR="Argument error.",e.yDown=!0,e.debug=!1,e.debugDraw=!1,e.armatures=[],e.warn=console.warn,e.assert=console.assert,t.DragonBones=e,__reflect(e.prototype,"dragonBones.DragonBones")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._displayIndex=0,e._replaceDisplays=["display0002","display0003","display0004","display0005","display0006","display0007","display0008","display0009","display0010","meshA","meshB","mesh"],e._factory=dragonBones.EgretFactory.factory,e._armatureDisplay=null,e._resourceConfigURL="resource/replace_slot_display.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=this;this._factory.parseDragonBonesData(RES.getRes("dragonBonesData")),this._factory.parseTextureAtlasData(RES.getRes("textureDataA"),RES.getRes("textureA")),this._armatureDisplay=this._factory.buildArmatureDisplay("MyArmature"),this._armatureDisplay.animation.timeScale=.1,this._armatureDisplay.animation.play(),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight,this.addChild(this._armatureDisplay),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t._replaceDisplay()},this),document.addEventListener("keydown",function(e){t._armatureDisplay.armature.replacedTexture?t._armatureDisplay.armature.replacedTexture=null:t._armatureDisplay.armature.replacedTexture=RES.getRes("textureRP")})},e.prototype._replaceDisplay=function(){this._displayIndex=(this._displayIndex+1)%this._replaceDisplays.length;var t=this._replaceDisplays[this._displayIndex];if(t.indexOf("mesh")>=0)switch(t){case"meshA":this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyMesh","meshA","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyDisplay","ball","display0002",this._armatureDisplay.armature.getSlot("mesh"));break;case"meshB":this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyMesh","meshB","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyDisplay","ball","display0003",this._armatureDisplay.armature.getSlot("mesh"));break;case"mesh":this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyMesh","mesh","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyDisplay","ball","display0005",this._armatureDisplay.armature.getSlot("mesh"))}else this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyDisplay","ball",t,this._armatureDisplay.armature.getSlot("ball"))},e}(BaseTest);t.ReplaceSlotDisplay=e,__reflect(e.prototype,"demosEgret.ReplaceSlotDisplay")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return __extends(i,e),i._clockHandler=function(t){t*=.001;var e=t-i.clock.time;return i.clock.advanceTime(e),i.clock.time=t,!1},i.prototype._isSupportMesh=function(){return"webgl"===egret.Capabilities.renderMode||egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE?!0:(t.DragonBones.warn("Canvas can not support mesh, please change renderMode to webgl."),!1)},i.prototype._buildTextureAtlasData=function(e,i){return null!==e?e.texture=i:e=t.BaseObject.borrowObject(t.EgretTextureAtlasData),e},i.prototype._buildArmature=function(e){var a=t.BaseObject.borrowObject(t.Armature),r=new t.EgretArmatureDisplay;return a.init(e.armature,r,r,i.eventManager),a},i.prototype._buildSlot=function(e,i,a,r){var n=t.BaseObject.borrowObject(t.EgretSlot);return n.init(i,a,new egret.Bitmap,new egret.Mesh),n},i.prototype.buildArmatureDisplay=function(t,e,a,r){void 0===e&&(e=null),void 0===a&&(a=null),void 0===r&&(r=null);var n=this.buildArmature(t,e,a,r);return null!==n?(i.clock.add(n),n.display):null},i.prototype.getTextureDisplay=function(t,e){void 0===e&&(e=null);var i=this._getTextureData(null!==e?e:"",t);if(null!==i){if(null===i.texture){var a=i.parent.texture;null!==a&&(i.texture=new egret.Texture,i.texture._bitmapData=a._bitmapData,i.texture.$initData(i.region.x,i.region.y,i.region.width,i.region.height,0,0,i.region.width,i.region.height,a.textureWidth,a.textureHeight))}return new egret.Bitmap(i.texture)}return null},Object.defineProperty(i.prototype,"soundEventManager",{get:function(){return i.eventManager},enumerable:!0,configurable:!0}),i.prototype.addSkeletonData=function(t,e){void 0===e&&(e=null),this.addDragonBonesData(t,e)},i.prototype.getSkeletonData=function(t){return this.getDragonBonesData(t)},i.prototype.removeSkeletonData=function(t){this.removeDragonBonesData(t)},i.prototype.addTextureAtlas=function(t,e){void 0===e&&(e=null),this.addTextureAtlasData(t,e)},i.prototype.getTextureAtlas=function(t){return this.getTextureAtlasData(t)},i.prototype.removeTextureAtlas=function(t){this.removeTextureAtlasData(t)},i.prototype.buildFastArmature=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=null),this.buildArmature(t,e,i)},i.prototype.dispose=function(){this.clear()},Object.defineProperty(i.prototype,"soundEventManater",{get:function(){return i.eventManager},enumerable:!0,configurable:!0}),i}(t.BaseFactory);e.clock=new t.WorldClock(.001*egret.getTimer()),e.factory=new e,e.eventManager=new t.EgretArmatureDisplay,t.EgretFactory=e,__reflect(e.prototype,"dragonBones.EgretFactory"),egret.startTick(e._clockHandler,e)}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e;!function(t){var e=function(t){function e(){var i=t.call(this)||this;return i._left=!1,i._right=!1,i._player=null,i._bullets=[],e.instance=i,i._resourceConfigURL="resource/knight.res.json",i}return __extends(e,t),e.prototype._onStart=function(){e.STAGE_WIDTH=this.stage.stageWidth,e.STAGE_HEIGHT=this.stage.stageHeight,e.GROUND=e.STAGE_HEIGHT-100,dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("dragonBonesData_bin")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("textureDataA"),RES.getRes("textureA")),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),document.addEventListener("keydown",this._keyHandler),document.addEventListener("keyup",this._keyHandler),this._player=new i;var t=new egret.TextField;t.size=20,t.textAlign=egret.HorizontalAlign.CENTER,t.text="Press W/A/S/D to move. Press SPACE to switch weapons. Press Q/E to upgrade weapon. \nClick to attack.",t.width=e.STAGE_WIDTH,t.x=0,t.y=e.STAGE_HEIGHT-60,this.addChild(t)},e.prototype.addBullet=function(t){this._bullets.push(t)},e.prototype._touchHandler=function(t){this._player.attack()},e.prototype._keyHandler=function(t){var i="keydown"==t.type;switch(t.keyCode){case 37:case 65:e.instance._left=i,e.instance._updateMove(-1);break;case 39:case 68:e.instance._right=i,e.instance._updateMove(1);break;case 38:case 87:i&&e.instance._player.jump();break;case 83:case 40:break;case 81:i&&e.instance._player.upgradeWeapon(-1);break;case 69:i&&e.instance._player.upgradeWeapon(1);break;case 32:i&&e.instance._player.switchWeapon()}},e.prototype._enterFrameHandler=function(t){this._player.update();for(var e=this._bullets.length;e--;){var i=this._bullets[e];i.update()&&this._bullets.splice(e,1)}dragonBones.WorldClock.clock.advanceTime(-1)},e.prototype._updateMove=function(t){this._left&&this._right?this._player.move(t):this._left?this._player.move(-1):this._right?this._player.move(1):this._player.move(0)},e}(BaseTest);e.STAGE_WIDTH=0,e.STAGE_HEIGHT=0,e.GROUND=300,e.G=.6,e.instance=null,t.Game=e,__reflect(e.prototype,"demosEgret.knight.Game");var i=function(){function t(){this._isJumping=!1,this._isAttacking=!1,this._hitCount=0,this._weaponIndex=0,this._weaponName=t.WEAPON_LIST[0],this._weaponsLevel=[0,0,0,0],this._faceDir=1,this._moveDir=0,this._speedX=0,this._speedY=0,this._armature=null,this._armatureDisplay=null,this._armArmature=null,this._armature=dragonBones.EgretFactory.factory.buildArmature("knight"),this._armatureDisplay=this._armature.display,this._armatureDisplay.x=.5*e.STAGE_WIDTH,this._armatureDisplay.y=e.GROUND,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=1,this._armArmature=this._armature.getSlot("armOutside").childArmature,this._armArmature.addEventListener(dragonBones.EventObject.COMPLETE,this._armEventHandler,this),this._armArmature.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._armEventHandler,this),this._updateAnimation(),e.instance.addChild(this._armatureDisplay),dragonBones.WorldClock.clock.add(this._armature)}return t.prototype.move=function(t){this._moveDir!=t&&(this._moveDir=t,this._moveDir&&this._faceDir!=this._moveDir&&(this._faceDir=this._moveDir,this._armatureDisplay.scaleX*=-1),this._updateAnimation())},t.prototype.jump=function(){this._isJumping||(this._isJumping=!0,this._speedY=t.JUMP_SPEED,this._armature.animation.fadeIn("jump"))},t.prototype.attack=function(){if(!this._isAttacking){this._isAttacking=!0;var t="attack_"+this._weaponName+"_"+(this._hitCount+1);this._armArmature.animation.fadeIn(t)}},t.prototype.switchWeapon=function(){this._isAttacking=!1,this._hitCount=0,this._weaponIndex++,this._weaponIndex>=t.WEAPON_LIST.length&&(this._weaponIndex=0),this._weaponName=t.WEAPON_LIST[this._weaponIndex],this._armArmature.animation.fadeIn("ready_"+this._weaponName)},t.prototype.upgradeWeapon=function(e){var i=this._weaponsLevel[this._weaponIndex]+e;i%=t.MAX_WEAPON_LEVEL,0>i&&(i=t.MAX_WEAPON_LEVEL+i),this._weaponsLevel[this._weaponIndex]=i,"bow"==this._weaponName?this._armArmature.getSlot("bow").childArmature=dragonBones.EgretFactory.factory.buildArmature("knightFolder/"+this._weaponName+"_"+(i+1)):dragonBones.EgretFactory.factory.replaceSlotDisplay(null,"weapons","weapon","knightFolder/"+this._weaponName+"_"+(i+1),this._armArmature.getSlot("weapon"))},t.prototype.update=function(){this._updatePosition()},t.prototype._armEventHandler=function(e){switch(e.type){case dragonBones.EventObject.COMPLETE:this._isAttacking=!1,this._hitCount=0;var i="ready_"+this._weaponName;this._armArmature.animation.fadeIn(i);break;case dragonBones.EventObject.FRAME_EVENT:if("ready"==e.eventObject.name)this._isAttacking=!1,this._hitCount++;else if("fire"==e.eventObject.name){var a=e.eventObject.armature.getBone("bow");e.eventObject.armature.display.localToGlobal(a.global.x,a.global.y,t._globalPoint);var r=0;switch(r=this._faceDir>0?a.global.rotation+e.eventObject.armature.display.rotation*dragonBones.Transform.DEG_RAD:Math.PI-(a.global.rotation+e.eventObject.armature.display.rotation)*dragonBones.Transform.DEG_RAD,this._weaponsLevel[this._weaponIndex]){case 0:this._fire(t._globalPoint,r);break;case 1:this._fire(t._globalPoint,r+3/180*Math.PI),this._fire(t._globalPoint,r-3/180*Math.PI);break;case 2:this._fire(t._globalPoint,r+6/180*Math.PI),this._fire(t._globalPoint,r),this._fire(t._globalPoint,r-6/180*Math.PI)}}}},t.prototype._fire=function(t,i){var r=new a("arrow",i,20,t);e.instance.addBullet(r)},t.prototype._updateAnimation=function(){this._isJumping||(0==this._moveDir?(this._speedX=0,this._armature.animation.fadeIn("stand")):(this._speedX=t.MOVE_SPEED*this._moveDir,this._armature.animation.fadeIn("run")))},t.prototype._updatePosition=function(){0!=this._speedX&&(this._armatureDisplay.x+=this._speedX,this._armatureDisplay.x<0?this._armatureDisplay.x=0:this._armatureDisplay.x>e.STAGE_WIDTH&&(this._armatureDisplay.x=e.STAGE_WIDTH)),0!=this._speedY&&(this._speedY<0&&this._speedY+e.G>=0&&this._armature.animation.fadeIn("fall"),this._speedY+=e.G,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.y>e.GROUND&&(this._armatureDisplay.y=e.GROUND,this._isJumping=!1,this._speedY=0,this._speedX=0,this._updateAnimation()))},t}();i.MAX_WEAPON_LEVEL=3,i.JUMP_SPEED=-20,i.MOVE_SPEED=4,i.WEAPON_LIST=["sword","pike","axe","bow"],i._globalPoint=new egret.Point,__reflect(i.prototype,"Hero");var a=function(){function t(t,i,a,r){this._speedX=0,this._speedY=0,this._armature=null,this._armatureDisplay=null,this._speedX=Math.cos(i)*a,this._speedY=Math.sin(i)*a,this._armature=dragonBones.EgretFactory.factory.buildArmature(t),this._armatureDisplay=this._armature.display,this._armatureDisplay.x=r.x,this._armatureDisplay.y=r.y,this._armatureDisplay.rotation=i*dragonBones.Transform.RAD_DEG,this._armature.animation.play("idle"),dragonBones.WorldClock.clock.add(this._armature),e.instance.addChild(this._armatureDisplay)}return t.prototype.update=function(){return this._speedY+=e.G,this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.rotation=Math.atan2(this._speedY,this._speedX)*dragonBones.Transform.RAD_DEG,this._armatureDisplay.x<-100||this._armatureDisplay.x>=e.STAGE_WIDTH+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=e.STAGE_HEIGHT+100?(dragonBones.WorldClock.clock.remove(this._armature),e.instance.removeChild(this._armatureDisplay),this._armature.dispose(),!0):!1},t}();__reflect(a.prototype,"Bullet")}(e=t.knight||(t.knight={}))}(demosEgret||(demosEgret={}));var dragonBones;!function(t){function e(t,e){for(var i=0,a=t.length;a>i;++i){var r=t[i];if(r.name===e)return r}return null}function i(t){if(t.groupName){var i=u[t.groupName];if(i){var a=e(i.movie||i.animation,t.movieName);if(a)return t.groupConfig=i,t.movieConfig=a,!0}}if(!t.groupName)for(var r in u){var i=u[r];if(!t.groupName){var a=e(i.movie||i.animation,t.movieName);if(a)return t.groupName=r,t.groupConfig=i,t.movieConfig=a,!0}}return!1}function a(t){return null!=u[t]}function r(t,e,i){if(void 0===i&&(i=null),!t)throw new Error;var a=new egret.ByteArray(t);a.endian=egret.Endian.LITTLE_ENDIAN,a.position=8;var r=JSON.parse(a.readUTF());r.offset=a.position,r.arrayBuffer=t,r.textures=[];var n=r.offset%4;n&&(r.offset+=4-n);for(var s=0,o=r.position.length;o>s;s+=3)switch(s/3){case 1:r.displayFrameArray=new Int16Array(r.arrayBuffer,r.offset+r.position[s],r.position[s+1]/r.position[s+2]);break;case 2:r.rectangleArray=new Float32Array(r.arrayBuffer,r.offset+r.position[s],r.position[s+1]/r.position[s+2]);break;case 3:r.transformArray=new Float32Array(r.arrayBuffer,r.offset+r.position[s],r.position[s+1]/r.position[s+2]);break;case 4:r.colorArray=new Int16Array(r.arrayBuffer,r.offset+r.position[s],r.position[s+1]/r.position[s+2])}if(i=i||r.name,u[i],u[i]=r,e instanceof Array)for(var s=0,o=e.length;o>s;++s){var l=e[s];r.textures.push(l)}else r.textures.push(e)}function n(t){var e=u[t];e&&delete u[t]}function s(){for(var t in u)delete u[t]}function o(e,a){void 0===a&&(a=null);var r={movieName:e,groupName:a};if(i(r)){var n=new d(r);return t.EgretFactory.factory,n.clock=t.EgretFactory.clock,n}return console.warn("No movie named: "+e),null}function l(t){var e=u[t];if(e){for(var i=[],a=e.movie||e.animation,r=0,n=a.length;n>r;++r)i.push(a[r].name);return i}return console.warn("No group named: "+t),null}var h=new egret.Rectangle,_=new egret.Matrix,u={};t.hasMovieGroup=a,t.addMovieGroup=r,t.removeMovieGroup=n,t.removeAllMovieGroup=s,t.buildMovie=o,t.getMovieNames=l;var p=function(t){function e(e){var i=t.call(this,e)||this;return i.name="",i.slotName="",i.clipName="",i}return __extends(e,t),Object.defineProperty(e.prototype,"armature",{get:function(){return this.movie},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bone",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationState",{get:function(){return{name:this.clipName}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameLabel",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movementID",{get:function(){return this.clipName},enumerable:!0,configurable:!0}),e}(egret.Event);p.START="start",p.LOOP_COMPLETE="loopComplete",p.COMPLETE="complete",p.FRAME_EVENT="frameEvent",p.SOUND_EVENT="soundEvent",t.MovieEvent=p,__reflect(p.prototype,"dragonBones.MovieEvent");var c=function(t){function e(e){var i=t.call(this)||this;return i.displayIndex=-1,i.colorIndex=-1,i.transformIndex=-1,i.rawDisplay=new egret.Bitmap,i.childMovies={},i.displayConfig=null,i.childMovie=null,i.colorFilter=null,i.display=i.rawDisplay,i.config=e,i.rawDisplay.name=i.config.name,null==i.config.blendMode&&(i.config.blendMode=0),i}return __extends(e,t),e.prototype.dispose=function(){this.rawDisplay=null,this.childMovies=null,this.config=null,this.displayConfig=null,this.display=null,this.childMovie=null,this.colorFilter=null},e}(egret.HashObject);__reflect(c.prototype,"MovieSlot");var d=function(e){function i(t){var a=e.call(this)||this;a.timeScale=1,a.clipTimeScale=1,a._batchEnabled=!0,a._isLockDispose=!1,a._isDelayDispose=!1,a._isStarted=!1,a._isPlaying=!1,a._isReversing=!1,a._isCompleted=!1,a._playTimes=0,a._time=0,a._currentTime=0,a._currentPlayTimes=0,a._cacheFrameIndex=0,a._frameSize=0,a._cacheRectangle=null,a._clock=null,a._currentFrameConfig=null,a._clipNames=[],a._slots=[],a._childMovies=[],a._groupConfig=t.groupConfig,a._config=t.movieConfig,a._batchEnabled=!(a._config.isNested||a._config.hasChildAnimation),a._batchEnabled&&(a.$renderNode=new egret.sys.GroupNode,a.$renderNode.cleanBeforeRender=i._cleanBeforeRender),a._clipNames.length=0;for(var r=0,n=a._config.clip.length;n>r;++r)a._clipNames.push(a._config.clip[r].name);for(var r=0,n=a._config.slot.length;n>r;++r){var s=new c(a._config.slot[r]);a._updateSlotBlendMode(s),a._slots.push(s),a._batchEnabled?a.$renderNode.addNode(s.rawDisplay.$renderNode):a.addChild(s.rawDisplay)}return a._frameSize=2*a._slots.length,a.name=a._config.name,a.play(),a.advanceTime(1e-6),a.stop(),a}return __extends(i,e),i._cleanBeforeRender=function(){},i.prototype._configToEvent=function(t,e){e.movie=this,e.clipName=this._clipConfig.name,e.name=t.name,e.slotName=t.slot||""},i.prototype._onCrossFrame=function(e){for(var i=0,a=e.actionAndEvent.length;a>i;++i){var r=e.actionAndEvent[i];if(r)switch(r.type){case 11:if(t.EgretFactory.factory.soundEventManager.hasEventListener(p.SOUND_EVENT)){var n=egret.Event.create(p,p.SOUND_EVENT);this._configToEvent(r,n),t.EgretFactory.factory.soundEventManager.dispatchEvent(n),egret.Event.release(n)}break;case 10:if(this.hasEventListener(p.FRAME_EVENT)){var s=egret.Event.create(p,p.FRAME_EVENT);this._configToEvent(r,s),this.dispatchEvent(s),egret.Event.release(s)}break;case 0:if(r.slot){var o=this._getSlot(r.slot);o&&o.childMovie&&o.childMovie.play(r.name)}else this.play(r.name)}}},i.prototype._updateSlotBlendMode=function(t){var e="";switch(t.config.blendMode){case 0:e=egret.BlendMode.NORMAL;break;case 1:e=egret.BlendMode.ADD;break;case 5:e=egret.BlendMode.ERASE}e&&(this._batchEnabled?t.display.$renderNode.blendMode=egret.sys.blendModeToNumber(e):t.display.blendMode=e)},i.prototype._updateSlotColor=function(t,e,i,a,r,n,s,o,l){if(1!==i||1!==a||1!==r||0!==s||0!==o||0!==l||0!==n){t.colorFilter||(t.colorFilter=new egret.ColorMatrixFilter);var h=t.colorFilter.matrix;if(h[0]=i,h[6]=a,h[12]=r,h[18]=e,h[4]=s,h[9]=o,h[14]=l,h[19]=n,t.colorFilter.matrix=h,this._batchEnabled)t.display.$renderNode.filter=t.colorFilter,t.display.$renderNode.alpha=1;else{var _=t.display.filters;_||(_=[]),_.indexOf(t.colorFilter)<0&&_.push(t.colorFilter),t.display.filters=_,t.display.$setAlpha(1)}}else t.colorFilter&&(t.colorFilter=null),this._batchEnabled?(t.display.$renderNode.filter=null,t.display.$renderNode.alpha=e):(t.display.filters=null,t.display.$setAlpha(e))},i.prototype._updateSlotDisplay=function(t){var e=t.display||t.rawDisplay,i=t.childMovie;if(t.displayIndex>=0)if(t.displayConfig=this._groupConfig.display[t.displayIndex],1===t.displayConfig.type){var a=t.displayConfig.name in t.childMovies?t.childMovies[t.displayConfig.name]:null;a||(a=o(t.displayConfig.name,this._groupConfig.name),a&&(t.childMovies[t.displayConfig.name]=a)),a?(t.display=a,t.childMovie=a):(t.display=t.rawDisplay,t.childMovie=null)}else t.display=t.rawDisplay,t.childMovie=null;else t.displayConfig=null,t.display=t.rawDisplay,t.childMovie=null;if(t.display!==e&&(e&&(this.addChild(t.display),this.swapChildren(t.display,e),this.removeChild(e)),this._updateSlotBlendMode(t)),t.display===t.rawDisplay)if(t.displayConfig&&null!=t.displayConfig.regionIndex){if(!t.displayConfig.texture){var r=this._groupConfig.textures[t.displayConfig.textureIndex||0],n=4*t.displayConfig.regionIndex,s=this._groupConfig.rectangleArray[n],l=this._groupConfig.rectangleArray[n+1],h=this._groupConfig.rectangleArray[n+2],_=this._groupConfig.rectangleArray[n+3];t.displayConfig.texture=new egret.Texture,t.displayConfig.texture._bitmapData=r._bitmapData,t.displayConfig.texture.$initData(s,l,Math.min(h,r.textureWidth-s),Math.min(_,r.textureHeight-l),0,0,Math.min(h,r.textureWidth-s),Math.min(_,r.textureHeight-l),r.textureWidth,r.textureHeight)}if(this._batchEnabled){var u=t.displayConfig.texture,p=t.rawDisplay.$renderNode;egret.sys.RenderNode.prototype.cleanBeforeRender.call(t.rawDisplay.$renderNode),p.image=u._bitmapData,p.drawImage(u._bitmapX,u._bitmapY,u._bitmapWidth,u._bitmapHeight,u._offsetX,u._offsetY,u.textureWidth,u.textureHeight),p.imageWidth=u._sourceWidth,p.imageHeight=u._sourceHeight}else t.rawDisplay.visible=!0,t.rawDisplay.$setBitmapData(t.displayConfig.texture)}else this._batchEnabled?t.rawDisplay.$renderNode.image=null:(t.rawDisplay.visible=!1,t.rawDisplay.$setBitmapData(null));t.childMovie!==i&&(i&&(i.stop(),this._childMovies.slice(this._childMovies.indexOf(i),1)),t.childMovie&&(this._childMovies.indexOf(t.childMovie)<0&&this._childMovies.push(t.childMovie),t.config.action?t.childMovie.play(t.config.action):t.childMovie.play(t.childMovie._config.action)))},i.prototype._getSlot=function(t){for(var e=0,i=this._slots.length;i>e;++e){var a=this._slots[e];if(a.config.name===t)return a}return null},i.prototype.$render=function(){this._batchEnabled||e.prototype.$render.call(this)},i.prototype.$measureContentBounds=function(t){this._batchEnabled&&this._cacheRectangle?t.setTo(this._cacheRectangle.x,this._cacheRectangle.y,this._cacheRectangle.width-this._cacheRectangle.x,this._cacheRectangle.height-this._cacheRectangle.y):e.prototype.$measureContentBounds.call(this,t)},i.prototype.$doAddChild=function(t,i,a){return this._batchEnabled?(console.warn("Can not add child."),null):e.prototype.$doAddChild.call(this,t,i,a)},i.prototype.$doRemoveChild=function(t,i){return this._batchEnabled?(console.warn("Can not remove child."),null):e.prototype.$doRemoveChild.call(this,t,i)},i.prototype.dispose=function(){if(this._isLockDispose)this._isDelayDispose=!0;else{if(this._clock&&this._clock.remove(this),this._slots)for(var t=0,e=this._slots.length;e>t;++t)this._slots[t].dispose();this._isPlaying=!1,this._cacheRectangle=null,this._clock=null,this._groupConfig=null,this._config=null,this._clipConfig=null,this._currentFrameConfig=null,this._clipArray=null,this._clipNames=null,this._slots=null,this._childMovies=null}},i.prototype.advanceTime=function(t){if(this._isPlaying){this._isLockDispose=!0,0>t&&(t=-t),t*=this.timeScale,this._time+=t*this.clipTimeScale;var e=this._clipConfig.duration,i=e*this._playTimes,a=this._time,r=this._currentPlayTimes;if(this._playTimes>0&&(a>=i||-i>=a)?(this._isCompleted=!0,r=this._playTimes,a=0>a?0:e):(this._isCompleted=!1,0>a?(r=Math.floor(-a/e),a=e- -a%e):(r=Math.floor(a/e),a%=e),this._playTimes>0&&r>this._playTimes&&(r=this._playTimes)),this._currentTime===a)return;var n=Math.floor(a*this._clipConfig.cacheTimeToFrameScale);if(this._cacheFrameIndex!==n){this._cacheFrameIndex=n;var s=this._groupConfig.displayFrameArray,o=this._groupConfig.transformArray,l=this._groupConfig.colorArray,u=!0,c=!1,d=!1,m=this._cacheRectangle;this._cacheRectangle=this._clipConfig.cacheRectangles[this._cacheFrameIndex],this._batchEnabled&&!this._cacheRectangle&&(d=!0,this._cacheRectangle=new egret.Rectangle,this._clipConfig.cacheRectangles[this._cacheFrameIndex]=this._cacheRectangle);
for(var f=0,g=this._slots.length;g>f;++f){var y=(this.totalTime,this.totalTime,this.totalTime,this._slots[f]),v=this._frameSize*this._cacheFrameIndex+2*f;v>=this._clipArray.length&&(v=this._frameSize*(this._cacheFrameIndex-1)+2*f);var D=2*this._clipArray[v];if(D>=0){var T=s[D],b=8*s[D+1],E=6*this._clipArray[v+1],A=!1;if(y.displayIndex!==T&&(y.displayIndex=T,A=!0,this._updateSlotDisplay(y)),(y.colorIndex!==b||A)&&(y.colorIndex=b,y.colorIndex>=0?this._updateSlotColor(y,.01*l[b],.01*l[b+1],.01*l[b+2],.01*l[b+3],l[b+4],l[b+5],l[b+6],l[b+7]):this._updateSlotColor(y,1,1,1,1,0,0,0,0)),c=!0,y.transformIndex!==E)if(y.transformIndex=E,this._batchEnabled){var O=y.display.$renderNode.matrix;O||(O=y.display.$renderNode.matrix=new egret.Matrix),O.a=o[E],O.b=o[E+1],O.c=o[E+2],O.d=o[E+3],O.tx=o[E+4],O.ty=o[E+5]}else _.a=o[E],_.b=o[E+1],_.c=o[E+2],_.d=o[E+3],_.tx=o[E+4],_.ty=o[E+5],y.display.$setMatrix(_);if(this._batchEnabled&&d&&y.displayConfig){var O=y.display.$renderNode.matrix;h.x=0,h.y=0,h.width=y.displayConfig.texture.textureWidth,h.height=y.displayConfig.texture.textureHeight,O.$transformBounds(h),u?(u=!1,this._cacheRectangle.x=h.x,this._cacheRectangle.width=h.x+h.width,this._cacheRectangle.y=h.y,this._cacheRectangle.height=h.y+h.height):(this._cacheRectangle.x=Math.min(this._cacheRectangle.x,h.x),this._cacheRectangle.width=Math.max(this._cacheRectangle.width,h.x+h.width),this._cacheRectangle.y=Math.min(this._cacheRectangle.y,h.y),this._cacheRectangle.height=Math.max(this._cacheRectangle.height,h.y+h.height))}}else-1!==y.displayIndex&&(y.displayIndex=-1,this._updateSlotDisplay(y))}this._cacheRectangle&&(c&&d&&u&&m&&(this._cacheRectangle.x=m.x,this._cacheRectangle.y=m.y,this._cacheRectangle.width=m.width,this._cacheRectangle.height=m.height),this.$invalidateContentBounds())}if(this._isCompleted&&(this._isPlaying=!1),!this._isStarted&&(this._isStarted=!0,this.hasEventListener(p.START))){var x=egret.Event.create(p,p.START);x.movie=this,x.clipName=this._clipConfig.name,x.name="",x.slotName="",this.dispatchEvent(x)}this._isReversing=this._currentTime>a&&this._currentPlayTimes===r,this._currentTime=a;var S=this._clipConfig.frame?this._clipConfig.frame.length:0;if(S>0){var B=Math.floor(this._currentTime*this._config.frameRate),P=this._groupConfig.frame[this._clipConfig.frame[B]];if(this._currentFrameConfig!==P)if(S>1){var M=this._currentFrameConfig;if(this._currentFrameConfig=P,!M){var R=Math.floor(this._currentTime*this._config.frameRate);M=this._groupConfig.frame[this._clipConfig.frame[R]],this._isReversing||(this._currentTime<=M.position||this._currentPlayTimes!==r)&&(M=this._groupConfig.frame[M.prev])}if(this._isReversing)for(;M!==P;)this._onCrossFrame(M),M=this._groupConfig.frame[M.prev];else for(;M!==P;)M=this._groupConfig.frame[M.next],this._onCrossFrame(M)}else this._currentFrameConfig=P,this._currentFrameConfig&&this._onCrossFrame(this._currentFrameConfig)}if(this._currentPlayTimes!==r){if(this._currentPlayTimes=r,this.hasEventListener(p.LOOP_COMPLETE)){var C=egret.Event.create(p,p.LOOP_COMPLETE);C.movie=this,C.clipName=this._clipConfig.name,C.name="",C.slotName="",this.dispatchEvent(C),egret.Event.release(C)}if(this._isCompleted&&this.hasEventListener(p.COMPLETE)){var I=egret.Event.create(p,p.COMPLETE);I.movie=this,I.clipName=this._clipConfig.name,I.name="",I.slotName="",this.dispatchEvent(I),egret.Event.release(I)}}}this._isLockDispose=!1,this._isDelayDispose&&this.dispose()},i.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),t){for(var i=null,a=0,r=this._config.clip.length;r>a;++a){var n=this._config.clip[a];n.name===t&&(i=n)}i?(this._clipConfig=i,this._clipArray=new Int16Array(this._groupConfig.arrayBuffer,this._groupConfig.offset+this._groupConfig.position[0]+this._clipConfig.p,this._clipConfig.s/this._groupConfig.position[2]),this._clipConfig.cacheRectangles||(this._clipConfig.cacheRectangles=[]),this._isPlaying=!0,this._isStarted=!1,this._isCompleted=!1,0>e||e!==e?this._playTimes=this._clipConfig.playTimes:this._playTimes=e,this._time=0,this._currentTime=0,this._currentPlayTimes=0,this._cacheFrameIndex=-1,this._currentFrameConfig=null,this._cacheRectangle=null,this.clipTimeScale=1/this._clipConfig.scale):console.warn("No clip in movie.",this._config.name,t)}else this._clipConfig?this._isPlaying||this._isCompleted?this.play(this._clipConfig.name,this._playTimes):this._isPlaying=!0:this._config.action&&this.play(this._config.action,e)},i.prototype.stop=function(){this._isPlaying=!1},i.prototype.gotoAndPlay=function(t,e,i){void 0===t&&(t=null),void 0===i&&(i=-1),e%=this._clipConfig.duration,0>e&&(e+=this._clipConfig.duration),this.play(t,i),this._time=e,this._currentTime=e},i.prototype.gotoAndStop=function(t,e){void 0===t&&(t=null),e%=this._clipConfig.duration,0>e&&(e+=this._clipConfig.duration),this.play(t,1),this._time=e,this._currentTime=e,this.advanceTime(.001),this.stop()},i.prototype.hasClip=function(t){for(var e=0,i=this._config.clip.length;i>e;++e){var a=this._config.clip[e];if(a.name===t)return!0}return!1},Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isPlaying&&!this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isComplete",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalTime",{get:function(){return this._clipConfig?this._clipConfig.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPlayTimes",{get:function(){return this._currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playTimes",{get:function(){return this._playTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"groupName",{get:function(){return this._groupConfig.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipName",{get:function(){return this._clipConfig?this._clipConfig.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipNames",{get:function(){return this._clipNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){var e=this._clock;e&&e.remove(this),this._clock=t,this._clock&&this._clock.add(this)}},enumerable:!0,configurable:!0}),i.prototype.advanceTimeBySelf=function(e){e?this.clock=t.EgretFactory.clock:this.clock=null},Object.defineProperty(i.prototype,"display",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armature",{get:function(){return this},enumerable:!0,configurable:!0}),i.prototype.getAnimation=function(){return this},i.prototype.getArmature=function(){return this},i.prototype.getDisplay=function(){return this},i.prototype.hasAnimation=function(t){return this.hasClip(t)},i.prototype.invalidUpdate=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]},Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return this.clipName},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this.clipNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationList",{get:function(){return this.clipNames},enumerable:!0,configurable:!0}),i}(egret.DisplayObjectContainer);t.Movie=d,__reflect(d.prototype,"dragonBones.Movie",["dragonBones.IAnimateble"])}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}return __extends(i,e),i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];i.returnToPool()}for(var a in this._animations)delete this._animations[a];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._animationDirty=!1,this._timelineDirty=!1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},i.prototype._fadeOut=function(t){var e=0,i=this._animationStates.length,a=null;switch(t.fadeOutMode){case 1:for(;i>e;++e)a=this._animationStates[e],a.layer===t.layer&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(;i>e;++e)a=this._animationStates[e],a.group===t.group&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(;i>e;++e)a=this._animationStates[e],a.layer===t.layer&&a.group===t.group&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(;i>e;++e)a=this._animationStates[e],a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 0:}},i.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},i.prototype.advanceTime=function(t){0>t&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent&&(t*=this._armature._parent._armature.animation.timeScale),1!==this.timeScale&&(t*=this.timeScale);var e=this._animationStates.length;if(1===e){var i=this._animationStates[0];if(i._fadeState>0&&i._subFadeState>0)i.returnToPool(),this._animationStates.length=0,this._lastAnimationState=null;else{var a=i.animationData,r=a.cacheFrameRate;if(this._animationDirty&&r>0){this._animationDirty=!1;for(var n=0,s=this._armature.getBones();n<s.length;n++){var o=s[n];o._cachedFrameIndices=a.getBoneCachedFrameIndices(o.name)}for(var l=0,h=this._armature.getSlots();l<h.length;l++){var _=h[l];_._cachedFrameIndices=a.getSlotCachedFrameIndices(_.name)}}this._timelineDirty&&i.updateTimelines(),i.advanceTime(t,r)}}else if(e>1){for(var u=0,p=0;e>u;++u){var i=this._animationStates[u];i._fadeState>0&&i._subFadeState>0?(p++,i.returnToPool(),this._animationDirty=!0,this._lastAnimationState===i&&(this._lastAnimationState=null)):(p>0&&(this._animationStates[u-p]=i),this._timelineDirty&&i.updateTimelines(),i.advanceTime(t,0)),u===e-1&&p>0&&(this._animationStates.length-=p,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1;this._timelineDirty=!1},i.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];i.returnToPool()}this._animationDirty=!1,this._timelineDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},i.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t){var e=this.getState(t);null!==e&&e.stop()}else for(var i=0,a=this._animationStates;i<a.length;i++){var e=a[i];e.stop()}},i.prototype.playConfig=function(e){var i=e.animation;if(!(i in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+i),null;var a=this._animations[i];if(5===e.fadeOutMode)for(var r=0,n=this._animationStates;r<n.length;r++){var s=n[r];if(s.animationData===a)return s}(e.fadeInTime<0||e.fadeInTime!==e.fadeInTime)&&(0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime=a.fadeInTime),(e.fadeOutTime<0||e.fadeOutTime!==e.fadeOutTime)&&(e.fadeOutTime=e.fadeInTime),(e.timeScale<=-100||e.timeScale!==e.timeScale)&&(e.timeScale=1/a.scale),a.frameCount>1?(e.position!==e.position?e.position=0:e.position<0?(e.position%=a.duration,e.position=a.duration-e.position):e.position===a.duration?e.position-=1e-6:e.position>a.duration&&(e.position%=a.duration),e.duration>0&&e.position+e.duration>a.duration&&(e.duration=a.duration-e.position),e.playTimes<0&&(e.playTimes=a.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var o=t.BaseObject.borrowObject(t.AnimationState);if(o.init(this._armature,a,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var l=!1,h=0,_=this._animationStates.length;_>h;++h){var u=this._animationStates[h];if(!(u.layer>=u.layer)){l=!0,this._animationStates.splice(h,0,u);break}}l||this._animationStates.push(o)}else this._animationStates.push(o);for(var p=0,c=this._armature.getSlots();p<c.length;p++){var d=c[p],m=d.childArmature;null!==m&&m.inheritAnimation&&m.animation.hasAnimation(i)&&null===m.animation.getState(i)&&m.animation.fadeIn(i)}return e.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=o,o},i.prototype.fadeIn=function(t,e,i,a,r,n){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===a&&(a=0),void 0===r&&(r=null),void 0===n&&(n=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=n,this._animationConfig.playTimes=i,this._animationConfig.layer=a,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},i.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var i=this._armature.armatureData.defaultAnimation;i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},i.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var a=t in this._animations?this._animations[t]:null;return null!==a&&(this._animationConfig.position=a.duration*e/a.frameCount),this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var a=t in this._animations?this._animations[t]:null;return null!==a&&(this._animationConfig.position=a.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},i.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return null!==i&&i.stop(),i},i.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return null!==i&&i.stop(),i},i.prototype.getStates=function(){return this._animationStates},i.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var i=this._animationStates[e];if(i.name===t)return i}return null},i.prototype.hasAnimation=function(t){return t in this._animations},Object.defineProperty(i.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];if(i.isPlaying)return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++){var i=e[t];if(!i.isCompleted)return!1}return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){this._animationNames.length=0;for(var e in this._animations)delete this._animations[e];for(var e in t)this._animations[e]=t[e],this._animationNames.push(e)}},enumerable:!0,configurable:!0}),i.prototype.gotoAndPlay=function(t,e,i,a,r,n,s,o,l){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===a&&(a=-1),void 0===r&&(r=0),void 0===n&&(n=null),void 0===s&&(s=3),void 0===o&&(o=!0),void 0===l&&(l=!0),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=s,this._animationConfig.playTimes=a,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==n?n:"";var h=this._animations[t];return h&&i>0&&(this._animationConfig.timeScale=h.duration/i),this.playConfig(this._animationConfig)},i.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),this.gotoAndStopByTime(t,e)},Object.defineProperty(i.prototype,"animationList",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationDataList",{get:function(){for(var t=[],e=0,i=this._animationNames.length;i>e;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.Animation=e,__reflect(e.prototype,"dragonBones.Animation")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.result=new t.Transform,i.current=new t.Transform,i.delta=new t.Transform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.BonePose]"},i.prototype._onClear=function(){this.result.identity(),this.current.identity(),this.delta.identity()},i}(t.BaseObject);t.BonePose=e,__reflect(e.prototype,"dragonBones.BonePose");var i=function(i){function a(){var t=null!==i&&i.apply(this,arguments)||this;return t._boneMask=[],t._boneTimelines=[],t._slotTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t.autoTween=!1,t}return __extends(a,i),a.toString=function(){return"[class dragonBones.AnimationState]"},a.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++){var i=e[t];i.returnToPool()}for(var a=0,r=this._slotTimelines;a<r.length;a++){var i=r[a];i.returnToPool()}for(var n in this._bonePoses)this._bonePoses[n].returnToPool(),delete this._bonePoses[n];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.resetToPose=!1,this.additiveBlending=!1,this.displayControl=!1,this.actionEnabled=!1,this.layer=0,this.playTimes=0,this.timeScale=0,this.weight=0,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this.animationData=null,this._timelineDirty=!0,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._boneMask.length=0,this._boneTimelines.length=0,this._slotTimelines.length=0,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null},a.prototype._isDisabled=function(t){if(this.displayControl){var e=t.displayController;if(null===e||e===this.name||e===this.group)return!1}return!0},a.prototype._advanceFadeTime=function(e){var i=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var a=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasEvent(a)){var r=t.BaseObject.borrowObject(t.EventObject);r.animationState=this,this._armature._bufferEvent(r,a)}}if(0>e&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0){i||(this._playheadState|=1,this._fadeState=0);var a=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasEvent(a)){var r=t.BaseObject.borrowObject(t.EventObject);r.animationState=this,this._armature._bufferEvent(r,a)}}},a.prototype._blendBoneTimline=function(t){var e=t.bone,i=t.bonePose.result,a=e.animationPose,r=this._weightResult>0?this._weightResult:-this._weightResult;e._blendDirty?(r*=e._blendLeftWeight,e._blendLayerWeight+=r,a.x+=i.x*r,a.y+=i.y*r,a.rotation+=i.rotation*r,a.skew+=i.skew*r,a.scaleX+=(i.scaleX-1)*r,a.scaleY+=(i.scaleY-1)*r):(e._blendDirty=!0,e._blendLayer=this.layer,e._blendLayerWeight=r,e._blendLeftWeight=1,a.x=i.x*r,a.y=i.y*r,a.rotation=i.rotation*r,a.skew=i.skew*r,a.scaleX=(i.scaleX-1)*r+1,a.scaleY=(i.scaleY-1)*r+1),(0!==this._fadeState||0!==this._subFadeState)&&(e._transformDirty=!0)},a.prototype.init=function(e,i,a){if(null===this._armature){if(this._armature=e,this.animationData=i,this.resetToPose=a.resetToPose,this.additiveBlending=a.additiveBlending,this.displayControl=a.displayControl,this.actionEnabled=a.actionEnabled,this.layer=a.layer,this.playTimes=a.playTimes,this.timeScale=a.timeScale,this.fadeTotalTime=a.fadeInTime,this.autoFadeOutTime=a.autoFadeOutTime,this.weight=a.weight,this.name=a.name.length>0?a.name:a.animation,this.group=a.group,a.pauseFadeIn?this._playheadState=2:this._playheadState=3,a.duration<0?(this._position=0,this._duration=this.animationData.duration,0!==a.position?this.timeScale>=0?this._time=a.position:this._time=a.position-this._duration:this._time=0):(this._position=a.position,this._duration=a.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),a.boneMask.length>0){this._boneMask.length=a.boneMask.length;for(var r=0,n=this._boneMask.length;n>r;++r)this._boneMask[r]=a.boneMask[r]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this.animationData.actionTimeline),null!==this.animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this.animationData.zOrderTimeline))}},a.prototype.updateTimelines=function(){for(var i={},a=0,r=this._boneTimelines;a<r.length;a++){var n=r[a],s=n.bone.name;s in i||(i[s]=[]),i[s].push(n)}for(var o=0,l=this._armature.getBones();o<l.length;o++){var h=l[o],s=h.name;if(this.containsBoneMask(s)){var _=this.animationData.getBoneTimelines(s);if(s in i)delete i[s];else{var u=s in this._bonePoses?this._bonePoses[s]:this._bonePoses[s]=t.BaseObject.borrowObject(e);if(null!==_)for(var p=0,c=_;p<c.length;p++){var d=c[p];switch(d.type){case 10:var m=s in this._bonePoses?this._bonePoses[s]:this._bonePoses[s]=t.BaseObject.borrowObject(e),n=t.BaseObject.borrowObject(t.BoneAllTimelineState);n.bone=h,n.bonePose=m,n.init(this._armature,this,d),this._boneTimelines.push(n);break;case 11:case 12:case 13:break;case 14:case 15:case 16:case 17:case 18:case 19:}}else if(this.resetToPose){var n=t.BaseObject.borrowObject(t.BoneAllTimelineState);n.bone=h,n.bonePose=u,n.init(this._armature,this,null),this._boneTimelines.push(n)}}}}for(var f in i)for(var g=0,y=i[f];g<y.length;g++){var n=y[g];this._boneTimelines.splice(this._boneTimelines.indexOf(n),1),n.returnToPool()}for(var v={},D=0,T=this._slotTimelines;D<T.length;D++){var n=T[D],s=n.slot.name;s in v||(v[s]=[]),v[s].push(n)}for(var b=0,E=this._armature.getSlots();b<E.length;b++){var A=E[b],O=A.parent.name;if(this.containsBoneMask(O)){var s=A.name,_=this.animationData.getSlotTimeline(s);if(s in v)delete v[s];else if(null!==_)for(var x=0,S=_;x<S.length;x++){var d=S[x];switch(d.type){case 20:var n=t.BaseObject.borrowObject(t.SlotDislayIndexTimelineState);n.slot=A,n.init(this._armature,this,d),this._slotTimelines.push(n);break;case 21:var n=t.BaseObject.borrowObject(t.SlotColorTimelineState);n.slot=A,n.init(this._armature,this,d),this._slotTimelines.push(n);break;case 22:var n=t.BaseObject.borrowObject(t.SlotFFDTimelineState);n.slot=A,n.init(this._armature,this,d),this._slotTimelines.push(n)}}else if(this.resetToPose){var n=t.BaseObject.borrowObject(t.SlotDislayIndexTimelineState);n.slot=A,n.init(this._armature,this,null),this._slotTimelines.push(n);var n=t.BaseObject.borrowObject(t.SlotColorTimelineState);n.slot=A,n.init(this._armature,this,null),this._slotTimelines.push(n);for(var B=0,P=A._rawDisplayDatas;B<P.length;B++){var M=P[B];if(null!==M&&2===M.type){var n=t.BaseObject.borrowObject(t.SlotFFDTimelineState);n.slot=A,n.init(this._armature,this,null),this._slotTimelines.push(n);break}}}}}for(var f in v)for(var R=0,C=v[f];R<C.length;R++){var n=C[R];this._slotTimelines.splice(this._slotTimelines.indexOf(n),1),n.returnToPool()}},a.prototype.advanceTime=function(t,e){if((0!==this._fadeState||0!==this._subFadeState)&&this._advanceFadeTime(t),3===this._playheadState&&(1!==this.timeScale&&(t*=this.timeScale),this._time+=t),this._timelineDirty&&(this._timelineDirty=!1,this.updateTimelines()),0!==this.weight){var i=0===this._fadeState&&e>0,a=!0,r=!0,n=this._time;if(this._weightResult=this.weight*this._fadeProgress,this._actionTimeline.update(n),i){var s=2*e;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*s)/s}if(null!==this._zOrderTimeline&&this._zOrderTimeline.update(n),i){var o=Math.floor(this._actionTimeline.currentTime*e);this._armature._cacheFrameIndex===o?(a=!1,r=!1):(this._armature._cacheFrameIndex=o,this.animationData.cachedFrames[o]?r=!1:this.animationData.cachedFrames[o]=!0)}if(a){if(r)for(var l=null,h=null,_=0,u=this._boneTimelines.length;u>_;++_){var p=this._boneTimelines[_];l!==p.bone&&(null!==l&&(this._blendBoneTimline(h),l._blendDirty&&(l._blendLeftWeight>0?l._blendLayer!==this.layer&&(l._blendLayerWeight>=l._blendLeftWeight?(l._blendLeftWeight=0,l=null):(l._blendLayer=this.layer,l._blendLeftWeight-=l._blendLayerWeight,l._blendLayerWeight=0)):l=null)),l=p.bone),null!==l&&(p.update(n),_===u-1?this._blendBoneTimline(p):h=p)}for(var _=0,u=this._slotTimelines.length;u>_;++_){var p=this._slotTimelines[_];this._isDisabled(p.slot)||p.update(n)}}0===this._fadeState&&(this._subFadeState>0&&(this._subFadeState=0),this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime))}},a.prototype.play=function(){this._playheadState=3},a.prototype.stop=function(){this._playheadState&=1},a.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),(0>t||t!==t)&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(0>=t||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,a=this._boneTimelines;i<a.length;i++){var r=a[i];r.fadeOut()}for(var n=0,s=this._slotTimelines;n<s.length;n++){var r=s[n];r.fadeOut()}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},a.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},a.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(null!==i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var a=0,r=this._armature.getBones();a<r.length;a++){var n=r[a];this._boneMask.indexOf(n.name)<0&&i.contains(n)&&this._boneMask.push(n.name)}this._timelineDirty=!0}},a.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var a=this._armature.getBone(t);if(null!==a){var r=this._armature.getBones();if(this._boneMask.length>0)for(var n=0,s=r;n<s.length;n++){var o=s[n],l=this._boneMask.indexOf(o.name);l>=0&&a.contains(o)&&this._boneMask.splice(l,1)}else for(var h=0,_=r;h<_.length;h++){var o=_[h];o!==a&&(a.contains(o)||this._boneMask.push(o.name))}}}this._timelineDirty=!0},a.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=!0},Object.defineProperty(a.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isPlaying",{get:function(){return 0!==(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){t!==t&&(t=0);var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((0>t||this._duration<t)&&(t=t%this._duration+e*this._duration,0>t&&(t+=this._duration)),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var i=0,a=this._boneTimelines;i<a.length;i++){var r=a[i];r.playState=-1}for(var n=0,s=this._slotTimelines;n<s.length;n++){var r=s[n];r.playState=-1}}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"clip",{get:function(){return this.animationData},enumerable:!0,configurable:!0}),a}(t.BaseObject);t.AnimationState=i,__reflect(i.prototype,"dragonBones.AnimationState")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._resourceConfigURL="resource/hello_dragonbones.res.json",e}return __extends(e,t),e.prototype._onStart=function(){dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("dragonBonesData")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("textureDataA"),RES.getRes("textureA"));var t=dragonBones.EgretFactory.factory.buildArmatureDisplay("DragonBoy");null!==t&&(t.animation.play("walk"),this.addChild(t),t.x=.5*this.stage.stageWidth,t.y=.5*this.stage.stageHeight+100)},e}(BaseTest);t.HelloDragonBones=e,__reflect(e.prototype,"demosEgret.HelloDragonBones")}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._left=!1,e._right=!1,e._tester=new BoundingBoxTester,e._mecha=null,e._groudDisplay=null,e._resourceGroup="groundTest",e._resourceConfigURL="resource/groundTest.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=this;dragonBones.DragonBones.debugDraw=!0,dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("ground")),dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("mecha_1008d")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("mecha_1008d_texture_config"),RES.getRes("mecha_1008d_texture")),this._groudDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("ground_1"),this.addChild(this._groudDisplay),this._groudDisplay.x=.5*this.stage.stageWidth,this._groudDisplay.y=.5*this.stage.stageHeight+100,this._mecha=new i(this._groudDisplay),this.addChild(this._mecha.display),this._mecha.display.x=.5*this.stage.stageWidth,this._mecha.display.y=.5*this.stage.stageHeight-100,enableDrag(this._groudDisplay),this._tester.armatureDisplay=this._groudDisplay,this._tester.x=200,this._tester.y=200,this.addChild(this._tester),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this);
var e=function(e){var i="keydown"==e.type;switch(e.keyCode){case 37:case 65:t._left=i,t._updateMove(-1);break;case 39:case 68:t._left=t._right=i,t._updateMove(1);break;case 38:case 87:i&&t._mecha.jump();break;case 83:case 40:t._mecha.squat(i)}};document.addEventListener("keydown",e),document.addEventListener("keyup",e);var a=this._mecha,r=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(t,e,i){r.call(this,t,e,i),a.aim(t,e)}},e.prototype._updateMove=function(t){this._left&&this._right?this._mecha.move(t):this._left?this._mecha.move(-1):this._right?this._mecha.move(1):this._mecha.move(0)},e.prototype._enterFrameHandler=function(t){this._mecha.update()},e}(BaseTest);t.GroundTest=e,__reflect(e.prototype,"demosEgret.GroundTest");var i=function(){function t(t){this._isSquating=!1,this._faceDir=1,this._aimDir=0,this._moveState=0,this._jumpState=0,this._aimRadian=0,this._speedX=0,this._speedY=0,this._hitHeight=100,this._bodyRadian=0,this._footRadian=0,this._armatureDisplay=null,this._footL=null,this._footR=null,this._groundDisplay=null,this._aimState=null,this._walkState=null,this._target=new egret.Point,this._helpPointA=new egret.Point,this._helpPointC=new egret.Point,this._helpPointE=new egret.Point,this._helpPointB=new egret.Point,this._helpPointD=new egret.Point,this._helpPointF=new egret.Point,this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("mecha_1008d"),this._footL=this._armatureDisplay.armature.getBone("foot_l"),this._footR=this._armatureDisplay.armature.getBone("foot_r"),this._groundDisplay=t,this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this.jump()}return Object.defineProperty(t.prototype,"display",{get:function(){return this._armatureDisplay},enumerable:!0,configurable:!0}),t.prototype.move=function(t){this._moveState!=t&&(this._moveState=t,this._updateAnimation())},t.prototype.jump=function(){0==this._jumpState&&(this._jumpState=1,this._armatureDisplay.animation.fadeIn("jump_1",.1,-1,0,t.NORMAL_ANIMATION_GROUP),this._walkState=null)},t.prototype.squat=function(t){this._isSquating!=t&&(this._isSquating=t,this._updateAnimation())},t.prototype.aim=function(t,e){0==this._aimDir&&(this._aimDir=10),this._target.x=t,this._target.y=e},t.prototype.update=function(){this._updatePosition(),this._updateAim()},t.prototype._animationEventHandler=function(e){switch(e.type){case dragonBones.EventObject.FADE_IN_COMPLETE:0!=this._jumpState&&"jump_1"==e.eventObject.animationState.name&&(4==this._jumpState?(this._jumpState=0,this._updateAnimation()):(this._jumpState=2,this._speedY=-t.JUMP_SPEED,0!=this._moveState&&(this._moveState*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir),this._armatureDisplay.animation.fadeIn("jump_2",.1,-1,0,t.NORMAL_ANIMATION_GROUP)))}},t.prototype._hitTestGround=function(){var e=2!=this._jumpState&&3!=this._jumpState,i=!1,a=0,r=0,n=0;if(e||(this._speedY>0&&(this._groundDisplay.globalToLocal(this._armatureDisplay.x,this._armatureDisplay.y,this._helpPointA),this._groundDisplay.armature.containsPoint(this._helpPointA.x,this._helpPointA.y)&&(this._groundDisplay.armature.containsPoint(this._helpPointA.x-this._speedX,this._helpPointA.y-this._speedY)||(i=!0))),this._armatureDisplay.y>=this._armatureDisplay.stage.stageHeight-50&&(i=!0,e=!0)),e||i){if(this._groundDisplay.globalToLocal(this._armatureDisplay.x,this._armatureDisplay.y,this._helpPointA),this._groundDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y-this._hitHeight,this._helpPointA.x,this._helpPointB.y+this._hitHeight,this._helpPointA,this._helpPointB,this._helpPointD)){var s=this._helpPointA.x,o=this._helpPointA.y,l=this._helpPointD.x;this._armatureDisplay.localToGlobal(this._footR.global.x,0,this._helpPointA),this._armatureDisplay.localToGlobal(this._footL.global.x,0,this._helpPointB),this._groundDisplay.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this._groundDisplay.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB);var h=this._helpPointA.x,_=this._helpPointA.y,u=this._helpPointB.x,p=this._helpPointB.y;if(this._groundDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y-this._hitHeight,this._helpPointA.x,this._helpPointA.y+this._hitHeight,this._helpPointA,this._helpPointC,this._helpPointE)&&(a|=1),this._groundDisplay.armature.intersectsSegment(this._helpPointB.x,this._helpPointB.y-this._hitHeight,this._helpPointB.x,this._helpPointB.y+this._hitHeight,this._helpPointB,this._helpPointC,this._helpPointF)&&(a|=2),a){2==a?(this._helpPointA.x=s+this._footR.global.x/this._footL.global.x*(this._helpPointB.x-s),this._helpPointA.y=o+(this._helpPointA.x-s)/(this._helpPointB.x-s)*(this._helpPointB.y-o),this._helpPointE.x=l):1==a&&(this._helpPointB.x=s+this._footR.global.x/this._footL.global.x*(this._helpPointA.x-s),this._helpPointB.y=o+(this._helpPointB.x-s)/(this._helpPointA.x-s)*(this._helpPointA.y-o),this._helpPointF.x=l),r=this._helpPointA.y-_,n=this._helpPointB.y-p;var c=-this._footR.global.x/(this._footL.global.x-this._footR.global.x),d=this._helpPointB.x-this._helpPointA.x,m=this._helpPointB.y-this._helpPointA.y,f=this._helpPointA.x+d*c,g=this._helpPointA.y+m*c;this._groundDisplay.localToGlobal(f,g,this._helpPointC),this._armatureDisplay.y=this._helpPointC.y;var y=-20*dragonBones.Transform.DEG_RAD,v=20*dragonBones.Transform.DEG_RAD,D=this._bodyRadian;this._footRadian=u>h?Math.atan2(m,d):Math.atan2(-m,-d),D=this._faceDir>0?this._footRadian<y?this._footRadian-y:this._footRadian>v?this._footRadian-v:0:this._footRadian<-v?this._footRadian+v:this._footRadian>-y?this._footRadian+y:0,this._bodyRadian+=.2*(D-this._bodyRadian)}}}else this._footRadian=0,this._bodyRadian*=.2;if(a){i&&(this._jumpState=4,this._armatureDisplay.animation.fadeIn("jump_1",.1,-1,0,t.NORMAL_ANIMATION_GROUP));var T=this._faceDir*(this._helpPointE.x-this._bodyRadian+.5*Math.PI),b=this._faceDir*(this._helpPointF.x-this._bodyRadian+.5*Math.PI);this._footR.offset.x=r,this._footL.offset.x=n,this._footR.offset.rotation=T,this._footL.offset.rotation=b}else i?(this._jumpState=4,this._armatureDisplay.animation.fadeIn("jump_1",.1,-1,0,t.NORMAL_ANIMATION_GROUP)):this._armatureDisplay.y<this._armatureDisplay.stage.stageHeight-50&&(this._jumpState=2),this._footR.offset.x*=.8,this._footL.offset.x*=.8,this._footR.offset.rotation*=.8,this._footL.offset.rotation*=.8;this._armatureDisplay.rotation=this._bodyRadian*dragonBones.Transform.RAD_DEG},t.prototype._updateAnimation=function(){return 0==this._jumpState?this._isSquating?(this._speedX=0,this._armatureDisplay.animation.fadeIn("jump_1",.3,-1,0,t.NORMAL_ANIMATION_GROUP),void(this._walkState=null)):void(0==this._moveState?(this._speedX=0,this._armatureDisplay.animation.fadeIn("idle",.3,-1,0,t.NORMAL_ANIMATION_GROUP),this._walkState=null):(this._walkState||(this._walkState=this._armatureDisplay.animation.fadeIn("walk",.3,-1,0,t.NORMAL_ANIMATION_GROUP,2),this._walkState.play()),this._moveState*this._faceDir>0?this._walkState.timeScale=t.MAX_MOVE_SPEED_FRONT/t.NORMALIZE_MOVE_SPEED:this._walkState.timeScale=-t.MAX_MOVE_SPEED_BACK/t.NORMALIZE_MOVE_SPEED,this._moveState*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir)):void 0},t.prototype._updatePosition=function(){this._armatureDisplay.x,this._armatureDisplay.y;(this._moveState||0!=this._speedX)&&(this._armatureDisplay.x+=this._speedX*Math.cos(this._footRadian),this._armatureDisplay.x<0?this._armatureDisplay.x=0:this._armatureDisplay.x>this._armatureDisplay.stage.stageWidth&&(this._armatureDisplay.x=this._armatureDisplay.stage.stageWidth)),(2==this._jumpState||3==this._jumpState)&&(this._speedY<5&&this._speedY+t.G>=5&&(this._jumpState=3,this._armatureDisplay.animation.fadeIn("jump_3",.3,-1,0,t.NORMAL_ANIMATION_GROUP)),this._speedY+=t.G,this._armatureDisplay.y+=this._speedY),this._hitTestGround()},t.prototype._updateAim=function(){if(0!=this._aimDir){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.scaleX*this._faceDir<0&&(this._armatureDisplay.scaleX*=-1,this._moveState&&this._updateAnimation());var e=this._armatureDisplay.armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?(this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian-=this._bodyRadian):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian+=this._bodyRadian,this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var i=0;i=this._aimRadian>0?-1:1,this._aimDir!=i&&(this._aimDir=i,this._aimDir>=0?this._aimState=this._armatureDisplay.animation.fadeIn("aimUp",.001,1,0,t.AIM_ANIMATION_GROUP,2):this._aimState=this._armatureDisplay.animation.fadeIn("aimDown",.001,1,0,t.AIM_ANIMATION_GROUP,2)),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armatureDisplay.armature.invalidUpdate()}},t}();i.G=1,i.JUMP_SPEED=30,i.NORMALIZE_MOVE_SPEED=2,i.MAX_MOVE_SPEED_FRONT=1.4*i.NORMALIZE_MOVE_SPEED,i.MAX_MOVE_SPEED_BACK=1*i.NORMALIZE_MOVE_SPEED,i.NORMAL_ANIMATION_GROUP="normal",i.AIM_ANIMATION_GROUP="aim",__reflect(i.prototype,"Mecha")}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._isTouched=!1,e._isTouchMoved=!1,e._isHorizontalMoved=!1,e._prevArmatureScale=1,e._prevAnimationScale=1,e._startPoint=new egret.Point,e._text=new egret.TextField,e._dragonBonesIndex=0,e._armatureIndex=0,e._animationIndex=0,e._armatureDisplay=null,e._allDragonBonesData=[],e._boundingBoxTester=new BoundingBoxTester,e._resourceGroup="baseTest",e._resourceConfigURL="resource/base_test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=RES.getGroupByName("search");if(t&&t.length>0)for(var e=0,i=t.length;i>e;++e){var a=t[e].name;dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(a+"_binary"));var r=RES.getRes(a+"_textureData");r&&dragonBones.EgretFactory.factory.parseTextureAtlasData(r,RES.getRes(a+"_texture"));var n=a+"_mov";RES.hasRes(n)}dragonBones.DragonBones.debugDraw=!0;var s=dragonBones.EgretFactory.factory.getAllDragonBonesData();for(var e in s){var o=s[e];this._allDragonBonesData.push(o)}if(!(this._allDragonBonesData.length>0))throw new Error;this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._touchHandler,this),dragonBones.EgretFactory.factory.soundEventManager.addEventListener(dragonBones.EventObject.SOUND_EVENT,this._armatureEventHandler,this),this._boundingBoxTester.x=200,this._boundingBoxTester.y=200,this.addChild(this._boundingBoxTester),this._changeArmature(1),this._changeAnimation(),this._text.size=20,this._text.textAlign=egret.HorizontalAlign.CENTER,this._text.width=this.stage.stageWidth,this._text.x=0,this._text.y=this.stage.stageHeight-80,this.addChild(this._text)},e.prototype._touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:t.target==this.stage&&(this._isTouched=!0,this._prevArmatureScale=this._armatureDisplay.scaleX,this._prevAnimationScale=this._armatureDisplay.animation.timeScale,this._startPoint.setTo(t.stageX,t.stageY));break;case egret.TouchEvent.TOUCH_END:if(this._isTouched)if(this._isTouched=!1,this._isTouchMoved)this._isTouchMoved=!1;else{if(this._allDragonBonesData.length>1||this._allDragonBonesData[0].armatureNames.length>1){var e=Math.abs(this.stage.stageWidth/2-t.stageX)>this.stage.stageWidth/6,i=t.stageX>this.stage.stageWidth/2;e&&(i?this._changeArmature(1):this._changeArmature(-1))}this._changeAnimation()}break;case egret.TouchEvent.TOUCH_MOVE:if(this._isTouched){var a=this._startPoint.x-t.stageX,r=this._startPoint.y-t.stageY;if(!this._isTouchMoved){var n=Math.abs(a),s=Math.abs(r);(n>5||s>5)&&(this._isTouchMoved=!0,this._isHorizontalMoved=n>s)}if(this._isTouchMoved)if(this._isHorizontalMoved){var o=Math.max(-a/200+this._prevAnimationScale,.01);this._armatureDisplay.animation.timeScale=o}else{var l=Math.max(r/200+this._prevArmatureScale,.01);this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=l}}}},e.prototype._changeArmature=function(t){var e=!1,i=this._allDragonBonesData[this._dragonBonesIndex],a=i.armatureNames;this._animationIndex=0,this._armatureIndex+=t>0?1:-1,this._armatureIndex<0?(e=!0,this._dragonBonesIndex--):this._armatureIndex>=a.length&&(this._armatureIndex=0,e=!0,this._dragonBonesIndex++),e&&(this._dragonBonesIndex<0?this._dragonBonesIndex=this._allDragonBonesData.length-1:this._dragonBonesIndex>=this._allDragonBonesData.length&&(this._dragonBonesIndex=0),i=this._allDragonBonesData[this._dragonBonesIndex],a=i.armatureNames,this._armatureIndex=t>0?0:a.length-1);var r=a[this._armatureIndex];this._armatureDisplay&&(disableDrag(this._armatureDisplay),this.removeChild(this._armatureDisplay),this._armatureDisplay.removeEventListener(dragonBones.EventObject.START,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._armatureEventHandler,this),this._armatureDisplay.dispose()),this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay(r,i.name),this._armatureDisplay.armature.cacheFrameRate=24,this._armatureDisplay.addEventListener(dragonBones.EventObject.START,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._armatureEventHandler,this),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight+100,this.addChild(this._armatureDisplay),enableDrag(this._armatureDisplay),this._boundingBoxTester.armatureDisplay=this._armatureDisplay,this.addChild(this._boundingBoxTester)},e.prototype._changeAnimation=function(){var t=this._armatureDisplay.animation.animationNames;if(0!=t.length){this._animationIndex++,this._animationIndex>=t.length&&(this._animationIndex=0);var e=t[this._animationIndex];this._armatureDisplay.animation.play(e),this._text.text="DragonBones: "+this._armatureDisplay.armature.armatureData.parent.name+"    Armature: "+this._armatureDisplay.armature.name+"    Animation: "+this._armatureDisplay.armature.animation.lastAnimationName+"\nTouch screen left/right to change prev/next armature.\nTouch center to play next animation."}},e.prototype._armatureEventHandler=function(t){console.log("Armature.",t.type,t.eventObject.animationState.name,t.eventObject.name||"")},e}(BaseTest);t.DragonBonesTest=e,__reflect(e.prototype,"demosEgret.DragonBonesTest")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(){function t(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),this.x=t,this.y=e,this.width=i,this.height=a}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e,__reflect(e.prototype,"dragonBones.Rectangle")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e;!function(t){var e=function(t){function e(){var i=t.call(this)||this;return i._left=!1,i._right=!1,i._bullets=[],i.a=0,e.instance=i,i._resourceConfigURL="resource/core_element.res.json",i}return __extends(e,t),e.prototype._onStart=function(){e.STAGE_WIDTH=this.stage.stageWidth,e.STAGE_HEIGHT=this.stage.stageHeight,e.GROUND=e.STAGE_HEIGHT-100,this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),document.addEventListener("keydown",this._keyHandler),document.addEventListener("keyup",this._keyHandler);var t=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(i,a,r){t.call(this,i,a,r),e.instance._player.aim(i,a)};var a=new egret.TextField;a.size=20,a.textAlign=egret.HorizontalAlign.CENTER,a.text="Press W/A/S/D to move. Press Q/E to switch weapons. Press SPACE to switch skin.\nMouse Move to aim. Click to fire.",a.width=e.STAGE_WIDTH,a.x=0,a.y=e.STAGE_HEIGHT-60,this.addChild(a),dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("mecha_1502b")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("mecha_1502b_texture_config"),RES.getRes("mecha_1502b_texture")),dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("skin_1502b")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("skin_1502b_texture_config"),RES.getRes("skin_1502b_texture")).autoSearch=!0,dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("skin_1000")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("skin_1000_texture_config"),RES.getRes("skin_1000_texture")),dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("weapon_1000")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("weapon_1000_texture_config"),RES.getRes("weapon_1000_texture")),dragonBones.EgretFactory.factory.autoSearch=!0,this._player=new i},e.prototype.addBullet=function(t){this._bullets.push(t)},e.prototype._touchHandler=function(t){this._player.aim(t.stageX,t.stageY),t.type===egret.TouchEvent.TOUCH_BEGIN?this._player.attack(!0):this._player.attack(!1)},e.prototype._keyHandler=function(t){var i="keydown"===t.type;switch(t.keyCode){case 37:case 65:e.instance._left=i,e.instance._updateMove(-1);break;case 39:case 68:e.instance._right=i,e.instance._updateMove(1);break;case 38:case 87:i&&e.instance._player.jump();break;case 83:case 40:e.instance._player.squat(i);break;case 81:i&&e.instance._player.switchWeaponR();break;case 69:i&&e.instance._player.switchWeaponL();break;case 32:i&&e.instance._player.switchSkin()}},e.prototype._enterFrameHandler=function(t){this._player.update();for(var e=this._bullets.length;e--;){var i=this._bullets[e];i.update()&&this._bullets.splice(e,1)}dragonBones.WorldClock.clock.advanceTime(-1)},e.prototype._updateMove=function(t){this._left&&this._right?this._player.move(t):this._left?this._player.move(-1):this._right?this._player.move(1):this._player.move(0)},e}(BaseTest);e.G=.6,t.Game=e,__reflect(e.prototype,"demosEgret.coreElement.Game");var i=function(){function t(){this._isJumpingA=!1,this._isJumpingB=!1,this._isSquating=!1,this._isAttackingA=!1,this._isAttackingB=!1,this._skinIndex=0,this._weaponRIndex=0,this._weaponLIndex=0,this._faceDir=1,this._aimDir=0,this._moveDir=0,this._aimRadian=0,this._speedX=0,this._speedY=0,this._aimState=null,this._walkState=null,this._attackState=null,this._target=new egret.Point,this._helpPoint=new egret.Point,this._armature=dragonBones.EgretFactory.factory.buildArmature("mecha_1502b"),this._armature.cacheFrameRate=24,this._armatureDisplay=this._armature.display,this._armatureDisplay.x=.5*e.STAGE_WIDTH,this._armatureDisplay.y=e.GROUND,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=1,this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._weaponL=this._armature.getSlot("weapon_l").childArmature,this._weaponR=this._armature.getSlot("weapon_r").childArmature,this._weaponL.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponR.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),e.instance.addChild(this._armatureDisplay),dragonBones.WorldClock.clock.add(this._armature),this._updateAnimation()}return t.prototype.move=function(t){this._moveDir!==t&&(this._moveDir=t,this._updateAnimation())},t.prototype.jump=function(){this._isJumpingA||(this._isJumpingA=!0,this._armature.animation.fadeIn("jump_1",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1,this._walkState=null)},t.prototype.squat=function(t){this._isSquating!==t&&(this._isSquating=t,this._updateAnimation())},t.prototype.attack=function(t){this._isAttackingA!==t&&(this._isAttackingA=t)},t.prototype.switchWeaponL=function(){this._weaponLIndex++,this._weaponLIndex%=t.WEAPON_L_LIST.length;var e=t.WEAPON_L_LIST[this._weaponLIndex];this._weaponL.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponL=dragonBones.EgretFactory.factory.buildArmature(e),this._armature.getSlot("weapon_l").childArmature=this._weaponL,this._weaponL.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this)},t.prototype.switchWeaponR=function(){this._weaponRIndex++,this._weaponRIndex%=t.WEAPON_R_LIST.length;var e=t.WEAPON_R_LIST[this._weaponRIndex];this._weaponR.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponR=dragonBones.EgretFactory.factory.buildArmature(e),this._armature.getSlot("weapon_r").childArmature=this._weaponR,this._weaponR.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this)},t.prototype.switchSkin=function(){this._skinIndex++,this._skinIndex%=4;var t=["mecha_1502b","skin_a","skin_b","skin_c"];t[this._skinIndex];dragonBones.EgretFactory.factory.changeSkin(this._armature,t[this._skinIndex],null,null,["weapon_r","weapon_l"])},t.prototype.aim=function(t,e){this._target.x=t,this._target.y=e},t.prototype.update=function(){this._updatePosition(),this._updateAim(),this._updateAttack()},t.prototype._animationEventHandler=function(e){switch(e.type){case dragonBones.EventObject.FADE_IN_COMPLETE:"jump_1"===e.eventObject.animationState.name&&(this._isJumpingB=!0,this._speedY=-t.JUMP_SPEED,0!==this._moveDir&&(this._moveDir*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir),this._armature.animation.fadeIn("jump_2",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1);break;case dragonBones.EventObject.FADE_OUT_COMPLETE:"attack_01"===e.eventObject.animationState.name&&(this._isAttackingB=!1,this._attackState=null);break;case dragonBones.EventObject.COMPLETE:"jump_4"===e.eventObject.animationState.name&&(this._isJumpingA=!1,this._isJumpingB=!1,this._updateAnimation())}},t.prototype._frameEventHandler=function(t){"fire"===t.eventObject.name&&(t.eventObject.armature.display.localToGlobal(t.eventObject.bone.global.x,t.eventObject.bone.global.y,this._helpPoint),this._fire(this._helpPoint))},t.prototype._fire=function(t){t.x+=2*Math.random()-1,t.y+=2*Math.random()-1;var i=this._faceDir<0?Math.PI-this._aimRadian:this._aimRadian,r=new a("bullet_01","fire_effect_01",i+.02*Math.random()-.01,40,t);e.instance.addBullet(r)},t.prototype._updateAnimation=function(){return this._isJumpingA?void 0:this._isSquating?(this._speedX=0,this._armature.animation.fadeIn("squat",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1,void(this._walkState=null)):void(0===this._moveDir?(this._speedX=0,this._armature.animation.fadeIn("idle",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1,this._walkState=null):(null===this._walkState&&(this._walkState=this._armature.animation.fadeIn("walk",-1,-1,0,t.NORMAL_ANIMATION_GROUP),this._walkState.resetToPose=!1),this._moveDir*this._faceDir>0?this._walkState.timeScale=t.MAX_MOVE_SPEED_FRONT/t.NORMALIZE_MOVE_SPEED:this._walkState.timeScale=-t.MAX_MOVE_SPEED_BACK/t.NORMALIZE_MOVE_SPEED,this._moveDir*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir))},t.prototype._updatePosition=function(){0!==this._speedX&&(this._armatureDisplay.x+=this._speedX,this._armatureDisplay.x<0?this._armatureDisplay.x=0:this._armatureDisplay.x>e.STAGE_WIDTH&&(this._armatureDisplay.x=e.STAGE_WIDTH)),0!==this._speedY&&(this._speedY<5&&this._speedY+e.G>=5&&(this._armature.animation.fadeIn("jump_3",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1),this._speedY+=e.G,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.y>e.GROUND&&(this._armatureDisplay.y=e.GROUND,this._speedY=0,this._armature.animation.fadeIn("jump_4",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1))},t.prototype._updateAim=function(){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.scaleX*this._faceDir<0&&(this._armatureDisplay.scaleX*=-1,0!==this._moveDir&&this._updateAnimation());var e=this._armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var i=0;i=this._aimRadian>0?-1:1,(null===this._aimState||this._aimDir!==i)&&(this._aimDir=i,this._aimDir>=0?(this._aimState=this._armature.animation.fadeIn("aim_up",-1,-1,0,t.AIM_ANIMATION_GROUP),this._aimState.resetToPose=!1):(this._aimState=this._armature.animation.fadeIn("aim_down",-1,-1,0,t.AIM_ANIMATION_GROUP),this._aimState.resetToPose=!1)),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armature.invalidUpdate()},t.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,t.ATTACK_ANIMATION_GROUP),this._attackState.resetToPose=!1,this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime)},t}();i.NORMAL_ANIMATION_GROUP="normal",i.AIM_ANIMATION_GROUP="aim",i.ATTACK_ANIMATION_GROUP="attack",i.JUMP_SPEED=20,i.NORMALIZE_MOVE_SPEED=3.6,i.MAX_MOVE_SPEED_FRONT=1.4*i.NORMALIZE_MOVE_SPEED,i.MAX_MOVE_SPEED_BACK=1*i.NORMALIZE_MOVE_SPEED,i.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],i.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],i.SKIN={chest:["mecha_1502b_folder/chest","mecha_1004_folder/chest_1","mecha_1004b_folder/chest_1","mecha_1004d_folder/chest_1"],shouder_l:["mecha_1502b_folder/shouder_l_0","mecha_1002_folder/upperarm_l_2","mecha_1004b_folder/shouder_l_2","mecha_1004d_folder/shouder_l_2"],shouder_r:["mecha_1502b_folder/shouder_r_1","mecha_1002_folder/upperarm_r_2","mecha_1004b_folder/shouder_r_2","mecha_1004d_folder/shouder_r_2"],thigh_l:["mecha_1502b_folder/thigh_l","mecha_1003d_folder/thigh_l_0","mecha_1008d_folder/thigh_l_0","mecha_1007d_folder/thigh_l_0"],thigh_r:["mecha_1502b_folder/thigh_r","mecha_1003d_folder/thigh_r_0","mecha_1008d_folder/thigh_r_0","mecha_1007d_folder/thigh_r_0"],calf_l:["mecha_1502b_folder/calf_l","mecha_1003_folder/calf_l_0","mecha_1003_folder/calf_l_0","mecha_1003d_folder/calf_l_0"],calf_r:["mecha_1502b_folder/calf_r","mecha_1003_folder/calf_r_0","mecha_1003_folder/calf_r_0","mecha_1003d_folder/calf_r_0"],foot_l:["mecha_1502b_folder/foot_l_0","mecha_1004d_folder/foot_l_0","mecha_1003_folder/foot_l_0","mecha_1007d_folder/foot_l_1"],foot_r:["mecha_1502b_folder/foot_r","mecha_1004d_folder/foot_r_1","mecha_1003_folder/foot_r_0","mecha_1007d_folder/foot_r_0"]},__reflect(i.prototype,"Mecha");var a=function(){function t(t,i,a,r,n){if(this._speedX=0,this._speedY=0,this._effect=null,this._speedX=Math.cos(a)*r,this._speedY=Math.sin(a)*r,this._armature=dragonBones.EgretFactory.factory.buildArmature(t),this._armatureDisplay=this._armature.display,this._armatureDisplay.x=n.x,this._armatureDisplay.y=n.y,this._armatureDisplay.rotation=180*a/Math.PI,null!==i){this._effect=dragonBones.EgretFactory.factory.buildArmature(i);var s=this._effect.display;s.rotation=180*a/Math.PI,s.x=n.x,s.y=n.y,s.scaleX=1+1*Math.random(),s.scaleY=1+.5*Math.random(),Math.random()<.5&&(s.scaleY*=-1),dragonBones.WorldClock.clock.add(this._effect),e.instance.addChild(s),this._effect.animation.play("idle")}dragonBones.WorldClock.clock.add(this._armature),e.instance.addChild(this._armatureDisplay),this._armature.animation.play("idle")}return t.prototype.update=function(){return this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.x<-100||this._armatureDisplay.x>=e.STAGE_WIDTH+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=e.STAGE_HEIGHT+100?(dragonBones.WorldClock.clock.remove(this._armature),e.instance.removeChild(this._armatureDisplay),this._armature.dispose(),null!==this._effect&&(dragonBones.WorldClock.clock.remove(this._effect),e.instance.removeChild(this._effect.display),this._effect.dispose()),!0):!1},t}();__reflect(a.prototype,"Bullet")}(e=t.coreElement||(t.coreElement={}))}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.weight=1,this.name="",this.animation="",this.group="",this.boneMask.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;i>e;++e)this.boneMask[e]=t.boneMask[e]},e.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||this.boneMask.indexOf(t)>=0},e.prototype.addBoneMask=function(t,e,i){void 0===i&&(i=!0);var a=t.getBone(e);if(null!==a&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),i))for(var r=0,n=t.getBones();r<n.length;r++){var s=n[r];this.boneMask.indexOf(s.name)<0&&a.contains(s)&&this.boneMask.push(s.name)}},e.prototype.removeBoneMask=function(t,e,i){void 0===i&&(i=!0);var a=this.boneMask.indexOf(e);if(a>=0&&this.boneMask.splice(a,1),i){var r=t.getBone(e);if(null!==r)if(this.boneMask.length>0)for(var n=0,s=t.getBones();n<s.length;n++){var o=s[n],l=this.boneMask.indexOf(o.name);l>=0&&r.contains(o)&&this.boneMask.splice(l,1)}else for(var h=0,_=t.getBones();h<_.length;h++){var o=_[h];o!==r&&(r.contains(o)||this.boneMask.push(o.name))}}},e}(t.BaseObject);t.AnimationConfig=e,__reflect(e.prototype,"dragonBones.AnimationConfig")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.slotTimelines={},e.meshTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e
}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e in this.boneTimelines[t])this.boneTimelines[t][e].returnToPool();delete this.boneTimelines[t]}for(var t in this.slotTimelines){for(var e in this.slotTimelines[t])this.slotTimelines[t][e].returnToPool();delete this.slotTimelines[t]}for(var t in this.meshTimelines){for(var e in this.meshTimelines[t])this.meshTimelines[t][e].returnToPool();delete this.meshTimelines[t]}for(var t in this.animationTimelines){for(var e in this.animationTimelines[t])this.animationTimelines[t][e].returnToPool();delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.parent=null,this.actionTimeline=null,this.zOrderTimeline=null},e.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var i=0,a=this.cacheFrames.length;a>i;++i)this.cachedFrames[i]=!1;for(var r=0,n=this.parent.sortedBones;r<n.length;r++){for(var s=n[r],o=new Array(e),i=0,a=o.length;a>i;++i)o[i]=-1;this.boneCachedFrameIndices[s.name]=o}for(var l=0,h=this.parent.sortedSlots;l<h.length;l++){for(var _=h[l],o=new Array(e),i=0,a=o.length;a>i;++i)o[i]=-1;this.slotCachedFrameIndices[_.name]=o}}},e.prototype.addBoneTimeline=function(t,e){var i=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.addSlotTimeline=function(t,e){var i=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];i.indexOf(e)<0&&i.push(e)},e.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},e.prototype.getSlotTimeline=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},e.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},e.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},e}(t.BaseObject);t.AnimationData=e,__reflect(e.prototype,"dragonBones.AnimationData");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=0},e}(t.BaseObject);t.TimelineData=i,__reflect(i.prototype,"dragonBones.TimelineData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.aabb=new t.Rectangle,i.animationNames=[],i.sortedBones=[],i.sortedSlots=[],i.defaultActions=[],i.actions=[],i.bones={},i.slots={},i.skins={},i.animations={},i.userData=null,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.ArmatureData]"},i._onSortSlots=function(t,e){return t.zOrder>e.zOrder?1:-1},i.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++){var i=e[t];i.returnToPool()}for(var a=0,r=this.actions;a<r.length;a++){var i=r[a];i.returnToPool()}for(var n in this.bones)this.bones[n].returnToPool(),delete this.bones[n];for(var n in this.slots)this.slots[n].returnToPool(),delete this.slots[n];for(var n in this.skins)this.skins[n].returnToPool(),delete this.skins[n];for(var n in this.animations)this.animations[n].returnToPool(),delete this.animations[n];null!==this.userData&&this.userData.returnToPool(),this.isRightTransform=!1,this.frameRate=0,this.type=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.parent=null,this.defaultSkin=null,this.defaultAnimation=null,this.userData=null},i.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(0>=t)){var e=0,i=0,a=this.sortedBones.concat();for(this.sortedBones.length=0;t>i;){var r=a[e++];if(e>=t&&(e=0),!(this.sortedBones.indexOf(r)>=0)){if(r.constraints.length>0)for(var n=0,s=r.constraints;n<s.length;n++){var o=s[n];!(this.sortedBones.indexOf(o.target)<0)}null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),i++)}}}},i.prototype.sortSlots=function(){this.sortedSlots.sort(i._onSortSlots)},i.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=t;for(var e in this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)}},i.prototype.setCacheFrame=function(t,e,i){if(void 0===i&&(i=-1),null===this.parent)return-1;var a=this.parent.cachedFrames;return 0>i&&(i=a.length),a.length+=10,a[i]=t.a,a[i+1]=t.b,a[i+2]=t.c,a[i+3]=t.d,a[i+4]=t.tx,a[i+5]=t.ty,a[i+6]=e.rotation,a[i+7]=e.skew,a[i+8]=e.scaleX,a[i+9]=e.scaleY,i},i.prototype.getCacheFrame=function(t,e,i){var a=this.parent.cachedFrames;t.a=a[i],t.b=a[i+1],t.c=a[i+2],t.d=a[i+3],t.tx=a[i+4],t.ty=a[i+5],e.rotation=a[i+6],e.skew=a[i+7],e.scaleX=a[i+8],e.scaleY=a[i+9],e.x=t.tx,e.y=t.ty},i.prototype.addBone=function(e){e.name in this.bones&&(t.DragonBones.warn("Replace bone: "+e.name),this.bones[e.name].returnToPool()),this.bones[e.name]=e,this.sortedBones.push(e)},i.prototype.addSlot=function(e){e.name in this.slots&&(t.DragonBones.warn("Replace slot: "+e.name),this.slots[e.name].returnToPool()),this.slots[e.name]=e,this.sortedSlots.push(e)},i.prototype.addSkin=function(e){e.name in this.skins&&(t.DragonBones.warn("Replace skin: "+e.name),this.skins[e.name].returnToPool()),this.skins[e.name]=e,null===this.defaultSkin&&(this.defaultSkin=e)},i.prototype.addAnimation=function(e){e.name in this.animations&&(t.DragonBones.warn("Replace animation: "+e.name),this.animations[e.name].returnToPool()),e.parent=this,this.animations[e.name]=e,this.animationNames.push(e.name),null===this.defaultAnimation&&(this.defaultAnimation=e)},i.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},i.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},i.prototype.getSkin=function(t){return t.length>0&&t in this.skins?this.skins[t]:null},i.prototype.getAnimation=function(t){return t.length>0&&t in this.animations?this.animations[t]:this.defaultAnimation},i}(t.BaseObject);t.ArmatureData=e,__reflect(e.prototype,"dragonBones.ArmatureData");var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.constraints=[],i.userData=null,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneData]"},i.prototype._onClear=function(){for(var t=0,e=this.constraints;t<e.length;t++){var i=e[t];i.returnToPool()}null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.length=0,this.name="",this.transform.identity(),this.constraints.length=0,this.parent=null,this.userData=null},i}(t.BaseObject);t.BoneData=i,__reflect(i.prototype,"dragonBones.BoneData");var a=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.userData=null,t}return __extends(i,e),i.createColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotData]"},i.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=-1,this.zOrder=0,this.name="",this.parent=null,this.color=null,this.userData=null},i}(t.BaseObject);a.DEFAULT_COLOR=new t.ColorTransform,t.SlotData=a,__reflect(a.prototype,"dragonBones.SlotData");var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return __extends(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){for(var t in this.displays){for(var e=this.displays[t],i=0,a=e;i<a.length;i++){var r=a[i];null!==r&&r.returnToPool()}delete this.displays[t]}this.name=""},e.prototype.addDisplay=function(t,e){var i=t in this.displays?this.displays[t]:this.displays[t]=[];i.push(e)},e.prototype.getDisplay=function(t,e){var i=this.getDisplays(t);if(null!==i)for(var a=0,r=i;a<r.length;a++){var n=r[a];if(null!==n&&n.name===e)return n}return null},e.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},e}(t.BaseObject);t.SkinData=r,__reflect(r.prototype,"dragonBones.SkinData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject);t.BoundingBoxData=e,__reflect(e.prototype,"dragonBones.BoundingBoxData");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},e._computeOutCode=function(t,e,i,a,r,n){var s=0;return i>t?s|=1:t>r&&(s|=2),a>e?s|=4:e>n&&(s|=8),s},e.intersectsSegment=function(t,i,a,r,n,s,o,l,h,_,u){void 0===h&&(h=null),void 0===_&&(_=null),void 0===u&&(u=null);var p=t>n&&o>t&&i>s&&l>i,c=a>n&&o>a&&r>s&&l>r;if(p&&c)return-1;for(var d=0,m=e._computeOutCode(t,i,n,s,o,l),f=e._computeOutCode(a,r,n,s,o,l);;){if(0===(m|f)){d=2;break}if(0!==(m&f))break;var g=0,y=0,v=0,D=0!==m?m:f;0!==(4&D)?(g=t+(a-t)*(s-i)/(r-i),y=s,null!==u&&(v=.5*-Math.PI)):0!==(8&D)?(g=t+(a-t)*(l-i)/(r-i),y=l,null!==u&&(v=.5*Math.PI)):0!==(2&D)?(y=i+(r-i)*(o-t)/(a-t),g=o,null!==u&&(v=0)):0!==(1&D)&&(y=i+(r-i)*(n-t)/(a-t),g=n,null!==u&&(v=Math.PI)),D===m?(t=g,i=y,m=e._computeOutCode(t,i,n,s,o,l),null!==u&&(u.x=v)):(a=g,r=y,f=e._computeOutCode(a,r,n,s,o,l),null!==u&&(u.y=v))}return d&&(p?(d=2,null!==h&&(h.x=a,h.y=r),null!==_&&(_.x=a,_.y=a),null!==u&&(u.x=u.y+Math.PI)):c?(d=1,null!==h&&(h.x=t,h.y=i),null!==_&&(_.x=t,_.y=i),null!==u&&(u.y=u.x+Math.PI)):(d=3,null!==h&&(h.x=t,h.y=i),null!==_&&(_.x=a,_.y=r))),d},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&i>=t){var a=.5*this.height;if(e>=-a&&a>=e)return!0}return!1},e.prototype.intersectsSegment=function(t,i,a,r,n,s,o){void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o=null);var l=.5*this.width,h=.5*this.height,_=e.intersectsSegment(t,i,a,r,-l,-h,l,h,n,s,o);return _},e}(e);t.RectangleBoundingBoxData=i,__reflect(i.prototype,"dragonBones.RectangleBoundingBoxData");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.EllipseData]"},e.intersectsSegment=function(t,e,i,a,r,n,s,o,l,h,_){void 0===l&&(l=null),void 0===h&&(h=null),void 0===_&&(_=null);var u=s/o,p=u*u;e*=u,a*=u;var c=i-t,d=a-e,m=Math.sqrt(c*c+d*d),f=c/m,g=d/m,y=(r-t)*f+(n-e)*g,v=y*y,D=t*t+e*e,T=s*s,b=T-D+v,E=0;if(b>=0){var A=Math.sqrt(b),O=y-A,x=y+A,S=0>O?-1:m>=O?0:1,B=0>x?-1:m>=x?0:1,P=S*B;if(0>P)return-1;0===P&&(-1===S?(E=2,i=t+x*f,a=(e+x*g)/u,null!==l&&(l.x=i,l.y=a),null!==h&&(h.x=i,h.y=a),null!==_&&(_.x=Math.atan2(a/T*p,i/T),_.y=_.x+Math.PI)):1===B?(E=1,t+=O*f,e=(e+O*g)/u,null!==l&&(l.x=t,l.y=e),null!==h&&(h.x=t,h.y=e),null!==_&&(_.x=Math.atan2(e/T*p,t/T),_.y=_.x+Math.PI)):(E=3,null!==l&&(l.x=t+O*f,l.y=(e+O*g)/u,null!==_&&(_.x=Math.atan2(l.y/T*p,l.x/T))),null!==h&&(h.x=t+x*f,h.y=(e+x*g)/u,null!==_&&(_.y=Math.atan2(h.y/T*p,h.x/T)))))}return E},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},e.prototype.containsPoint=function(t,e){var i=.5*this.width;if(t>=-i&&i>=t){var a=.5*this.height;if(e>=-a&&a>=e)return e*=i/a,Math.sqrt(t*t+e*e)<=i}return!1},e.prototype.intersectsSegment=function(t,i,a,r,n,s,o){void 0===n&&(n=null),void 0===s&&(s=null),void 0===o&&(o=null);var l=e.intersectsSegment(t,i,a,r,0,0,.5*this.width,.5*this.height,n,s,o);return l},e}(e);t.EllipseBoundingBoxData=a,__reflect(a.prototype,"dragonBones.EllipseBoundingBoxData");var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.weight=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},e.intersectsSegment=function(t,e,i,a,r,n,s,o,l,h){void 0===o&&(o=null),void 0===l&&(l=null),void 0===h&&(h=null),t===i&&(t=i+1e-4),e===a&&(e=a+1e-4);for(var _=t-i,u=e-a,p=t*a-e*i,c=0,d=r[n+s-2],m=r[n+s-1],f=0,g=0,y=0,v=0,D=0,T=0,b=0;s>b;b+=2){var E=r[n+b],A=r[n+b+1];d===E&&(d=E+1e-4),m===A&&(m=A+1e-4);var O=d-E,x=m-A,S=d*A-m*E,B=_*x-u*O,P=(p*O-_*S)/B;if((P>=d&&E>=P||P>=E&&d>=P)&&(0===_||P>=t&&i>=P||P>=i&&t>=P)){var M=(p*x-u*S)/B;if((M>=m&&A>=M||M>=A&&m>=M)&&(0===u||M>=e&&a>=M||M>=a&&e>=M)){if(null===l){y=P,v=M,D=P,T=M,c++,null!==h&&(h.x=Math.atan2(A-m,E-d)-.5*Math.PI,h.y=h.x);break}var R=P-t;0>R&&(R=-R),0===c?(f=R,g=R,y=P,v=M,D=P,T=M,null!==h&&(h.x=Math.atan2(A-m,E-d)-.5*Math.PI,h.y=h.x)):(f>R&&(f=R,y=P,v=M,null!==h&&(h.x=Math.atan2(A-m,E-d)-.5*Math.PI)),R>g&&(g=R,D=P,T=M,null!==h&&(h.y=Math.atan2(A-m,E-d)-.5*Math.PI))),c++}}d=E,m=A}return 1===c?(null!==o&&(o.x=y,o.y=v),null!==l&&(l.x=y,l.y=v),null!==h&&(h.y=h.x+Math.PI)):c>1&&(c++,null!==o&&(o.x=y,o.y=v),null!==l&&(l.x=D,l.y=T)),c},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.weight&&this.weight.returnToPool(),this.type=2,this.count=0,this.offset=0,this.x=0,this.y=0,this.vertices=null,this.weight=null},e.prototype.containsPoint=function(t,e){var i=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var a=0,r=this.count,n=r-2;r>a;a+=2){var s=this.vertices[this.offset+n+1],o=this.vertices[this.offset+a+1];if(e>o&&s>=e||e>s&&o>=e){var l=this.vertices[this.offset+n],h=this.vertices[this.offset+a];t>(e-o)*(l-h)/(s-o)+h&&(i=!i)}n=a}return i},e.prototype.intersectsSegment=function(t,a,r,n,s,o,l){void 0===s&&(s=null),void 0===o&&(o=null),void 0===l&&(l=null);var h=0;return 0!==i.intersectsSegment(t,a,r,n,this.x,this.y,this.width,this.height,null,null)&&(h=e.intersectsSegment(t,a,r,n,this.vertices,this.offset,this.count,s,o,l)),h},e}(e);t.PolygonBoundingBoxData=r,__reflect(r.prototype,"dragonBones.PolygonBoundingBoxData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.order=0,this.target=null,this.bone=null,this.root=null},e}(t.BaseObject);t.ConstraintData=e,__reflect(e.prototype,"dragonBones.ConstraintData");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bendPositive=!1,this.scaleEnabled=!1,this.weight=1},e}(e);t.IKConstraintData=i,__reflect(i.prototype,"dragonBones.IKConstraintData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i}return __extends(i,e),i.prototype._onClear=function(){this.name="",this.transform.identity(),this.parent=null},i}(t.BaseObject);t.DisplayData=e,__reflect(e.prototype,"dragonBones.DisplayData");var i=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.pivot=new t.Point,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.ImageDisplayData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.isRelativePivot=!1,this.pivot.clear(),this.texture=null},i}(e);t.ImageDisplayData=i,__reflect(i.prototype,"dragonBones.ImageDisplayData");var a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions;e<i.length;e++){var a=i[e];a.returnToPool()}this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},e}(e);t.ArmatureDisplayData=a,__reflect(a.prototype,"dragonBones.ArmatureDisplayData");var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.weight=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.MeshDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.weight&&this.weight.returnToPool(),this.type=2,this.inheritAnimation=!1,this.offset=0,this.textureName="",this.weight=null},e}(i);t.MeshDisplayData=r,__reflect(r.prototype,"dragonBones.MeshDisplayData");var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},e}(e);t.BoundingBoxDisplayData=n,__reflect(n.prototype,"dragonBones.BoundingBoxDisplayData");var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.WeightData]"},e.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},e}(t.BaseObject);t.WeightData=s,__reflect(s.prototype,"dragonBones.WeightData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.frameIndices=[],t.cachedFrames=[],t.armatureNames=[],t.armatures={},t.userData=null,t}return __extends(i,e),i.toString=function(){return"[class dragonBones.DragonBonesData]"},i.prototype._onClear=function(){if(t.DragonBones.debug)for(var e=0,i=t.DragonBones.armatures.length;i>e;++e){var a=t.DragonBones.armatures[e];if(a.armatureData.parent===this)return void t.DragonBones.assert(!1,"The DragonBonesData is being used, please make sure all armature references to the data have been deleted.")}for(var r in this.armatures)this.armatures[r].returnToPool(),delete this.armatures[r];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.userData=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null},i.prototype.addArmature=function(e){e.name in this.armatures&&(t.DragonBones.warn("Replace armature: "+e.name),this.armatures[e.name].returnToPool()),e.parent=this,this.armatures[e.name]=e,this.armatureNames.push(e.name)},i.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},i.prototype.dispose=function(){this.returnToPool()},i}(t.BaseObject);t.DragonBonesData=e,__reflect(e.prototype,"dragonBones.DragonBonesData")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._resourceConfigURL="resource/hello_movie.res.json",e}return __extends(e,t),e.prototype._onStart=function(){dragonBones.addMovieGroup(RES.getRes("movie"),RES.getRes("texture"));var t=dragonBones.buildMovie("DragonBoy");t.addEventListener(dragonBones.MovieEvent.START,this._movieEventHandler,this),t.addEventListener(dragonBones.MovieEvent.LOOP_COMPLETE,this._movieEventHandler,this),t.addEventListener(dragonBones.MovieEvent.COMPLETE,this._movieEventHandler,this),t.addEventListener(dragonBones.MovieEvent.FRAME_EVENT,this._movieEventHandler,this),t.play("walk"),this.addChild(t),t.x=.5*this.stage.stageWidth,t.y=.5*this.stage.stageHeight+100},e.prototype._movieEventHandler=function(t){console.log("Movie.",t.type,t.clipName,t.name||"")},e}(BaseTest);t.HelloMovie=e,__reflect(e.prototype,"demosEgret.HelloMovie")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.UserData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},e}(t.BaseObject);t.UserData=e,__reflect(e.prototype,"dragonBones.UserData");var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return __extends(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.ActionData=i,__reflect(i.prototype,"dragonBones.ActionData")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._left=!1,e._right=!1,e._isJumpingA=!1,e._isJumpingB=!1,e._isSquating=!1,e._isAttackingA=!1,e._isAttackingB=!1,e._weaponIndex=1,e._faceDir=1,e._aimDir=0,e._moveDir=0,e._aimRadian=0,e._speedX=0,e._speedY=0,e._armatureDisplay=null,e._walkState=null,e._weaponState=null,e._aimState=null,e._attackState=null,e._resourceGroup="animationBlendTest",e._resourceConfigURL="resource/test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=this;dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(this._resourceGroup)),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes(this._resourceGroup+"_textureData"),RES.getRes(this._resourceGroup+"_texture")),this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("player"),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight+200,this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this),this.addChild(this._armatureDisplay);var e=function(e){var i="keydown"==e.type;switch(e.keyCode){case 37:case 65:t._left=i,t._updateMove(-1);break;case 39:case 68:t._right=i,t._updateMove(1);break;case 32:i&&t.switchWeapon()}};document.addEventListener("keyup",e),document.addEventListener("keydown",e)},e.prototype._animationHandler=function(t){"SwitchWeapon"===t.animationState.name&&this._updateWeaponState()},e.prototype._updateMove=function(t){this._left&&this._right?this.move(t):this._left?this.move(-1):this._right?this.move(1):this.move(0)},e.prototype._updateAnimation=function(){if(!this._isJumpingA){if(this._isSquating)return void(this._speedX=0);if(0==this._moveDir){this._speedX=0;var t=this._armatureDisplay.animation.fadeIn("Standby",.2,0,0,e.GROUP_A);t.addBoneMask("root"),t.removeBoneMask("arm_u_l"),t.removeBoneMask("arm_u_r"),this._walkState=null,this._updateWeaponState()}else this._walkState||(this._walkState=this._armatureDisplay.animation.fadeIn("Walk",.2,0,0,e.GROUP_A),this._walkState.addBoneMask("root"),this._walkState.removeBoneMask("arm_u_l"),this._walkState.removeBoneMask("arm_u_r")),this._moveDir*this._faceDir>0?this._walkState.timeScale=e.MAX_MOVE_SPEED_FRONT/e.NORMALIZE_MOVE_SPEED:this._walkState.timeScale=-e.MAX_MOVE_SPEED_BACK/e.NORMALIZE_MOVE_SPEED,this._moveDir*this._faceDir>0?this._speedX=e.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-e.MAX_MOVE_SPEED_BACK*this._faceDir,this._updateWeaponState()}},e.prototype._updateWeaponState=function(){var t=e.WEAPONS[this._weaponIndex],i=dragonBones.EgretFactory.factory.buildArmatureDisplay(t);switch(this._weaponIndex){case 0:this.switchWeaponL(i.armature);break;case 1:this.switchWeaponR(i.armature);break;case 2:this.switchWeaponL(i.armature)}0===this._moveDir?this._weaponState=this._armatureDisplay.animation.fadeIn("Standby_"+e.WEAPONS[this._weaponIndex],.2,0,0,e.GROUP_B):(this._weaponState=this._armatureDisplay.animation.fadeIn("Walk_"+e.WEAPONS[this._weaponIndex],.2,0,0,e.GROUP_B),this._weaponState.timeScale=this._walkState.timeScale),this._weaponState.displayControl=!1,this._weaponState.addBoneMask("arm_u_l"),this._weaponState.addBoneMask("arm_u_r")},e.prototype.move=function(t){this._moveDir!=t&&(this._moveDir=t,this._updateAnimation())},e.prototype.jump=function(){this._isJumpingA},e.prototype.squat=function(t){this._isSquating!=t&&(this._isSquating=t,this._updateAnimation())},e.prototype.attack=function(t){this._isAttackingA!=t&&(this._isAttackingA=t)},e.prototype.switchWeapon=function(){this._weaponIndex++,this._weaponIndex>=e.WEAPONS.length&&(this._weaponIndex=0),null!==this._weaponState&&(this._weaponState.fadeOut(.2,!0),this._weaponState=null);var t=this._armatureDisplay.animation.fadeIn("SwitchWeapon",.1,1,1,e.GROUP_A);t.autoFadeOutTime=.1,t.displayControl=!1,t.addBoneMask("body_u"),t.addBoneMask("body_d")},e.prototype.switchWeaponL=function(t){var e=this._armatureDisplay.armature.getSlot("weapon_l"),i=this._armatureDisplay.armature.getSlot("weapon_r");e.childArmature=t,i.childArmature=null},e.prototype.switchWeaponR=function(t){var e=this._armatureDisplay.armature.getSlot("weapon_l"),i=this._armatureDisplay.armature.getSlot("weapon_r");e.childArmature=null,i.childArmature=t},e.prototype.aim=function(t,e){},e}(BaseTest);e.GROUP_A="groupA",e.GROUP_B="groupB",e.GROUP_C="groupC",e.GROUP_AIM="aim",e.GROUP_ATTACK="attack",e.WEAPONS=["Pistol","Gun","Rocket"],e.JUMP_SPEED=20,e.NORMALIZE_MOVE_SPEED=3.6,e.MAX_MOVE_SPEED_FRONT=1.4*e.NORMALIZE_MOVE_SPEED,e.MAX_MOVE_SPEED_BACK=1*e.NORMALIZE_MOVE_SPEED,t.AnimationBlendTest=e,__reflect(e.prototype,"demosEgret.AnimationBlendTest")}(demosEgret||(demosEgret={}));var ChangeSkinTest=function(t){function e(){var e=t.call(this)||this;return e._animationIndex=0,e._adds=[],e._skins=[],e._resourceConfigURL="resource/core_element.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=this;dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("mecha_1502b")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("mecha_1502b_texture_config"),RES.getRes("mecha_1502b_texture")),dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("skin_1502b")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("skin_1502b_texture_config"),RES.getRes("skin_1502b_texture"));var e=.6,i=new egret.Bitmap(RES.getRes("bg"));i.x=40,i.y=30,i.scaleX=i.scaleY=.7,this.addChild(i);var a=dragonBones.EgretFactory.factory.buildArmatureDisplay("mecha_1502b");null!==a&&(a.x=150,a.y=250,a.scaleX=a.scaleY=e,this.addChild(a)),this._armatureDisplayB=dragonBones.EgretFactory.factory.buildArmatureDisplay("mecha_1502b"),null!==this._armatureDisplayB&&(this._armatureDisplayB.visible=!1,this._armatureDisplayB.x=150,this._armatureDisplayB.y=500,this._armatureDisplayB.scaleX=this._armatureDisplayB.scaleY=e,this.addChild(this._armatureDisplayB)),this._armatureDisplayA=dragonBones.EgretFactory.factory.buildArmatureDisplay("mecha_1502b"),null!==this._armatureDisplayA&&(this._armatureDisplayA.x=350,this._armatureDisplayA.y=250,this._armatureDisplayA.scaleX=this._armatureDisplayA.scaleY=e,this.addChild(this._armatureDisplayA)),this._armatureDisplayC=dragonBones.EgretFactory.factory.buildArmatureDisplay("mecha_1502b"),null!==this._armatureDisplayC&&(this._armatureDisplayC.visible=!1,this._armatureDisplayC.x=350,this._armatureDisplayC.y=500,this._armatureDisplayC.scaleX=this._armatureDisplayC.scaleY=e,this.addChild(this._armatureDisplayC));var r=new egret.Bitmap(RES.getRes("b1"));r.touchEnabled=!0,r.x=565,r.y=50,r.scaleX=r.scaleY=.4,r.addEventListener("touchBegin",function(){t._changeSkin(0),t._updateAdds()},this),this.addChild(r);var n=new egret.Bitmap(RES.getRes("a"));n.name="skin_a",n.visible=!1,n.x=640,n.y=110,n.scaleX=n.scaleY=.5,this.addChild(n),this._adds.push(n);var r=new egret.Bitmap(RES.getRes("b2"));r.touchEnabled=!0,r.x=565,r.y=180,r.scaleX=r.scaleY=.4,r.addEventListener("touchBegin",function(){t._changeSkin(1),t._updateAdds()},this),this.addChild(r);var n=new egret.Bitmap(RES.getRes("a"));n.name="skin_b",n.visible=!1,n.x=640,n.y=240,n.scaleX=n.scaleY=.5,this.addChild(n),this._adds.push(n);var r=new egret.Bitmap(RES.getRes("b3"));r.touchEnabled=!0,r.x=565,r.y=310,r.scaleX=r.scaleY=.4,r.addEventListener("touchBegin",function(){t._changeSkin(2),t._updateAdds()},this),this.addChild(r);var n=new egret.Bitmap(RES.getRes("a"));n.name="skin_c",n.visible=!1,n.x=640,n.y=370,n.scaleX=n.scaleY=.5,this.addChild(n),this._adds.push(n);var r=new egret.Bitmap(RES.getRes("bn"));r.touchEnabled=!0,r.x=620,r.y=450,r.scaleX=-1,r.addEventListener("touchBegin",function(){t._changeAnimation(!1)},this),this.addChild(r);var r=new egret.Bitmap(RES.getRes("bn"));r.touchEnabled=!0,r.x=640,r.y=450,r.addEventListener("touchBegin",function(){t._changeAnimation(!0)},this),this.addChild(r)},e.prototype._updateAdds=function(){for(var t=0,e=this._adds;t<e.length;t++){var i=e[t];i.visible=this._skins.indexOf(i.name)>=0}},e.prototype._changeSkin=function(t){var e=["skin_a","skin_b","skin_c"][t],i=!1,a=0;switch(t){case 0:case 1:a=this._skins.indexOf("skin_c"),a>=0&&this._skins.splice(a,1),a=this._skins.indexOf(e),0>a?(i=!0,this._skins.push(e)):this._skins.splice(a,1);break;case 2:a=this._skins.indexOf("skin_a"),a>=0&&this._skins.splice(a,1),a=this._skins.indexOf("skin_b"),a>=0&&this._skins.splice(a,1),a=this._skins.indexOf(e),0>a?(i=!0,this._skins.push(e)):this._skins.splice(a,1)}dragonBones.EgretFactory.factory.changeSkin(this._armatureDisplayA.armature,"mecha_1502b"),dragonBones.EgretFactory.factory.changeSkin(this._armatureDisplayC.armature,"mecha_1502b");for(var r=0,n=this._skins;r<n.length;r++){var s=n[r];dragonBones.EgretFactory.factory.changeSkin(this._armatureDisplayA.armature,s),dragonBones.EgretFactory.factory.changeSkin(this._armatureDisplayC.armature,s)}return this._armatureDisplayA.armature.invalidUpdate(),this._armatureDisplayC.armature.invalidUpdate(),i},e.prototype._changeAnimation=function(t){if(this._armatureDisplayB.visible){t?this._animationIndex++:this._animationIndex--;var e=this._armatureDisplayB.animation.animationNames.length;this._animationIndex%=e,this._animationIndex<0&&(this._animationIndex+=e);var i=this._armatureDisplayB.animation.animationNames[this._animationIndex];this._armatureDisplayB.animation.fadeIn(i),this._armatureDisplayC.animation.fadeIn(i)}else this._armatureDisplayB.visible=!0,this._armatureDisplayC.visible=!0,this._armatureDisplayB.animation.fadeIn("walk"),this._armatureDisplayC.animation.fadeIn("walk")},e}(BaseTest);__reflect(ChangeSkinTest.prototype,"ChangeSkinTest");